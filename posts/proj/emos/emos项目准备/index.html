<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Emos项目准备 | Rex</title>
<meta name="keywords" content="vue, SpringBoot, Java, MongoDB, MySQL, MyBatis, Sa-Token" />
<meta name="description" content="emos项目开发笔记">
<meta name="author" content="Rex">
<link rel="canonical" href="https://rex0520.github.io/posts/proj/emos/emos%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.css" rel="preload stylesheet" as="style">
<link rel="preload" href="http://cdn.rexweb.xyz/img/20210821105340.png" as="image">
<link rel="icon" href="https://rex0520.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://rex0520.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://rex0520.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://rex0520.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://rex0520.github.io/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.87.0" />
<meta property="og:title" content="Emos项目准备" />
<meta property="og:description" content="emos项目开发笔记" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rex0520.github.io/posts/proj/emos/emos%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87/" /><meta property="og:image" content="https://cdn.rexweb.xyz/img/20210820141535.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-09T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-09-09T00:00:00&#43;00:00" /><meta property="og:site_name" content="RexHub" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://cdn.rexweb.xyz/img/20210820141535.jpg"/>

<meta name="twitter:title" content="Emos项目准备"/>
<meta name="twitter:description" content="emos项目开发笔记"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://rex0520.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Emos项目准备",
      "item": "https://rex0520.github.io/posts/proj/emos/emos%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Emos项目准备",
  "name": "Emos项目准备",
  "description": "emos项目开发笔记",
  "keywords": [
    "vue", "SpringBoot", "Java", "MongoDB", "MySQL", "MyBatis", "Sa-Token"
  ],
  "articleBody": "emos项目准备 项目结构 已有项目：  工作流项目(emos-workflow) 小程序项目(emos-wx) 小程序后端项目(emos-wx-api)  待开发项目  Web办公系统前端项目(emos-vue) Web办公系统后端项目(emos-api)  数据表分类：    序号 类型 特征 备注     1 工作流数据表 以 act_ 开头 存储工作流的各项数据   2 定时器数据表 以 qrtz_ 开头 存储QuartZ定时器数据   3 业务表 以 tb_ 开头 保存业务数据   4 系统表 以 sys_ 开头 保存系统配置信息    后端： 依赖库：   Lombok – 生成对象的Get/Set方法\n  Spring Web – spring的web开发框架\n  MyBatis Framework – mybatis的开发框架\n  MySQL Driver – MySQL数据库驱动\n  Spring Data Redis(Access + Driver) – Redis连接+驱动工具\n  Spring Data MongoDB – MongoDB连接工具\n  Spring for RabbitMQ – RabbitMQ消息队列连接工具\n  WebSocket – 网络工具\n  Java Mail Sender – 发送邮件工具\n  Jettty – 因为本项目中用到了WebSocket，而且Jetty本身的IO就是非阻塞式的，所以在高并发的WebSocket环境下，Jetty比Tomcat更加适合。\n  druid – mysql数据库连接池\n  springdoc – 接口文档生成工具\n  Sa-Token – 轻量级权限认证框架\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19    cn.dev33 sa-token-spring-boot-starter 1.20.0    cn.dev33 sa-token-dao-redis 1.20.0    cn.dev33 sa-token-spring-aop 1.20.0      项目配置 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113  server:# jetty线程池配置jetty:threads:acceptors:4selectors:8port:8090servlet:context-path:/emos-api# 文件上传大小配置multipart:max-request-size:10MBmax-file-size:2MBspring:# 数据库连接池datasource:# 数据库池类型type:com.alibaba.druid.pool.DruidDataSourcedruid:driver-class-name:com.mysql.cj.jdbc.Driverurl:jdbc:mysql://localhost:3306/emos?useUnicode=true\u0026characterEncoding=UTF-8\u0026serverTimezone=Asia/Shanghai\u0026nullCatelogMeansCurrent=trueusername:rootpassword:root# 初始连接数量initial-size:2# 最大活跃数max-active:4# 最小空闲值min-idle:4# 最大等待值max-wait:60000# 建议配置为true，不影响性能，并且保证安全性。申请连接的时候检测，如果空闲时间大于timeBetweenEvictionRunsMillis，执行validationQuery检测连接是否有效。test-while-idle:true# 申请连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能。test-on-borrow:false# 归还连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能test-on-return:false# Redis配置redis:database:0host:localhostport:6379password:jedis:pool:# 连接池最大连接数（使用负值表示没有限制）max-active:1000# 连接池中的最大阻塞等待时间（使用负值表示没有限制）max-wait:-1ms# 连接池中的最大空闲连接max-idle:16# 连接池中的最小空闲连接min-idle:8# MongoDB配置data:mongodb:host:localhostport:27017database:emos# 身份验证# authentication-database: admin# username:# password:sa-token:# token名称 (同时也是cookie名称)token-name:token# token有效期，单位s 默认30天, -1代表永不过期timeout:2592000# token临时有效期 (指定时间内无操作就视为token过期) 单位: 秒activity-timeout:-1# 是否允许同一账号并发登录 (为true时允许一起登录, 为false时新登录挤掉旧登录)allow-concurrent-login:true# 在多人登录同一账号时，是否共用一个token (为true时所有登录共用一个token, 为false时每次登录新建一个token)is-share:false# token风格token-style:uuid# 配置MyBatismybatis:# mapper文件地址映射mapper-locations:classpath*:mapper/*.xml# 配置xml文件中resultType返回值的包位置type-aliases-package:com.example.emos.wx.db.pojoconfiguration:# 开启日志log-impl:org.apache.ibatis.logging.stdout.StdOutImpl# 开启驼峰转换map-underscore-to-camel-case:true# 日志配置logging:# 日志级别level:root:infocom.example.emos.wx.db.dao:warnpattern:# 日志格式console:\"%d{yyyy/MM/dd HH:mm:ss} %-5level %msg%n\"# 接口文档工具配置springdoc:api-docs:# 启用接口文档工具enabled:true# 配置接口文档urlpath:/doc-api.html# 用swagger来美化文档swagger-ui:# 配置swagger接口文档urlpath:/swagger-ui.htmldisable-swagger-default-url:on  工具库    序号 工具库 备注     1 hutool 通用工具库   2 commons-io 文件IO通用工具库   3 zxing 生成二维码图片   4 httpcore HTTP状态码    基础配置   统一Web响应结果\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78  package com.example.emos.api.common.dto; import lombok.Data; import org.apache.http.HttpStatus; import java.io.Serializable; import java.sql.ResultSet; /** * Description: 统一Web响应结果 * * @author Rex * @date 2021-09-09 10:27 */ @Data public class ResultT implements Serializable { private static final long serialVersionUID = 1L; /** * 响应码 */ private Integer code; /** * 响应信息 */ private String msg; /** * 响应数据 */ private T data; public Result() { this.code = HttpStatus.SC_OK; this.msg = \"success\"; } public Result(String msg) { this(); this.msg = msg; } public Result(Integer code, String msg) { this.code = code; this.msg = msg; } public Result(Integer code, String msg, T data) { this(code, msg); this.data = data; } public static ResultVoid success(){ return new Result(); } public static ResultVoid success(String msg){ return new Result(msg); } public static RResultR success(R data){ ResultR result = new Result(); result.setData(data); return result; } public static ResultVoid error(int code, String msg){ return new Result(code, msg); } public static ResultVoid error(String msg){ return error(HttpStatus.SC_INTERNAL_SERVER_ERROR, msg); } public static Result error(){ return error(HttpStatus.SC_INTERNAL_SERVER_ERROR, \"未知异常，请联系管理员\"); } }     整合SpringDoc\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31  package com.example.emos.api.config; import io.swagger.v3.oas.annotations.OpenAPIDefinition; import io.swagger.v3.oas.annotations.enums.SecuritySchemeType; import io.swagger.v3.oas.annotations.info.Info; import io.swagger.v3.oas.annotations.security.SecurityScheme; import org.springframework.context.annotation.Configuration; /** * Description: 配置SpringDoc * * @author Rex * @date 2021-09-09 11:02 */ @Configuration @OpenAPIDefinition( info = @Info( title = \"emos-api\", description = \"Emos管理系统后端Java项目\", version = \"1.0\" ) ) @SecurityScheme( name = \"token\", type = SecuritySchemeType.HTTP, bearerFormat = \"JWT\", scheme = \"bearer\" ) public class SpringDocConfig { }     整合权限验证和授权\n在com.example.emos.api.config包中创建StpInterfaceImpl.java类，这个Java类就是Sa-Token框架拦截HTTP请求之后调用的类。在这个类中，我们一共要声明两个方法分别用来查询用户实际的权限和角色。然后Sa-Token框架的@SaCheckPermission或者@SaCheckRole注解会根据查询出来的权限和角色，跟注解要求的权限或者角色做匹配。\nTbUserDao.xml\n1 2 3 4 5 6 7 8   id=\"searchUserPermissions\" parameterType=\"int\" resultType=\"String\" SELECT DISTINCT p.permission_name FROM tb_user u JOIN tb_role r ON JSON_CONTAINS(u.role, CAST(r.id AS CHAR)) JOIN tb_permission p ON JSON_CONTAINS(r.permissions, CAST(p.id AS CHAR)) WHERE u.id=#{userId} AND u.status=1;    TbUserDao.java\n1 2 3 4 5 6  @Mapper public interface TbUserDao { …… public SetString searchUserPermissions(int userId); }   StpInterfaceImpl.java\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39  package com.example.emos.api.config; import cn.dev33.satoken.stp.StpInterface; import com.example.emos.api.db.dao.TbUserDao; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.stereotype.Component; import java.util.ArrayList; import java.util.List; import java.util.Set; @Component public class StpInterfaceImpl implements StpInterface { @Autowired private TbUserDao userDao; /** * 返回一个用户所拥有的权限集合 */ @Override public ListString getPermissionList(Object loginId, String loginKey) { int userId = Integer.parseInt(loginId.toString()); SetString permissions = userDao.searchUserPermissions(userId); ArrayList list = new ArrayList(); list.addAll(permissions); return list; } /** * 返回一个用户所拥有的角色标识集合 */ @Override public ListString getRoleList(Object loginId, String loginKey) { //因为本项目不需要用到角色判定，所以这里就返回一个空的ArrayList对象  ArrayListString list = new ArrayListString(); return list; } }     跨域配置\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  package com.example.emos.api.config; import org.springframework.context.annotation.Configuration; import org.springframework.web.servlet.config.annotation.CorsRegistry; import org.springframework.web.servlet.config.annotation.WebMvcConfigurer; /** * Description: 跨域请求配置 * * @author Rex * @date 2021-09-09 12:55 */ @Configuration public class CorsConfig implements WebMvcConfigurer { @Override public void addCorsMappings(CorsRegistry registry) { registry.addMapping(\"/**\") .allowedOriginPatterns(\"*\") .allowCredentials(true) .allowedMethods(\"GET\", \"POST\", \"DELETE\", \"PUT\", \"PATCH\") .maxAge(3600); } }     异常\n  自定义业务异常\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  package com.example.emos.api.common.dto.exception; import lombok.Data; import lombok.EqualsAndHashCode; /** * Description: 业务异常 * * @author Rex * @date 2021-09-09 14:22 */ @EqualsAndHashCode(callSuper = true) @Data public class EmosException extends RuntimeException{ private String msg; private Integer code = 500; public EmosException(String msg){ super(msg); this.msg = msg; } public EmosException(String msg, Integer code){ super(msg); this.msg = msg; this.code = code; } }     统一异常处理\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76  package com.example.emos.api.config; import cn.dev33.satoken.exception.NotLoginException; import com.example.emos.api.common.dto.Result; import com.example.emos.api.common.exception.EmosException; import lombok.extern.slf4j.Slf4j; import org.springframework.http.HttpStatus; import org.springframework.web.bind.MethodArgumentNotValidException; import org.springframework.web.bind.annotation.ExceptionHandler; import org.springframework.web.bind.annotation.ResponseBody; import org.springframework.web.bind.annotation.ResponseStatus; import org.springframework.web.bind.annotation.RestControllerAdvice; /** * Description: 统一异常处理 * * @author Rex * @date 2021-09-09 14:26 */ @Slf4j @RestControllerAdvice public class GlobalExceptionHandler { /** * 处理全局异常信息 * @param e 全局异常 * @return 返回异常信息 */ @ResponseBody @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR) @ExceptionHandler(Exception.class) public ResultVoid exceptionHandler(Exception e){ log.error(\"执行异常\", e); return Result.error(); } /** * 处理后端验证失败产生的异常 * @param e 校验异常 * @return 返回异常信息 */ @ResponseBody @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR) @ExceptionHandler(MethodArgumentNotValidException.class) public ResultVoid methodArgumentNotValidExceptionHandler(MethodArgumentNotValidException e){ log.error(\"执行异常\", e); return Result.error(e.getBindingResult().getFieldError().getDefaultMessage()); } /** * 处理业务异常 * @param e 业务异常 * @return 返回异常信息 */ @ResponseBody @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR) @ExceptionHandler(EmosException.class) public ResultVoid emosExceptionHandler(EmosException e){ log.error(\"执行异常\", e); return Result.error(e.getMsg()); } /** * 处理未登录异常 * @param e 未登录异常 * @return 返回异常信息 */ @ResponseBody @ResponseStatus(HttpStatus.UNAUTHORIZED) @ExceptionHandler(NotLoginException.class) public ResultVoid unLoginHandler(NotLoginException e){ return Result.error(e.getMessage()); } }       开启Java异步执行\n为什么要给Java语言增添异步执行？其实很简单，在一个业务流程中，有时候会有一些耗费时间的分支任务，如果把这些琐碎且不重要的任务用异步来执行，那么就可以减轻当前线程的执行压力。\n举个例子吧，例如有个电商网站为了吸引新用户注册，给出了赠送一年优酷会员的优惠。如果我们采用同步的执行方式，用户帐户开通之后，当前线程还要调用优酷系统的接口，开通会员帐户，并且充值一年会员。整个流程加起来还是挺耗费时间的，让新注册用户等待一两分钟才能收到注册成功的通知，用户心里肯定会怀疑：这是什么破电商网站，注册个会员就要好几分钟，我要是买东西不得卡成翔啊。\n如果我们采取异步执行的方式，电商帐户开通之后，我们把开通优酷会员的任务交给其他线程去做，当前线程就不用负责了，直接返回给用户注册成功即可。当其他线程开通优酷会员之后，给用户的手机发一个短信通知即可。你看，采用了异步执行以后，新用户注册的体验更好了。其实我这里说的异步执行就是由SpringBoot自动把任务交给线程池中某个线程去执行。你以前自己创建线程分配任务的方式，也属于异步执行。只不过有了SpringBoot之后，任务的分配更加自动了。\n关于电商网站新用户注册的例子，有的同学可能还有疑问：不用异步执行，我用消息队列来分配任务是不是也行？当然是可行的。刚才我说的异步执行陷于同一个系统中，把分支任务交给其他线程去执行。如果你用的是分布式架构，A系统想要把分支任务分配个B系统去执行，通过消息队列来分配任务完全是可行的，这也算是一种异步执行的方式。\n创建线程池：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38  package com.example.emos.api.config; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.core.task.AsyncTaskExecutor; import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor; import java.util.concurrent.ThreadPoolExecutor; /** * Description: 线程池配置类 * * @author Rex * @date 2021-09-09 14:46 */ @Configuration public class ThreadPoolConfig { @Bean(\"AsyncTaskExecutor\") public AsyncTaskExecutor taskExecutor(){ ThreadPoolTaskExecutor executorThread = new ThreadPoolTaskExecutor(); // 设置核心线程数  executorThread.setCorePoolSize(8); // 设置最大线程数  executorThread.setMaxPoolSize(16); // 设置队列容量  executorThread.setQueueCapacity(32); // 设置线程活跃时间(秒)  executorThread.setKeepAliveSeconds(60); // 设置默认线程名称  executorThread.setThreadNamePrefix(\"task-\"); // 设置拒绝策略  executorThread.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy()); executorThread.initialize(); return executorThread; } }   开启SpringBoot异步执行\n​\t我们在项目的主类EmosApiApplication.java声明上面加上@EnableAsync注解即可。等将来我们发送邮件的时候，再去编写任务类。\n  预防XSS攻击\n防御XSS攻击的办法很简单，那就是对所有用户的数据先做转义处理，然后再保存到数据库里面。转义之后的信息，将来被加载到网页上面就丧失了作为脚本执行的能力。比如说上面文本框里面的脚本，经过转义之后就变成了alert(\"HelloWorld\")这个样子。就拿来说吧，它会被渲染成字符串，而不是当做脚本标签来执行。\n实现XSS内容转义\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135  package com.example.emos.api.config.xss; import cn.hutool.core.util.StrUtil; import cn.hutool.http.HtmlUtil; import cn.hutool.json.JSONUtil; import javax.servlet.ReadListener; import javax.servlet.ServletInputStream; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletRequestWrapper; import java.io.BufferedReader; import java.io.ByteArrayInputStream; import java.io.IOException; import java.io.InputStreamReader; import java.nio.charset.StandardCharsets; import java.util.LinkedHashMap; import java.util.Map; /** * Description: httpServletRequest请求转义封装类 * 转义请求返回的结果 * @author Rex * @date 2021-09-09 15:36 */ public class XssHttpSevletRequestWrapper extends HttpServletRequestWrapper { public XssHttpSevletRequestWrapper(HttpServletRequest request) { super(request); } @Override public String getParameter(String name) { String value = super.getParameter(name); if (!StrUtil.hasEmpty(value)){ value = HtmlUtil.cleanHtmlTag(value); } return value; } @Override public String[] getParameterValues(String name) { String[] values = super.getParameterValues(name); if (values != null) { for (int i = 0; i  values.length; i++) { String value = values[i]; if (!StrUtil.hasEmpty(value)){ value = HtmlUtil.cleanHtmlTag(value); } values[i] = value; } } return values; } @Override public MapString, String[] getParameterMap() { MapString, String[] parameterMap = super.getParameterMap(); LinkedHashMapString, String[] map = new LinkedHashMap(); if (parameterMap != null) { for (String key : parameterMap.keySet()) { String[] values = parameterMap.get(key); for (int i = 0; i  values.length; i++) { String value = values[i]; if (!StrUtil.hasEmpty(value)){ value = HtmlUtil.cleanHtmlTag(value); } values[i] = value; } map.put(key, values); } } return map; } @Override public String getHeader(String name) { String value = super.getHeader(name); if (!StrUtil.hasEmpty(value)){ value = HtmlUtil.cleanHtmlTag(value); } return value; } @Override public ServletInputStream getInputStream() throws IOException { ServletInputStream in = super.getInputStream(); InputStreamReader reader = new InputStreamReader(in, StandardCharsets.UTF_8); BufferedReader buffer = new BufferedReader(reader); StringBuilder body = new StringBuilder(); String line = buffer.readLine(); while (line != null){ body.append(line); line = buffer.readLine(); } buffer.close(); reader.close(); in.close(); MapString, Object map = JSONUtil.parseObj(body.toString()); MapString, Object result = new LinkedHashMap(); for (String key : map.keySet()) { Object value = map.get(key); if (value instanceof String){ if (!StrUtil.hasEmpty(value.toString())){ result.put(key, HtmlUtil.cleanHtmlTag(value.toString())); } }else { result.put(key, value); } } String json = JSONUtil.toJsonStr(result); ByteArrayInputStream bain = new ByteArrayInputStream(json.getBytes(StandardCharsets.UTF_8)); return new ServletInputStream() { @Override public boolean isFinished() { return false; } @Override public boolean isReady() { return false; } @Override public void setReadListener(ReadListener readListener) { } @Override public int read() throws IOException { return bain.read(); } }; } }     过滤请求\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31  package com.example.emos.api.config.xss; import javax.servlet.*; import javax.servlet.http.HttpServletRequest; import java.io.IOException; /** * Description: xss过滤器 * 拦截所有的HTTP请求， * 然后调用上面创建的XssHttpServletRequestWrapper类 * * @author Rex * @date 2021-09-09 16:06 */ public class XssFilter implements Filter { @Override public void init(FilterConfig filterConfig) throws ServletException { } @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException { HttpServletRequest request = (HttpServletRequest) servletRequest; XssHttpSevletRequestWrapper wrapper = new XssHttpSevletRequestWrapper(request); filterChain.doFilter(wrapper, servletResponse); } @Override public void destroy() { } }       自定义分页对象\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48  package com.example.emos.api.common.dto; import java.io.Serializable; import java.util.List; /** * Description: 自定义分页 * * @author Rex * @date 2021-09-09 16:20 */ public class PageinationT implements Serializable { private static final long serialVersionUID = 1L; /** * 总记录数 */ private Long totalCount; /** * 每页记录数 */ private Integer pageSize; /** * 总页数 */ private Integer totalPage; /** * 当前页数 */ private Integer pageIndex; /** * 列表数据 */ private ListT list; public Pageination(ListT list, Long totalCount, Integer pageIndex, Integer pageSize){ this.list = list; this.totalCount = totalCount; this.pageSize = pageSize; this.pageIndex = pageIndex; this.totalPage = (int) Math.ceil((double) totalCount / pageSize); } }     ",
  "wordCount" : "2024",
  "inLanguage": "en",
  "datePublished": "2021-09-09T00:00:00Z",
  "dateModified": "2021-09-09T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Rex"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://rex0520.github.io/posts/proj/emos/emos%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Rex",
    "logo": {
      "@type": "ImageObject",
      "url": "https://rex0520.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://rex0520.github.io/" accesskey="h" title="Home (Alt + H)">
                <img src="http://cdn.rexweb.xyz/img/20210821105340.png" alt="logo" aria-label="logo"
                    height="35">Home</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://rex0520.github.io/posts/" title="文章">
                    <span>文章</span>
                </a>
            </li>
            <li>
                <a href="https://rex0520.github.io/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="https://rex0520.github.io/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://rex0520.github.io/archives/" title="时间轴">
                    <span>时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://rex0520.github.io/search/" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://rex0520.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://rex0520.github.io/posts/">Posts</a></div>
    <h1 class="post-title">
      Emos项目准备
    </h1>
    <div class="post-description">
      emos项目开发笔记
    </div>
    <div class="post-meta">2021-09-09&nbsp;·&nbsp;10 min&nbsp;·&nbsp;Rex&nbsp;|&nbsp;<a href="https://github.com/Rex0520/GiantApe-LRX.github.io" rel="noopener noreferrer" target="_blank">来这修改</a>
</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <div class="details">Table of Contents</div>
        </summary>
        <div class="inner"><ul>
                <li>
                    <a href="#emos%e9%a1%b9%e7%9b%ae%e5%87%86%e5%a4%87" aria-label="emos项目准备">emos项目准备</a><ul>
                        
                <li>
                    <a href="#%e9%a1%b9%e7%9b%ae%e7%bb%93%e6%9e%84" aria-label="项目结构">项目结构</a><ul>
                        
                <li>
                    <a href="#%e5%b7%b2%e6%9c%89%e9%a1%b9%e7%9b%ae" aria-label="已有项目：">已有项目：</a></li>
                <li>
                    <a href="#%e5%be%85%e5%bc%80%e5%8f%91%e9%a1%b9%e7%9b%ae" aria-label="待开发项目">待开发项目</a></li>
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e8%a1%a8%e5%88%86%e7%b1%bb" aria-label="数据表分类：">数据表分类：</a></li>
                <li>
                    <a href="#%e5%90%8e%e7%ab%af" aria-label="后端：">后端：</a><ul>
                        
                <li>
                    <a href="#%e4%be%9d%e8%b5%96%e5%ba%93" aria-label="依赖库：">依赖库：</a></li>
                <li>
                    <a href="#%e9%a1%b9%e7%9b%ae%e9%85%8d%e7%bd%ae" aria-label="项目配置">项目配置</a></li>
                <li>
                    <a href="#%e5%b7%a5%e5%85%b7%e5%ba%93" aria-label="工具库">工具库</a></li>
                <li>
                    <a href="#%e5%9f%ba%e7%a1%80%e9%85%8d%e7%bd%ae" aria-label="基础配置">基础配置</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="emos项目准备">emos项目准备<a hidden class="anchor" aria-hidden="true" href="#emos项目准备">#</a></h1>
<h2 id="项目结构">项目结构<a hidden class="anchor" aria-hidden="true" href="#项目结构">#</a></h2>
<h3 id="已有项目">已有项目：<a hidden class="anchor" aria-hidden="true" href="#已有项目">#</a></h3>
<ol>
<li>工作流项目(emos-workflow)</li>
<li>小程序项目(emos-wx)</li>
<li>小程序后端项目(emos-wx-api)</li>
</ol>
<h3 id="待开发项目">待开发项目<a hidden class="anchor" aria-hidden="true" href="#待开发项目">#</a></h3>
<ol>
<li>Web办公系统前端项目(emos-vue)</li>
<li>Web办公系统后端项目(emos-api)</li>
</ol>
<h3 id="数据表分类">数据表分类：<a hidden class="anchor" aria-hidden="true" href="#数据表分类">#</a></h3>
<table>
<thead>
<tr>
<th style="text-align:left">序号</th>
<th style="text-align:left">类型</th>
<th style="text-align:left">特征</th>
<th style="text-align:left">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">工作流数据表</td>
<td style="text-align:left">以 act_ 开头</td>
<td style="text-align:left">存储工作流的各项数据</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">定时器数据表</td>
<td style="text-align:left">以 qrtz_ 开头</td>
<td style="text-align:left">存储QuartZ定时器数据</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">业务表</td>
<td style="text-align:left">以 tb_ 开头</td>
<td style="text-align:left">保存业务数据</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left">系统表</td>
<td style="text-align:left">以 sys_ 开头</td>
<td style="text-align:left">保存系统配置信息</td>
</tr>
</tbody>
</table>
<h3 id="后端">后端：<a hidden class="anchor" aria-hidden="true" href="#后端">#</a></h3>
<h4 id="依赖库">依赖库：<a hidden class="anchor" aria-hidden="true" href="#依赖库">#</a></h4>
<ul>
<li>
<p>Lombok &ndash; 生成对象的Get/Set方法</p>
</li>
<li>
<p>Spring Web &ndash; spring的web开发框架</p>
</li>
<li>
<p>MyBatis Framework &ndash; mybatis的开发框架</p>
</li>
<li>
<p>MySQL Driver &ndash; MySQL数据库驱动</p>
</li>
<li>
<p>Spring Data Redis(Access + Driver) &ndash; Redis连接+驱动工具</p>
</li>
<li>
<p>Spring Data MongoDB &ndash; MongoDB连接工具</p>
</li>
<li>
<p>Spring for RabbitMQ &ndash; RabbitMQ消息队列连接工具</p>
</li>
<li>
<p>WebSocket &ndash; 网络工具</p>
</li>
<li>
<p>Java Mail Sender &ndash; 发送邮件工具</p>
</li>
<li>
<p>Jettty &ndash; 因为本项目中用到了WebSocket，而且Jetty本身的IO就是非阻塞式的，所以在高并发的WebSocket环境下，Jetty比Tomcat更加适合。</p>
</li>
<li>
<p>druid &ndash; mysql数据库连接池</p>
</li>
<li>
<p>springdoc &ndash; 接口文档生成工具</p>
</li>
<li>
<p>Sa-Token &ndash; 轻量级权限认证框架</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!--核心库--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>cn.dev33<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>sa-token-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;version&gt;</span>1.20.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="c">&lt;!--用Redis缓存授权信息--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>cn.dev33<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>sa-token-dao-redis<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;version&gt;</span>1.20.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="c">&lt;!--注解式权限验证--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>cn.dev33<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>sa-token-spring-aop<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;version&gt;</span>1.20.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="项目配置">项目配置<a hidden class="anchor" aria-hidden="true" href="#项目配置">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="nt">server</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="c"># jetty线程池配置</span><span class="w">
</span><span class="w">  </span><span class="nt">jetty</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">threads</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">acceptors</span><span class="p">:</span><span class="w"> </span><span class="m">4</span><span class="w">
</span><span class="w">      </span><span class="nt">selectors</span><span class="p">:</span><span class="w"> </span><span class="m">8</span><span class="w">
</span><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8090</span><span class="w">
</span><span class="w">  </span><span class="nt">servlet</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">context-path</span><span class="p">:</span><span class="w"> </span><span class="l">/emos-api</span><span class="w">
</span><span class="w">    </span><span class="c"># 文件上传大小配置</span><span class="w">
</span><span class="w">    </span><span class="nt">multipart</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">max-request-size</span><span class="p">:</span><span class="w"> </span><span class="l">10MB</span><span class="w">
</span><span class="w">      </span><span class="nt">max-file-size</span><span class="p">:</span><span class="w"> </span><span class="l">2MB</span><span class="w">
</span><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="c"># 数据库连接池</span><span class="w">
</span><span class="w">  </span><span class="nt">datasource</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="c"># 数据库池类型</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">com.alibaba.druid.pool.DruidDataSource</span><span class="w">
</span><span class="w">    </span><span class="nt">druid</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">driver-class-name</span><span class="p">:</span><span class="w"> </span><span class="l">com.mysql.cj.jdbc.Driver</span><span class="w">
</span><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">jdbc:mysql://localhost:3306/emos?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai&amp;nullCatelogMeansCurrent=true</span><span class="w">
</span><span class="w">      </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">      </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">      </span><span class="c"># 初始连接数量</span><span class="w">
</span><span class="w">      </span><span class="nt">initial-size</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span><span class="w">      </span><span class="c"># 最大活跃数</span><span class="w">
</span><span class="w">      </span><span class="nt">max-active</span><span class="p">:</span><span class="w"> </span><span class="m">4</span><span class="w">
</span><span class="w">      </span><span class="c"># 最小空闲值</span><span class="w">
</span><span class="w">      </span><span class="nt">min-idle</span><span class="p">:</span><span class="w"> </span><span class="m">4</span><span class="w">
</span><span class="w">      </span><span class="c"># 最大等待值</span><span class="w">
</span><span class="w">      </span><span class="nt">max-wait</span><span class="p">:</span><span class="w"> </span><span class="m">60000</span><span class="w">
</span><span class="w">      </span><span class="c"># 建议配置为true，不影响性能，并且保证安全性。申请连接的时候检测，如果空闲时间大于timeBetweenEvictionRunsMillis，执行validationQuery检测连接是否有效。</span><span class="w">
</span><span class="w">      </span><span class="nt">test-while-idle</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">      </span><span class="c"># 申请连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能。</span><span class="w">
</span><span class="w">      </span><span class="nt">test-on-borrow</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">      </span><span class="c"># 归还连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能</span><span class="w">
</span><span class="w">      </span><span class="nt">test-on-return</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">  </span><span class="c"># Redis配置</span><span class="w">
</span><span class="w">  </span><span class="nt">redis</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span><span class="w">    </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">localhost</span><span class="w">
</span><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">6379</span><span class="w">
</span><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">jedis</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">pool</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="c"># 连接池最大连接数（使用负值表示没有限制）</span><span class="w">
</span><span class="w">        </span><span class="nt">max-active</span><span class="p">:</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span><span class="w">        </span><span class="c"># 连接池中的最大阻塞等待时间（使用负值表示没有限制）</span><span class="w">
</span><span class="w">        </span><span class="nt">max-wait</span><span class="p">:</span><span class="w"> </span>-<span class="l">1ms</span><span class="w">
</span><span class="w">        </span><span class="c"># 连接池中的最大空闲连接</span><span class="w">
</span><span class="w">        </span><span class="nt">max-idle</span><span class="p">:</span><span class="w"> </span><span class="m">16</span><span class="w">
</span><span class="w">        </span><span class="c"># 连接池中的最小空闲连接</span><span class="w">
</span><span class="w">        </span><span class="nt">min-idle</span><span class="p">:</span><span class="w"> </span><span class="m">8</span><span class="w">
</span><span class="w">  </span><span class="c"># MongoDB配置</span><span class="w">
</span><span class="w">  </span><span class="nt">data</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">mongodb</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">localhost</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">27017</span><span class="w">
</span><span class="w">      </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l">emos</span><span class="w">
</span><span class="w">      </span><span class="c"># 身份验证</span><span class="w">
</span><span class="w">      </span><span class="c"># authentication-database: admin</span><span class="w">
</span><span class="w">      </span><span class="c"># username:</span><span class="w">
</span><span class="w">      </span><span class="c"># password:</span><span class="w">
</span><span class="w">  </span><span class="nt">sa-token</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="c"># token名称 (同时也是cookie名称)</span><span class="w">
</span><span class="w">    </span><span class="nt">token-name</span><span class="p">:</span><span class="w"> </span><span class="l">token</span><span class="w">
</span><span class="w">    </span><span class="c"># token有效期，单位s 默认30天, -1代表永不过期</span><span class="w">
</span><span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="m">2592000</span><span class="w">
</span><span class="w">    </span><span class="c"># token临时有效期 (指定时间内无操作就视为token过期) 单位: 秒</span><span class="w">
</span><span class="w">    </span><span class="nt">activity-timeout</span><span class="p">:</span><span class="w"> </span>-<span class="m">1</span><span class="w">
</span><span class="w">    </span><span class="c"># 是否允许同一账号并发登录 (为true时允许一起登录, 为false时新登录挤掉旧登录)</span><span class="w">
</span><span class="w">    </span><span class="nt">allow-concurrent-login</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="c"># 在多人登录同一账号时，是否共用一个token (为true时所有登录共用一个token, 为false时每次登录新建一个token)</span><span class="w">
</span><span class="w">    </span><span class="nt">is-share</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">    </span><span class="c"># token风格</span><span class="w">
</span><span class="w">    </span><span class="nt">token-style</span><span class="p">:</span><span class="w"> </span><span class="l">uuid</span><span class="w">
</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># 配置MyBatis</span><span class="w">
</span><span class="w"></span><span class="nt">mybatis</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="c"># mapper文件地址映射</span><span class="w">
</span><span class="w">  </span><span class="nt">mapper-locations</span><span class="p">:</span><span class="w"> </span><span class="l">classpath*:mapper/*.xml</span><span class="w">
</span><span class="w">  </span><span class="c"># 配置xml文件中resultType返回值的包位置</span><span class="w">
</span><span class="w">  </span><span class="nt">type-aliases-package</span><span class="p">:</span><span class="w"> </span><span class="l">com.example.emos.wx.db.pojo</span><span class="w">
</span><span class="w">  </span><span class="nt">configuration</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="c"># 开启日志</span><span class="w">
</span><span class="w">    </span><span class="nt">log-impl</span><span class="p">:</span><span class="w"> </span><span class="l">org.apache.ibatis.logging.stdout.StdOutImpl</span><span class="w">
</span><span class="w">    </span><span class="c"># 开启驼峰转换</span><span class="w">
</span><span class="w">    </span><span class="nt">map-underscore-to-camel-case</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># 日志配置</span><span class="w">
</span><span class="w"></span><span class="nt">logging</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="c"># 日志级别</span><span class="w">
</span><span class="w">  </span><span class="nt">level</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">root</span><span class="p">:</span><span class="w"> </span><span class="l">info</span><span class="w">
</span><span class="w">    </span><span class="nt">com.example.emos.wx.db.dao</span><span class="p">:</span><span class="w"> </span><span class="l">warn</span><span class="w">
</span><span class="w">  </span><span class="nt">pattern</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="c"># 日志格式</span><span class="w">
</span><span class="w">    </span><span class="nt">console</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;%d{yyyy/MM/dd HH:mm:ss} %-5level %msg%n&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># 接口文档工具配置</span><span class="w">
</span><span class="w"></span><span class="nt">springdoc</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">api-docs</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="c"># 启用接口文档工具</span><span class="w">
</span><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="c"># 配置接口文档url</span><span class="w">
</span><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/doc-api.html</span><span class="w">
</span><span class="w">  </span><span class="c"># 用swagger来美化文档</span><span class="w">
</span><span class="w">  </span><span class="nt">swagger-ui</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="c"># 配置swagger接口文档url</span><span class="w">
</span><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/swagger-ui.html</span><span class="w">
</span><span class="w">    </span><span class="nt">disable-swagger-default-url</span><span class="p">:</span><span class="w"> </span><span class="kc">on</span><span class="w">
</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="工具库">工具库<a hidden class="anchor" aria-hidden="true" href="#工具库">#</a></h4>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>序号</strong></th>
<th style="text-align:left"><strong>工具库</strong></th>
<th style="text-align:left"><strong>备注</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">hutool</td>
<td style="text-align:left">通用工具库</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">commons-io</td>
<td style="text-align:left">文件IO通用工具库</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">zxing</td>
<td style="text-align:left">生成二维码图片</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left">httpcore</td>
<td style="text-align:left">HTTP状态码</td>
</tr>
</tbody>
</table>
<h4 id="基础配置">基础配置<a hidden class="anchor" aria-hidden="true" href="#基础配置">#</a></h4>
<ol>
<li>
<p>统一Web响应结果</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.example.emos.api.common.dto</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpStatus</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.ResultSet</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * Description: 统一Web响应结果
</span><span class="cm"> *
</span><span class="cm"> * @author Rex
</span><span class="cm"> * @date 2021-09-09 10:27
</span><span class="cm"> */</span>
<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="n">1L</span><span class="o">;</span>

  <span class="cm">/**
</span><span class="cm">   * 响应码
</span><span class="cm">   */</span>
  <span class="kd">private</span> <span class="n">Integer</span> <span class="n">code</span><span class="o">;</span>

  <span class="cm">/**
</span><span class="cm">   * 响应信息
</span><span class="cm">   */</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">msg</span><span class="o">;</span>

  <span class="cm">/**
</span><span class="cm">   * 响应数据
</span><span class="cm">   */</span>
  <span class="kd">private</span> <span class="n">T</span> <span class="n">data</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Result</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">SC_OK</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nf">Result</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nf">Result</span><span class="o">(</span><span class="n">Integer</span> <span class="n">code</span><span class="o">,</span> <span class="n">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nf">Result</span><span class="o">(</span><span class="n">Integer</span> <span class="n">code</span><span class="o">,</span> <span class="n">String</span> <span class="n">msg</span><span class="o">,</span> <span class="n">T</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">code</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">success</span><span class="o">(){</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Result</span><span class="o">&lt;&gt;();</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">success</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">){</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Result</span><span class="o">&lt;&gt;(</span><span class="n">msg</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="nf">success</span><span class="o">(</span><span class="n">R</span> <span class="n">data</span><span class="o">){</span>
    <span class="n">Result</span><span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Result</span><span class="o">&lt;&gt;();</span>
    <span class="n">result</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">error</span><span class="o">(</span><span class="kt">int</span> <span class="n">code</span><span class="o">,</span> <span class="n">String</span> <span class="n">msg</span><span class="o">){</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Result</span><span class="o">&lt;&gt;(</span><span class="n">code</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">error</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">){</span>
    <span class="k">return</span> <span class="n">error</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">SC_INTERNAL_SERVER_ERROR</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">error</span><span class="o">(){</span>
    <span class="k">return</span> <span class="n">error</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">SC_INTERNAL_SERVER_ERROR</span><span class="o">,</span> <span class="s">&#34;未知异常，请联系管理员&#34;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>整合SpringDoc</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.example.emos.api.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">io.swagger.v3.oas.annotations.OpenAPIDefinition</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.swagger.v3.oas.annotations.enums.SecuritySchemeType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.swagger.v3.oas.annotations.info.Info</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.swagger.v3.oas.annotations.security.SecurityScheme</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * Description: 配置SpringDoc
</span><span class="cm"> *
</span><span class="cm"> * @author Rex
</span><span class="cm"> * @date 2021-09-09 11:02
</span><span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="nd">@OpenAPIDefinition</span><span class="o">(</span>
    <span class="n">info</span> <span class="o">=</span> <span class="nd">@Info</span><span class="o">(</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">&#34;emos-api&#34;</span><span class="o">,</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s">&#34;Emos管理系统后端Java项目&#34;</span><span class="o">,</span>
        <span class="n">version</span> <span class="o">=</span> <span class="s">&#34;1.0&#34;</span>
    <span class="o">)</span>
<span class="o">)</span>
<span class="nd">@SecurityScheme</span><span class="o">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#34;token&#34;</span><span class="o">,</span>
    <span class="n">type</span> <span class="o">=</span> <span class="n">SecuritySchemeType</span><span class="o">.</span><span class="na">HTTP</span><span class="o">,</span>
    <span class="n">bearerFormat</span> <span class="o">=</span> <span class="s">&#34;JWT&#34;</span><span class="o">,</span>
    <span class="n">scheme</span> <span class="o">=</span> <span class="s">&#34;bearer&#34;</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringDocConfig</span> <span class="o">{</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>整合权限验证和授权</p>
<p>在<code>com.example.emos.api.config</code>包中创建<code>StpInterfaceImpl.java</code>类，这个Java类就是Sa-Token框架拦截HTTP请求之后调用的类。在这个类中，我们一共要声明两个方法分别用来查询用户实际的权限和角色。然后Sa-Token框架的<code>@SaCheckPermission</code>或者<code>@SaCheckRole</code>注解会根据查询出来的权限和角色，跟注解要求的权限或者角色做匹配。</p>
<p>TbUserDao.xml</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;searchUserPermissions&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;int&#34;</span> <span class="na">resultType=</span><span class="s">&#34;String&#34;</span><span class="nt">&gt;</span>
	SELECT DISTINCT p.permission_name
  FROM tb_user u
  JOIN tb_role r ON JSON_CONTAINS(u.role, CAST(r.id AS CHAR))
  JOIN tb_permission p ON JSON_CONTAINS(r.permissions, CAST(p.id AS CHAR))
  WHERE u.id=#{userId} AND u.status=1;
<span class="nt">&lt;/select&gt;</span>

</code></pre></td></tr></table>
</div>
</div><p>TbUserDao.java</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Mapper</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TbUserDao</span> <span class="o">{</span>
    <span class="err">……</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">searchUserPermissions</span><span class="o">(</span><span class="kt">int</span> <span class="n">userId</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><p>StpInterfaceImpl.java</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.example.emos.api.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">cn.dev33.satoken.stp.StpInterface</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.emos.api.db.dao.TbUserDao</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StpInterfaceImpl</span> <span class="kd">implements</span> <span class="n">StpInterface</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">TbUserDao</span> <span class="n">userDao</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 返回一个用户所拥有的权限集合
</span><span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getPermissionList</span><span class="o">(</span><span class="n">Object</span> <span class="n">loginId</span><span class="o">,</span> <span class="n">String</span> <span class="n">loginKey</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">userId</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">loginId</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">permissions</span> <span class="o">=</span> <span class="n">userDao</span><span class="o">.</span><span class="na">searchUserPermissions</span><span class="o">(</span><span class="n">userId</span><span class="o">);</span>
        <span class="n">ArrayList</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>
        <span class="n">list</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">permissions</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 返回一个用户所拥有的角色标识集合
</span><span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getRoleList</span><span class="o">(</span><span class="n">Object</span> <span class="n">loginId</span><span class="o">,</span> <span class="n">String</span> <span class="n">loginKey</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//因为本项目不需要用到角色判定，所以这里就返回一个空的ArrayList对象
</span><span class="c1"></span>        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>跨域配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.example.emos.api.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.CorsRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurer</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * Description: 跨域请求配置
</span><span class="cm"> *
</span><span class="cm"> * @author Rex
</span><span class="cm"> * @date 2021-09-09 12:55
</span><span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CorsConfig</span> <span class="kd">implements</span> <span class="n">WebMvcConfigurer</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addCorsMappings</span><span class="o">(</span><span class="n">CorsRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">addMapping</span><span class="o">(</span><span class="s">&#34;/**&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">allowedOriginPatterns</span><span class="o">(</span><span class="s">&#34;*&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">allowCredentials</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
        <span class="o">.</span><span class="na">allowedMethods</span><span class="o">(</span><span class="s">&#34;GET&#34;</span><span class="o">,</span> <span class="s">&#34;POST&#34;</span><span class="o">,</span> <span class="s">&#34;DELETE&#34;</span><span class="o">,</span> <span class="s">&#34;PUT&#34;</span><span class="o">,</span> <span class="s">&#34;PATCH&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">maxAge</span><span class="o">(</span><span class="n">3600</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>异常</p>
<ul>
<li>
<p>自定义业务异常</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.example.emos.api.common.dto.exception</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.EqualsAndHashCode</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * Description: 业务异常
</span><span class="cm"> *
</span><span class="cm"> * @author Rex
</span><span class="cm"> * @date 2021-09-09 14:22
</span><span class="cm"> */</span>
<span class="nd">@EqualsAndHashCode</span><span class="o">(</span><span class="n">callSuper</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmosException</span> <span class="kd">extends</span> <span class="n">RuntimeException</span><span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">msg</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">Integer</span> <span class="n">code</span> <span class="o">=</span> <span class="n">500</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">EmosException</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">){</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nf">EmosException</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">code</span><span class="o">){</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>统一异常处理</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.example.emos.api.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">cn.dev33.satoken.exception.NotLoginException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.emos.api.common.dto.Result</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.emos.api.common.exception.EmosException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.MethodArgumentNotValidException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ExceptionHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestControllerAdvice</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * Description: 统一异常处理
</span><span class="cm"> *
</span><span class="cm"> * @author Rex
</span><span class="cm"> * @date 2021-09-09 14:26
</span><span class="cm"> */</span>
<span class="nd">@Slf4j</span>
<span class="nd">@RestControllerAdvice</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GlobalExceptionHandler</span> <span class="o">{</span>

  <span class="cm">/**
</span><span class="cm">   * 处理全局异常信息
</span><span class="cm">   * @param e 全局异常
</span><span class="cm">   * @return 返回异常信息
</span><span class="cm">   */</span>
  <span class="nd">@ResponseBody</span>
  <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="o">)</span>
  <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">exceptionHandler</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
    <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;执行异常&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">error</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="cm">/**
</span><span class="cm">   * 处理后端验证失败产生的异常
</span><span class="cm">   * @param e 校验异常
</span><span class="cm">   * @return 返回异常信息
</span><span class="cm">   */</span>
  <span class="nd">@ResponseBody</span>
  <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="o">)</span>
  <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">MethodArgumentNotValidException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">methodArgumentNotValidExceptionHandler</span><span class="o">(</span><span class="n">MethodArgumentNotValidException</span> <span class="n">e</span><span class="o">){</span>
    <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;执行异常&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">().</span><span class="na">getFieldError</span><span class="o">().</span><span class="na">getDefaultMessage</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="cm">/**
</span><span class="cm">   * 处理业务异常
</span><span class="cm">   * @param e 业务异常
</span><span class="cm">   * @return 返回异常信息
</span><span class="cm">   */</span>
  <span class="nd">@ResponseBody</span>
  <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="o">)</span>
  <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">EmosException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">emosExceptionHandler</span><span class="o">(</span><span class="n">EmosException</span> <span class="n">e</span><span class="o">){</span>
    <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;执行异常&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMsg</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="cm">/**
</span><span class="cm">   * 处理未登录异常
</span><span class="cm">   * @param e 未登录异常
</span><span class="cm">   * @return 返回异常信息
</span><span class="cm">   */</span>
  <span class="nd">@ResponseBody</span>
  <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">UNAUTHORIZED</span><span class="o">)</span>
  <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">NotLoginException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">unLoginHandler</span><span class="o">(</span><span class="n">NotLoginException</span> <span class="n">e</span><span class="o">){</span>
    <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
  <span class="o">}</span>

<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>开启Java异步执行</p>
<p>为什么要给Java语言增添异步执行？其实很简单，在一个业务流程中，有时候会有一些耗费时间的分支任务，如果把这些琐碎且不重要的任务用异步来执行，那么就可以减轻当前线程的执行压力。</p>
<p>举个例子吧，例如有个电商网站为了吸引新用户注册，给出了赠送一年优酷会员的优惠。如果我们采用同步的执行方式，用户帐户开通之后，当前线程还要调用优酷系统的接口，开通会员帐户，并且充值一年会员。整个流程加起来还是挺耗费时间的，让新注册用户等待一两分钟才能收到注册成功的通知，用户心里肯定会怀疑：这是什么破电商网站，注册个会员就要好几分钟，我要是买东西不得卡成翔啊。</p>
<p>如果我们采取异步执行的方式，电商帐户开通之后，我们把开通优酷会员的任务交给其他线程去做，当前线程就不用负责了，直接返回给用户注册成功即可。当其他线程开通优酷会员之后，给用户的手机发一个短信通知即可。你看，采用了异步执行以后，新用户注册的体验更好了。其实我这里说的异步执行就是由SpringBoot自动把任务交给线程池中某个线程去执行。你以前自己创建线程分配任务的方式，也属于异步执行。只不过有了SpringBoot之后，任务的分配更加自动了。</p>
<p>关于电商网站新用户注册的例子，有的同学可能还有疑问：不用异步执行，我用消息队列来分配任务是不是也行？当然是可行的。刚才我说的异步执行陷于同一个系统中，把分支任务交给其他线程去执行。如果你用的是分布式架构，A系统想要把分支任务分配个B系统去执行，通过消息队列来分配任务完全是可行的，这也算是一种异步执行的方式。</p>
<p>创建线程池：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.example.emos.api.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.core.task.AsyncTaskExecutor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.concurrent.ThreadPoolExecutor</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * Description: 线程池配置类
</span><span class="cm"> *
</span><span class="cm"> * @author Rex
</span><span class="cm"> * @date 2021-09-09 14:46
</span><span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadPoolConfig</span> <span class="o">{</span>

  <span class="nd">@Bean</span><span class="o">(</span><span class="s">&#34;AsyncTaskExecutor&#34;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">AsyncTaskExecutor</span> <span class="nf">taskExecutor</span><span class="o">(){</span>
    <span class="n">ThreadPoolTaskExecutor</span> <span class="n">executorThread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ThreadPoolTaskExecutor</span><span class="o">();</span>
    <span class="c1">// 设置核心线程数
</span><span class="c1"></span>    <span class="n">executorThread</span><span class="o">.</span><span class="na">setCorePoolSize</span><span class="o">(</span><span class="n">8</span><span class="o">);</span>
    <span class="c1">// 设置最大线程数
</span><span class="c1"></span>    <span class="n">executorThread</span><span class="o">.</span><span class="na">setMaxPoolSize</span><span class="o">(</span><span class="n">16</span><span class="o">);</span>
    <span class="c1">// 设置队列容量
</span><span class="c1"></span>    <span class="n">executorThread</span><span class="o">.</span><span class="na">setQueueCapacity</span><span class="o">(</span><span class="n">32</span><span class="o">);</span>
    <span class="c1">// 设置线程活跃时间(秒)
</span><span class="c1"></span>    <span class="n">executorThread</span><span class="o">.</span><span class="na">setKeepAliveSeconds</span><span class="o">(</span><span class="n">60</span><span class="o">);</span>
    <span class="c1">// 设置默认线程名称
</span><span class="c1"></span>    <span class="n">executorThread</span><span class="o">.</span><span class="na">setThreadNamePrefix</span><span class="o">(</span><span class="s">&#34;task-&#34;</span><span class="o">);</span>
    <span class="c1">// 设置拒绝策略
</span><span class="c1"></span>    <span class="n">executorThread</span><span class="o">.</span><span class="na">setRejectedExecutionHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">ThreadPoolExecutor</span><span class="o">.</span><span class="na">CallerRunsPolicy</span><span class="o">());</span>
    <span class="n">executorThread</span><span class="o">.</span><span class="na">initialize</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">executorThread</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><p>开启SpringBoot异步执行</p>
<p>​	我们在项目的主类<code>EmosApiApplication.java</code>声明上面加上<code>@EnableAsync</code>注解即可。等将来我们发送邮件的时候，再去编写任务类。</p>
</li>
<li>
<p>预防XSS攻击</p>
<p>防御XSS攻击的办法很简单，那就是对所有用户的数据先做转义处理，然后再保存到数据库里面。转义之后的信息，将来被加载到网页上面就丧失了作为脚本执行的能力。比如说上面文本框里面的脚本，经过转义之后就变成了<code>&lt;script&gt;alert(&quot;HelloWorld&quot;)&lt;/script&gt;</code>这个样子。就拿<code>&lt;script&gt;</code>来说吧，它会被渲染成<code>&lt;script&gt;</code>字符串，而不是当做脚本标签来执行。</p>
<p>实现XSS内容转义</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.example.emos.api.config.xss</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">cn.hutool.core.util.StrUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">cn.hutool.http.HtmlUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">cn.hutool.json.JSONUtil</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ReadListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequestWrapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.ByteArrayInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStreamReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.StandardCharsets</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.LinkedHashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * Description: httpServletRequest请求转义封装类
</span><span class="cm"> *              转义请求返回的结果
</span><span class="cm"> * @author Rex
</span><span class="cm"> * @date 2021-09-09 15:36
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">XssHttpSevletRequestWrapper</span> <span class="kd">extends</span> <span class="n">HttpServletRequestWrapper</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">XssHttpSevletRequestWrapper</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
  <span class="o">}</span>


  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getParameter</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">StrUtil</span><span class="o">.</span><span class="na">hasEmpty</span><span class="o">(</span><span class="n">value</span><span class="o">)){</span>
      <span class="n">value</span> <span class="o">=</span> <span class="n">HtmlUtil</span><span class="o">.</span><span class="na">cleanHtmlTag</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">getParameterValues</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">values</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">getParameterValues</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">values</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">values</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">StrUtil</span><span class="o">.</span><span class="na">hasEmpty</span><span class="o">(</span><span class="n">value</span><span class="o">)){</span>
          <span class="n">value</span> <span class="o">=</span> <span class="n">HtmlUtil</span><span class="o">.</span><span class="na">cleanHtmlTag</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">values</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">values</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">[]&gt;</span> <span class="nf">getParameterMap</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">[]&gt;</span> <span class="n">parameterMap</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">getParameterMap</span><span class="o">();</span>
    <span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">[]&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;&gt;();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">parameterMap</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">key</span> <span class="o">:</span> <span class="n">parameterMap</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">values</span> <span class="o">=</span> <span class="n">parameterMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">values</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
          <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">values</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
          <span class="k">if</span> <span class="o">(!</span><span class="n">StrUtil</span><span class="o">.</span><span class="na">hasEmpty</span><span class="o">(</span><span class="n">value</span><span class="o">)){</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">HtmlUtil</span><span class="o">.</span><span class="na">cleanHtmlTag</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
          <span class="o">}</span>
          <span class="n">values</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">values</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">map</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getHeader</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">StrUtil</span><span class="o">.</span><span class="na">hasEmpty</span><span class="o">(</span><span class="n">value</span><span class="o">)){</span>
      <span class="n">value</span> <span class="o">=</span> <span class="n">HtmlUtil</span><span class="o">.</span><span class="na">cleanHtmlTag</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">ServletInputStream</span> <span class="nf">getInputStream</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">ServletInputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
    <span class="n">InputStreamReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
    <span class="n">BufferedReader</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">reader</span><span class="o">);</span>
    <span class="n">StringBuilder</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">line</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">line</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
      <span class="n">body</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
      <span class="n">line</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="n">buffer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="n">reader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="n">JSONUtil</span><span class="o">.</span><span class="na">parseObj</span><span class="o">(</span><span class="n">body</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;&gt;();</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">key</span> <span class="o">:</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">Object</span> <span class="n">value</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="n">String</span><span class="o">){</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">StrUtil</span><span class="o">.</span><span class="na">hasEmpty</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">toString</span><span class="o">())){</span>
          <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">HtmlUtil</span><span class="o">.</span><span class="na">cleanHtmlTag</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">toString</span><span class="o">()));</span>
        <span class="o">}</span>
      <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
        <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">JSONUtil</span><span class="o">.</span><span class="na">toJsonStr</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
    <span class="n">ByteArrayInputStream</span> <span class="n">bain</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayInputStream</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">));</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">ServletInputStream</span><span class="o">()</span> <span class="o">{</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isFinished</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isReady</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setReadListener</span><span class="o">(</span><span class="n">ReadListener</span> <span class="n">readListener</span><span class="o">)</span> <span class="o">{</span>

      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">int</span> <span class="nf">read</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">bain</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">};</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>过滤请求</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Java" data-lang="Java"><span class="kn">package</span> <span class="nn">com.example.emos.api.config.xss</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * Description: xss过滤器
</span><span class="cm"> *  拦截所有的HTTP请求，
</span><span class="cm"> *  然后调用上面创建的XssHttpServletRequestWrapper类
</span><span class="cm"> *
</span><span class="cm"> * @author Rex
</span><span class="cm"> * @date 2021-09-09 16:06
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">XssFilter</span> <span class="kd">implements</span> <span class="n">Filter</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="n">FilterConfig</span> <span class="n">filterConfig</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span> <span class="o">{</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">servletRequest</span><span class="o">,</span> <span class="n">ServletResponse</span> <span class="n">servletResponse</span><span class="o">,</span> <span class="n">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
    <span class="n">HttpServletRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpServletRequest</span><span class="o">)</span> <span class="n">servletRequest</span><span class="o">;</span>
    <span class="n">XssHttpSevletRequestWrapper</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XssHttpSevletRequestWrapper</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">wrapper</span><span class="o">,</span> <span class="n">servletResponse</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>自定义分页对象</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.example.emos.api.common.dto</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * Description: 自定义分页
</span><span class="cm"> *
</span><span class="cm"> * @author Rex
</span><span class="cm"> * @date 2021-09-09 16:20
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Pageination</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="n">1L</span><span class="o">;</span>

  <span class="cm">/**
</span><span class="cm">   * 总记录数
</span><span class="cm">   */</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">totalCount</span><span class="o">;</span>

  <span class="cm">/**
</span><span class="cm">   * 每页记录数
</span><span class="cm">   */</span>
  <span class="kd">private</span> <span class="n">Integer</span> <span class="n">pageSize</span><span class="o">;</span>

  <span class="cm">/**
</span><span class="cm">   * 总页数
</span><span class="cm">   */</span>
  <span class="kd">private</span> <span class="n">Integer</span> <span class="n">totalPage</span><span class="o">;</span>

  <span class="cm">/**
</span><span class="cm">   * 当前页数
</span><span class="cm">   */</span>
  <span class="kd">private</span> <span class="n">Integer</span> <span class="n">pageIndex</span><span class="o">;</span>

  <span class="cm">/**
</span><span class="cm">   * 列表数据
</span><span class="cm">   */</span>
  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Pageination</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">Long</span> <span class="n">totalCount</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">pageIndex</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">pageSize</span><span class="o">){</span>
    <span class="k">this</span><span class="o">.</span><span class="na">list</span> <span class="o">=</span> <span class="n">list</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">totalCount</span> <span class="o">=</span> <span class="n">totalCount</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">pageSize</span> <span class="o">=</span> <span class="n">pageSize</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">pageIndex</span> <span class="o">=</span> <span class="n">pageIndex</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">totalPage</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">ceil</span><span class="o">((</span><span class="kt">double</span><span class="o">)</span> <span class="n">totalCount</span> <span class="o">/</span> <span class="n">pageSize</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div></li>
</ol>


  </div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://rex0520.github.io/tags/vue/">vue</a></li>
      <li><a href="https://rex0520.github.io/tags/springboot/">SpringBoot</a></li>
      <li><a href="https://rex0520.github.io/tags/java/">java</a></li>
      <li><a href="https://rex0520.github.io/tags/mongodb/">Mongodb</a></li>
      <li><a href="https://rex0520.github.io/tags/mysql/">MySQL</a></li>
      <li><a href="https://rex0520.github.io/tags/mybatis/">mybatis</a></li>
      <li><a href="https://rex0520.github.io/tags/sa-token/">Sa-Token</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://rex0520.github.io/posts/front/tools/%E5%89%8D%E7%AB%AF%E5%B8%B8%E7%94%A8%E8%BD%AE%E5%AD%90/">
    <span class="title">« Prev Page</span>
    <br>
    <span>前端常用轮子</span>
  </a>
  <a class="next" href="https://rex0520.github.io/posts/back/microservices/dubbo/">
    <span class="title">Next Page »</span>
    <br>
    <span>Dubbo</span>
  </a>
</nav>

<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Emos项目准备 on twitter"
        href="https://twitter.com/intent/tweet/?text=Emos%e9%a1%b9%e7%9b%ae%e5%87%86%e5%a4%87&amp;url=https%3a%2f%2frex0520.github.io%2fposts%2fproj%2femos%2femos%25E9%25A1%25B9%25E7%259B%25AE%25E5%2587%2586%25E5%25A4%2587%2f&amp;hashtags=vue%2cSpringBoot%2cJava%2cMongoDB%2cMySQL%2cMyBatis%2cSa-Token">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Emos项目准备 on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frex0520.github.io%2fposts%2fproj%2femos%2femos%25E9%25A1%25B9%25E7%259B%25AE%25E5%2587%2586%25E5%25A4%2587%2f&amp;title=Emos%e9%a1%b9%e7%9b%ae%e5%87%86%e5%a4%87&amp;summary=Emos%e9%a1%b9%e7%9b%ae%e5%87%86%e5%a4%87&amp;source=https%3a%2f%2frex0520.github.io%2fposts%2fproj%2femos%2femos%25E9%25A1%25B9%25E7%259B%25AE%25E5%2587%2586%25E5%25A4%2587%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Emos项目准备 on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2frex0520.github.io%2fposts%2fproj%2femos%2femos%25E9%25A1%25B9%25E7%259B%25AE%25E5%2587%2586%25E5%25A4%2587%2f&title=Emos%e9%a1%b9%e7%9b%ae%e5%87%86%e5%a4%87">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Emos项目准备 on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frex0520.github.io%2fposts%2fproj%2femos%2femos%25E9%25A1%25B9%25E7%259B%25AE%25E5%2587%2586%25E5%25A4%2587%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Emos项目准备 on whatsapp"
        href="https://api.whatsapp.com/send?text=Emos%e9%a1%b9%e7%9b%ae%e5%87%86%e5%a4%87%20-%20https%3a%2f%2frex0520.github.io%2fposts%2fproj%2femos%2femos%25E9%25A1%25B9%25E7%259B%25AE%25E5%2587%2586%25E5%25A4%2587%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Emos项目准备 on telegram"
        href="https://telegram.me/share/url?text=Emos%e9%a1%b9%e7%9b%ae%e5%87%86%e5%a4%87&amp;url=https%3a%2f%2frex0520.github.io%2fposts%2fproj%2femos%2femos%25E9%25A1%25B9%25E7%259B%25AE%25E5%2587%2586%25E5%25A4%2587%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
<script src="https://utteranc.es/client.js" repo="Rex0520/blogcomment"
  issue-term="title" theme="github-light" crossorigin="anonymous"
  async>
  </script>

</article>
    </main>
    <footer class="footer">
    <span>&copy; 2021 <a href="https://rex0520.github.io/">Rex</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
