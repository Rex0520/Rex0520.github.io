<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Mongodb基础 | Rex</title>
<meta name="keywords" content="NoSQL" />
<meta name="description" content="Mongodb基础">
<meta name="author" content="Rex">
<link rel="canonical" href="https://rex0520.github.io/posts/nosql/mongodb/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.css" rel="preload stylesheet" as="style">
<link rel="preload" href="http://cdn.rexweb.xyz/img/20210821105340.png" as="image">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://rex0520.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://rex0520.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://rex0520.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://rex0520.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://rex0520.github.io/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.87.0" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Mongodb基础" />
<meta property="og:description" content="Mongodb基础" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rex0520.github.io/posts/nosql/mongodb/" /><meta property="og:image" content="https://cdn.rexweb.xyz/img/20210820141535.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-09T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-07-09T00:00:00&#43;00:00" /><meta property="og:site_name" content="RexHub" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://cdn.rexweb.xyz/img/20210820141535.jpg"/>

<meta name="twitter:title" content="Mongodb基础"/>
<meta name="twitter:description" content="Mongodb基础"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://rex0520.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Mongodb基础",
      "item": "https://rex0520.github.io/posts/nosql/mongodb/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Mongodb基础",
  "name": "Mongodb基础",
  "description": "Mongodb基础",
  "keywords": [
    "NoSQL"
  ],
  "articleBody": "MongoDB 简介：   MongoDB是为快速开发互联网Web应用而设计的数据库系统。 MongoDB的设许目标是极简、灵活、作为Web应用栈的一部分。 MongoDB的数据模型是面向文档的,所谓文档是- - -种类似于JSON的结构,简单理解MongoDB这个数据库中存的是各种各样的JSON。 ( BSON )   三个概念   数据库( database )\n 数据库是-个仓库,在仓库中可以存放集合。\n   集合( collection )\n 集合类似于数组,在集合中可以存放文档。\n   文档( dotument )\n 文档数据库中的最小单位,我们存储和操作的 内容都是文档。\n   基本指令   show dbs\n 显示当前的所有数据库\n   use 数据库名\n 进入指定的数据库中\n   db\n 显示当前所处的数据库\n   show collections\n 显示数据库中所有的集合\n   db..insert(doc)\n 向集合中插入一个文档\n   db..find()\n 查看数据库字段\n   插入文档 /* 向数据库插入文档\tdb..insert( ， { wirteConcern: , ordered:  } ) documents: 必填，表示需要插入的文档，可以是多个文档 writeConcern：可选项，写策略 ordered：可选，表示多个文档是否按照文档顺序写入 -- 向集合中插入一个或多个文档 -- 当我们向集合中插入文档时，如果没有给文档指定_id属性，则数据库会自动为文档添加_id， 该属性用来作为文档的唯一标识 -- _id可以自己指定，如果指定了数据库就不会再添加了，如果自己指定_id，也必须确保他的唯一性 db.collection.insertOne() -- 插入一个文档对象 db.collection.insertMany() -- 插入多个文档对象 */db.stus.insert({name:\"zhubajie\",age:28,gender:\"男\"})db.stus.insert([{name:\"shasen\",age:38,gender:\"男\"},{name:\"baigujing\",age:16,gender:\"女\"},{name:\"zhizhujing\",age:14,gender:\"女\"}])查询文档 查询选择器    运算符类型 运算符 运算符含义     —————— $eq 等于    $lt 小于   比 $lte 小于等于    $gt 大于    $gte 大于等于   较 $in 判断元素是否在指定的集合范围里    $all 判断元素是否不在指定的集合范围里    $nin 判断元素是否不在指定的范围里   —————— $ne 不等于   —————— $not 不匹配结果   逻辑 $or 有一个条件成立则匹配    $nor 所有条件都必须匹配   运算 $and 所有条件都必须匹配   —————— $exists 判断元素是否存在   其 . 子文档匹配   他 $regex 正则表达式    一般查询 /* 查询 db.collection.find() -- find()用来查询所有符合条件的文档 -- find()可以接受一个对象作为条件参数 {} 表示查询集合中所有的文档 {属性：值} 查询属性是指定的文档 -- find() 返回的是一个数组 db.collection.findOne() -- 用来查询集合中符合条件的第一个文档 -- findOne() 返回的是一个文档对象 db.collection.find({}).count() -- 查询所有结果的数量 */db.stus.insert({_id:\"hello\",name:\"zhubajie\",age:28,gender:\"男\"})db.stus.find({age:28})db.stus.findOne({age:28}).namedb.stus.find({}).count()查询其他条件 映射  字段选择：db.inventory.find({}, {‘item’: 1}) 字段排除：db.inventory.find({}, {‘item’: 0})  数组子元素选择：  db.inventory.find({}, {‘favorites.movies’: {'$slice': [1, 2]}, ‘favorites.cites’: 1}), $slice可以取俩个元素数组，分别表示跳过和限制的条数  排序  sort(): db.orders.find().sort({‘orderTime’: 1, ‘price’: 1}) 1: 升序 2: 降序  跳过和限制   skip(n):跳过n条数据\n  limit(n):限制n条数据\ne.g：orders.find().sort({‘orderTime’: -1}).limit(5).skip(5)\n  查询唯一值   distinct()：查询指定字段的唯一值\ne.g：db.users.distinct(“age”)\n  聚合查询  我们在查询时肯定回用到聚合，在MongoDB中聚合为aggregate，聚合函数主要用到$match，$group，$avg，$project，$concat，可以加\"$match\"也可以不加$match\n    表达式 描述     $sum 计算总和   $avg 计算平均值   $min 获取集合中所有文档对应值的最小值   $max 获取集合中所有文档对应值的最大值   $push 在结果文档中插入值到一个数组中。   $addToSet 在文档中插入值到一个数组中，但不创建副本。   $first 根据资源文档的排序获取第一个文档数据。   $last 根据资源文档的排序获取最后一个文档数据。    Aggregate语法  基本格式： db.collection.aggregate(pipeline, options)\n参数说明：\n   参数 类型 描述     pipeline array 一系列数据聚合操作或阶段。在版本2.6中更改：该方法仍然可以将流水线阶段作为单独的参数接受，而不是作为数组中的元素；但是如果不将管道指定为数组，则不能指定options参数。   options document 可选。aggregate()传递给聚合命令的其他选项。2.6版中的新增功能：仅当将管道指定为数组时才可用     $match和$group  相当于sql中的where和group by\n{\"$match\": {“字段”: “条件”}}，可以使用任何常用查询操作符$gt，$lt，$in等\n{\"$group\"：{\"_id\": 分组字段, “新的字段名”: “聚合操作符”}}\n 将分组字段传给$group函数的_id字段即可 分组后聚合得到结果，类似于sql中聚合函数的聚合操作符：$sum、$avg、$max、$min、$first、$last   #{\"$match\":{\"字段\":\"条件\"}}，可以使用任何常用查询操作符$gt,$lt,$in等#select_idjob,avg(sal)avg_salaryfromdb.empwheredepno=30groupbyjob;db.emp.aggregate([{\"$match\":{\"depno\":{\"$eq\":30}}},{\"$group\":{\"_id\":\"$job\",\"avg_salary\":{\"$avg\":\"$sal\"}}}])#select_idjob,avg(sal)avg_salaryfromdb.empwheredepno=30groupbyjobhavingavg_salary2000;db.emp.aggregate([{\"$match\":{\"depno\":{\"$eq\":30}}},{\"$group\":{\"_id\":\"$job\",\"avg_salary\":{\"$avg\":\"$sal\"}}},{\"$match\":{\"avg_salary\":{\"$gt\":2000}}}])$project  用于投射，即设定该键值对是否保留。1为保留，0为不保留，可对原有键值对做操作后增加自定义表达式(查询哪些要显示的列)\n {\"$project\":{\"要保留的字段名\":1,\"要去掉的字段名\":1,\"新增的字段名\":\"表达式\"}}db.emp.aggregate()#selectename,job,(sal+400)asnew_salfromdb.emp;db.emp.aggregate([{$project:{\"ename\":1,\"job\":1,\"new_sal\":{\"$add\":[\"$sal\",400]}}}])$sort和$limit和$skip  排序：{\"$sort\": {“字段名”: 1, “字段名”: -1}} #1升序，-1降序\n限制：{\"$limit\": n}\n跳过：{\"$skip\": n} #跳过多少个文档\n #例1、取平均工资最高的前两个工作db.emp.aggregate([{\"$group\":{\"_id\":\"$job\",\"avg_sal\":{\"$avg\":\"$sal\"}}},{\"$sort\":{\"avg_sal\":-1}},{\"$limit\":2}])#例2、取平均工资最高的第二个部门db.emp.aggregate([{\"$group\":{\"_id\":\"$job\",\"avg_sal\":{\"$avg\":\"$sal\"}}},{\"$sort\":{\"avg_sal\":-1}},{\"$skip\":1},{\"$limit\":1}])$sample  随机选取n个：$sample\n db.emp.aggregate([{\"$sample\":{size:3}}])修改文档 /* 修改 db.collection.update(查询条件，新对象) - update()默认情况下会使用新对象来替换旧对象(旧版本) - update()旧版本新对象不写全或是不用$set，默认情况下会报错 (Invalid key 'age': update only works with $ operators and pipelines) - 如果需要修改指定的属性，而不是替换需要使用\"修改操作符\"来完成修改 $set 可以用来修改文档中的指定属性 $unset 可以用来删除文档中的指定属性 - update()默认只修改一个 db.collection.updateMany() - 同时修改多个符合条件的文档 db.collection.updateOne() - 修改一个符合条件的文档 */db.stus.find()//替换db.stus.update({name:\"shasen\"},{age:28})db.stus.update({name:\"shasen\"},{$set:{age:28}})db.stus.update({_id:ObjectId(\"60da92e09e15000095005504\")},{$set:{name:\"shaheshang\"}})db.stus.find({_id:ObjectId(\"60da92e09e15000095005504\")})db.stus.update({_id:ObjectId(\"60da92e09e15000095005504\")},{$set:{gender:\"男\",address:\"流沙河\"}})db.stus.update({_id:ObjectId(\"60da92e09e15000095005504\")},{$unset:{address:1}})db.stus.updateMany({name:\"zhubajie\"},{$set:{address:\"zhulaozhuang\"}})db.stus.update({name:\"zhubajie\"},{$set:{address:\"zhulaozhuang\"}})db.stus.update({name:\"zhubajie\"},{$set:{address:\"hehehe\"}},{multi:true})db.stus.find()删除文档 /* 删除 db.collection.remove() -- 删除符合条件的所有文档(默认情况下会删除多个) 如果remove()第二个参数传递一个true，则只会删除一个 -- 如果值传递一个空对象作为参数，则会删除结合中的所有文档\tdb.collection.deleteOne() db.collection.deleteMany() -- remove()可以根据条件来删除文档，传递的条件方式和find()一样 db.collection.drop(); -- 删除集合 db.dropDatabase() 删除数据库 -- 数据库中的数据都并不会删除，所以删除的方法很少调用 一般会在数据中添加一个字段，来表示数据是否被删除 */db.stus.remove({_id:\"hello\"})db.stus.find()db.stus.insert([{age:28},{age:28}])db.stus.remove({age:28},true)//清空集合(性能略差)db.stus.remove({})showcollections;db.stus.drop()showdbs;db.dropDatabase();文档关系 /* 文档之间的关系 一对一(one to one) -- 夫妻(一个丈夫 对应 一个妻子) -- 在MongoDB，可以通过内嵌文档的形式来体现出一对一的关系 一对多(one to many) / 多对一(many to one) -- 父母 - 孩子 用户 - 订单 文章 - 评论 - 也可以通过内嵌文档来映射一对多的关系 多对多(many to many) -- 分类 - 商品 老师 - 学生 */ db.wifeAndHusband.insert([ { name: \"黄蓉\", husband: { name: \"郭靖\" } },{ name: \"潘金莲\", husband: { name: \"武大郎\" } } ]); db.wifeAndHusband.find() // 一对多 用户(users) 和 订单() db.users.insert([ { username: \"swk\" },{ username: \"zbj\" } ]) db.users.find() db.order.insert({ list: [\"牛肉\", \"漫画\"], user_id: ObjectId(\"60dbc477c673000085000595\") }) db.order.find() // 查找用户swk的订单 var user_id = db.users.findOne({username: \"zbj\"})._id db.order.find({user_id: user_id}) // 多对多 db.teachers.insert([ {name: \"洪七公\"}, {name: \"黄药师\"}, {name: \"龟仙人\"} ]) db.stus.insert([{ name: \"郭靖\", tech_ids: [ ObjectId(\"60dbc694c67300008500059a\"), ObjectId(\"60dbc694c67300008500059b\") ] },{ name: \"孙悟空\", tech_ids: [ ObjectId(\"60dbc694c67300008500059a\"), ObjectId(\"60dbc694c67300008500059b\"), ObjectId(\"60dbc694c67300008500059c\") ] } ]) db.teachers.find() db.stus.find() Test //17.向numbers中插入20000条数据 var arr = []; for(var i = 1; i  20000; i++){ arr.push({num: i}); } db.numbers.insert(arr) //18.查询numbers中num为500的文档 db.numbers.find({num: 500}) //19.查询numbers中num大于5000的文档 db.numbers.find({num: {$gt: 5000}}) //20.查询numbers中num小于30的文档 db.numbers.find({num: {$lt: 30}}) //21.查询numbers中num大于40小于50的文档 db.numbers.find({num: {$gt: 40, $lt: 50}}) //22.查询numbers中num大于19996的文档 db.numbers.find({num: {$gt: 19996}}) //23.查看numbers集合中的前10条数据 //limit()设置显示数据的上限 db.numbers.find({}).limit(10) //在开发时，我们绝对不会执行不带条件的查询 db.numbers.find({}) //24.查看numbers集合中的第11条到20条数据 //skip()用于跳过指定数量的数据 db.numbers.find({}).limit(10).skip(10) //25.查看numbers集合中的第21条到30条数据 db.numbers.find({}).limit(10).skip(20) //26.将dept和emp集合导入到数据库中  //27.查询工资小于2000的员工 db.emp.find({sal: {$lt: 2000}}) //28.查询工资在1000-2000之间的员工 db.emp.find({sal: {$gt: 1000, $lt: 2000}}) //29.查询工资小于1000或大于2500的员工 db.emp.find({ $or: [ {sal: {$lt: 1000}}, {sal: {$gt: 2500}} ] }); //30.查询财务部的所有员工 var deptno = db.dep.findOne({dname: \"财务部\"}).deptno db.emp.find({depno: deptno}) //31.查询销售部的所有员工 var deptno = db.dep.findOne({dname: \"销售部\"}).deptno db.emp.find({depno: deptno}) //32.查询所有mgr为7698的所有员工 db.emp.find({mgr: 7698}) //33.为所有薪资低于1000的员工增加工资400元 db.emp.updateMany({sal: {$lte: 1000}}, { $inc: { sal: 400 } } ) db.emp.find() emp:\n{ \"_id\" : ObjectId(\"5941f5bfc1bc86928f4de4ac\"), \"empno\" : 7369.0, \"ename\" : \"林冲\", \"job\" : \"职员\", \"mgr\" : 7902.0, \"hiredate\" : ISODate(\"1980-12-16T16:00:00Z\"), \"sal\" : 800.0, \"depno\" : 20.0 } { \"_id\" : ObjectId(\"5941f5bfc1bc86928f4de4ad\"), \"empno\" : 7499.0, \"ename\" : \"孙二娘\", \"job\" : \"销售\", \"mgr\" : 7698.0, \"hiredate\" : ISODate(\"1981-02-19T16:00:00Z\"), \"sal\" : 1600.0, \"comm\" : 300.0, \"depno\" : 30.0 } { \"_id\" : ObjectId(\"5941f5bfc1bc86928f4de4ae\"), \"empno\" : 7521.0, \"ename\" : \"扈三娘\", \"job\" : \"销售\", \"mgr\" : 7698.0, \"hiredate\" : ISODate(\"1981-02-21T16:00:00Z\"), \"sal\" : 1250.0, \"comm\" : 500.0, \"depno\" : 30.0 } { \"_id\" : ObjectId(\"5941f5bfc1bc86928f4de4af\"), \"empno\" : 7566.0, \"ename\" : \"卢俊义\", \"job\" : \"经理\", \"mgr\" : 7839.0, \"hiredate\" : ISODate(\"1981-04-01T16:00:00Z\"), \"sal\" : 2975.0, \"depno\" : 20.0 } { \"_id\" : ObjectId(\"5941f5bfc1bc86928f4de4b0\"), \"empno\" : 7654.0, \"ename\" : \"潘金莲\", \"job\" : \"销售\", \"mgr\" : 7698.0, \"hiredate\" : ISODate(\"1981-09-27T16:00:00Z\"), \"sal\" : 1250.0, \"comm\" : 1400.0, \"depno\" : 30.0 } { \"_id\" : ObjectId(\"5941f5bfc1bc86928f4de4b1\"), \"empno\" : 7698.0, \"ename\" : \"西门庆\", \"job\" : \"经理\", \"mgr\" : 7839.0, \"hiredate\" : ISODate(\"1981-04-30T16:00:00Z\"), \"sal\" : 2850.0, \"depno\" : 30.0 } { \"_id\" : ObjectId(\"5941f5bfc1bc86928f4de4b2\"), \"empno\" : 7782.0, \"ename\" : \"柴进\", \"job\" : \"经理\", \"mgr\" : 7839.0, \"hiredate\" : ISODate(\"1981-06-08T16:00:00Z\"), \"sal\" : 2450.0, \"depno\" : 10.0 } { \"_id\" : ObjectId(\"5941f5bfc1bc86928f4de4b3\"), \"empno\" : 7788.0, \"ename\" : \"公孙胜\", \"job\" : \"分析师\", \"mgr\" : 7566.0, \"hiredate\" : ISODate(\"1987-07-12T16:00:00Z\"), \"sal\" : 3000.0, \"depno\" : 20.0 } { \"_id\" : ObjectId(\"5941f5bfc1bc86928f4de4b4\"), \"empno\" : 7839.0, \"ename\" : \"宋江\", \"job\" : \"董事长\", \"hiredate\" : ISODate(\"1981-11-16T16:00:00Z\"), \"sal\" : 5000.0, \"depno\" : 10.0 } { \"_id\" : ObjectId(\"5941f5bfc1bc86928f4de4b5\"), \"empno\" : 7844.0, \"ename\" : \"阎婆惜\", \"job\" : \"销售\", \"mgr\" : 7698.0, \"hiredate\" : ISODate(\"1981-09-07T16:00:00Z\"), \"sal\" : 1500.0, \"comm\" : 0.0, \"depno\" : 30.0 } { \"_id\" : ObjectId(\"5941f5bfc1bc86928f4de4b6\"), \"empno\" : 7876.0, \"ename\" : \"李逵\", \"job\" : \"职员\", \"mgr\" : 7902.0, \"hiredate\" : ISODate(\"1987-07-12T16:00:00Z\"), \"sal\" : 1100.0, \"depno\" : 20.0 } { \"_id\" : ObjectId(\"5941f5bfc1bc86928f4de4b7\"), \"empno\" : 7900.0, \"ename\" : \"武松\", \"job\" : \"职员\", \"mgr\" : 7782.0, \"hiredate\" : ISODate(\"1981-12-02T16:00:00Z\"), \"sal\" : 950.0, \"depno\" : 10.0 } { \"_id\" : ObjectId(\"5941f5bfc1bc86928f4de4b8\"), \"empno\" : 7902.0, \"ename\" : \"吴用\", \"job\" : \"分析师\", \"mgr\" : 7566.0, \"hiredate\" : ISODate(\"1981-12-02T16:00:00Z\"), \"sal\" : 3000.0, \"depno\" : 20.0 } { \"_id\" : ObjectId(\"5941f5bfc1bc86928f4de4b9\"), \"empno\" : 7934.0, \"ename\" : \"鲁智深\", \"job\" : \"职员\", \"mgr\" : 7782.0, \"hiredate\" : ISODate(\"1982-01-22T16:00:00Z\"), \"sal\" : 1300.0, \"depno\" : 10.0 } dept\n{ \"_id\" : ObjectId(\"5941f2bac1bc86928f4de49a\"), \"deptno\" : 10.0, \"dname\" : \"财务部\", \"loc\" : \"北京\" } { \"_id\" : ObjectId(\"5941f2bac1bc86928f4de49b\"), \"deptno\" : 20.0, \"dname\" : \"办公室\", \"loc\" : \"上海\" } { \"_id\" : ObjectId(\"5941f2bac1bc86928f4de49c\"), \"deptno\" : 30.0, \"dname\" : \"销售部\", \"loc\" : \"广州\" } { \"_id\" : ObjectId(\"5941f2bac1bc86928f4de49d\"), \"deptno\" : 40.0, \"dname\" : \"运营部\", \"loc\" : \"深圳\" } 排序和投影 // 查询文档时，默认情况下是按照_id的值进行排列(升序) //sort()可以用来指定文档的排序的规则，sort()需要传递一个对象来指定排序规则 1表示升序 -1表示降序 //limit skip sort 可以任意的顺序进行调用 db.emp.find({}).sort({sal: -1}) //在查询时，可以在第二个参数的位置来设置查询结果的 投影 db.emp.find({}, {ename: 1, _id: 0, sal: 1}); node整合mongodb- Mongoose http://mongoosejs.com/\n连接数据库 /* 1. 下载安装Mongoose npm i mongoose --save 2. 在项目中引入mongoose var mongoose = require(\"mongoose\") 3. 连接MongoDB数据库 mongoose.connect('mongodb://localhost:27017/test', {useMongoClient: true}); - 如果端口号是默认端口号(27017) 则可以省略不写 4. 断开数据库连接(一般不需要调用) - MongoDB数据库，一般情况下，只需要连接一次，连接一次以后，除非项目停止，服务器关闭，否则连接一般不会断开 mongoose.disconnect() - 监听MongoDB数据库的连接状态 - 在Mongoose对象中，有一个属性叫做Connection，该对象表示的就是数据库连接 通过监视该对象的状态，可以来监听数据库的连接与断开 数据库连接成功的事件 mongoose.connection.once(\"open\", function()); 数据库断开的事件 mongoose.connection.once(\"close\", function()); Schema Model Document */ // 引入 var mongoose = require(\"mongoose\"); // 连接数据库 // mongoose.connect(\"mongodb://127.0.0.1/mongoose_test\", { useNewUrlParser: true } ); mongoose.connect('mongodb://localhost:27017/test', { useNewUrlParser: true, useUnifiedTopology: true }); mongoose.connection.once(\"open\", () = { console.log(\"数据库连接成功~~~~~\"); }); mongoose.connection.once(\"close\", () = { console.log(\"数据库已经断开~~~~~\"); }); //断开数据库连接 mongoose.disconnect() 使用示例 var mongoose = require(\"mongoose\"); mongoose.connect(\"mongodb://localhost/mongoose_test\", { useNewUrlParser: true, useUnifiedTopology: true, }); // 创建Schema(模式对象) var { Schema } = mongoose var stuSchema = new Schema({ name: String, age: Number, gender: { type: String, default: \"female\" }, address: String }) // 通过Schema来创建Model // Model代表的是数据库中的集合，通过Model才能对数据库进行操作 // mongoose.model(modelName, schema); // modelName 就是要映射的集合名 mongoose会自动转换成复数 var StuModel = mongoose.model(\"student\", stuSchema) // 向数据库中插入一个文档 // StuModel.create(doc, function)); StuModel.create({ name: \"白骨精\", age: 18, address: \"白骨洞\" }, (err) = { if (!err) { console.log(\"插入成功\"); } }); Model使用 var mongoose = require(\"mongoose\"); mongoose.connect(\"mongodb://localhost/mongoose_test\", { useNewUrlParser: true, useUnifiedTopology: true, }); // 创建Schema(模式对象) var { Schema } = mongoose var stuSchema = new Schema({ name: String, age: Number, gender: { type: String, default: \"female\" }, address: String }) // 通过Schema来创建Model // Model代表的是数据库中的集合，通过Model才能对数据库进行操作 // mongoose.model(modelName, schema); // modelName 就是要映射的集合名 mongoose会自动转换成复数 var StuModel = mongoose.model(\"student\", stuSchema) /* - 有了Model，我们就可以用来对数据库进行增删改查的操作了 Model.create(doc(s), [callback]) - 用来创建一个或多个文档并添加到数据库中 - 参数： doc(s) 可以是一个文档对象，也可以是一个文档对象的数组 callback 当操作完成以后调用的回调函数 查询的: Model.find(conditions, [projection], [options], [callback]) - 查询所有符合条件的文档 Model.findById(id, [projection], [options], [callback]) - 根据文档的id属性查询文档 Model.findOne([conditions], [projection], [options], [callback]) - 查询符合条件的第一个文档，总会返回一个具体的文档 conditions 查询的条件 projection 投影 需要的字段 - 两种方式 {name: 1, _id: 0} \"name -_id\" options 查询选项(skip, limit) callback 回调函数，查询结果会通过回调函数返回 回调函数必须传，如果不传回调函数，不会查询 */ // StuModel.find({}, \"name age\", { // skip: 3, // limit: 1 // }, (err, docs) = { // if (!err) { // console.log(docs); // } // }) // StuModel.findOne({}, (err, docs) = { // if (!err) { // console.log(docs); // } // }) // StuModel.findById(\"60dbdbb2ecd64b4db4605b27\", (err, docs) = { // if (!err) { // // console.log(docs); // // 通过find()查询的结果，返回的对象，就是Document，文档对象 // // Document对象是Model的实例 // console.log(docs instanceof StuModel); // } // })  // StuModel.create([{ // name: \"沙和尚\", // age: 28, // gender: \"male\", // address: \"流沙河\" // }], (error) = { // if (!error) { // console.log(arguments); // } // })  /* 修改 Model.update(conditions, doc, [options], [callback]) Model.updateMany(conditions, doc, [options], [callback]) Model.updateOne(conditions, doc, [options], [callback]) Model.replaceOne(conditions, doc, [options], [callback]) - 用来修改一个或多个文档 - 参数： conditions 查询条件 doc 修改后的对象 options 配置参数 callback 回调函数 */ // 修改唐僧的年龄为20 // StuModel.updateOne({ // name: \"唐僧\" // }, { // $set: { // age: 20 // } // }, (err) = { // if (!err) { // console.log(\"修改成功\"); // } // })  /* 删除 Model.remove(conditions, [callback]) Model.deleteOne(conditions, [callback]) Model.deleteMany(conditions, [callback]) */ // StuModel.deleteOne({ // name: \"沙和尚\" // }, // err = { // if (!err) { // console.log(\"删除成功\"); // } // })  /* Model.count(conditions, [callback]) - 统计文档的数量的 */ StuModel.count({}, function (err, count) { if (!err) { console.log(count); } }); Document使用 /* Document 和 集合中的文档一一对应，Document是Model实例 通过Model查询到结果都是Document */ // 创建一个Document var mongoose = require(\"mongoose\"); mongoose.connect(\"mongodb://localhost/mongoose_test\", { useNewUrlParser: true, useUnifiedTopology: true, }); // 创建Schema(模式对象) var { Schema } = mongoose var stuSchema = new Schema({ name: String, age: Number, gender: { type: String, default: \"female\" }, address: String }) // 通过Schema来创建Model // Model代表的是数据库中的集合，通过Model才能对数据库进行操作 // mongoose.model(modelName, schema); // modelName 就是要映射的集合名 mongoose会自动转换成复数 var StuModel = mongoose.model(\"student\", stuSchema) var stu = new StuModel({ name: \"奔波霸\", age: 48, gender: \"male\", address: \"碧波潭\" }); /* document的方法 Model#save([options], [fn]) */ // stu.save(err = { // if (!err) { // console.log(\"保存成功\"); // } // }) StuModel.findOne({}, (err, doc) = { if (!err) { /* update(update,[options],[callback]) -- 修改对象 remove([callback]) -- 删除对象 */ // console.log(doc);  // doc.update({  // $set: {  // age: 28  // }  // }, err = {  // if (!err) {  // console.log(\"修改成功\");  // }  // })  // doc.remove(err = {  // if (!err) {  // console.log(\"大师兄再见\");  // }  // })  /* get(name) -获取文档中的指定属性值 set() id - 获取文档的_id属性值 toJSON() - 转换为一个JSON字符串 toObject() - 将Document转换成普通的JSON对象 */ // console.log(doc.get(\"age\"));  // console.log(doc.age);  // doc.set(\"name\", \"猪🐖\")  // doc.name = \"哈哈哈\"  doc = doc.toObject(); delete doc.address; console.log(doc); } }) ",
  "wordCount" : "1637",
  "inLanguage": "en",
  "datePublished": "2021-07-09T00:00:00Z",
  "dateModified": "2021-07-09T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Rex"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://rex0520.github.io/posts/nosql/mongodb/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Rex",
    "logo": {
      "@type": "ImageObject",
      "url": "https://rex0520.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://rex0520.github.io/" accesskey="h" title="Home (Alt + H)">
                <img src="http://cdn.rexweb.xyz/img/20210821105340.png" alt="logo" aria-label="logo"
                    height="35">Home</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://rex0520.github.io/posts/" title="文章">
                    <span>文章</span>
                </a>
            </li>
            <li>
                <a href="https://rex0520.github.io/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="https://rex0520.github.io/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://rex0520.github.io/archives/" title="时间轴">
                    <span>时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://rex0520.github.io/search/" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header><main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://rex0520.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://rex0520.github.io/posts/">Posts</a></div>
    <h1 class="post-title">
      Mongodb基础
    </h1>
    <div class="post-description">
      Mongodb基础
    </div>
    <div class="post-meta">2021-07-09&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Rex&nbsp;|&nbsp;<a href="https://github.com/Rex0520/Rex0520.github.io" rel="noopener noreferrer" target="_blank">来这修改</a>
</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#mongodb" aria-label="MongoDB">MongoDB</a><ul>
                        
                <li>
                    <a href="#%e7%ae%80%e4%bb%8b" aria-label="简介：">简介：</a></li>
                <li>
                    <a href="#%e4%b8%89%e4%b8%aa%e6%a6%82%e5%bf%b5" aria-label="三个概念">三个概念</a></li>
                <li>
                    <a href="#%e5%9f%ba%e6%9c%ac%e6%8c%87%e4%bb%a4" aria-label="基本指令">基本指令</a></li>
                <li>
                    <a href="#%e6%8f%92%e5%85%a5%e6%96%87%e6%a1%a3" aria-label="插入文档">插入文档</a></li>
                <li>
                    <a href="#%e6%9f%a5%e8%af%a2%e6%96%87%e6%a1%a3" aria-label="查询文档">查询文档</a><ul>
                        
                <li>
                    <a href="#%e6%9f%a5%e8%af%a2%e9%80%89%e6%8b%a9%e5%99%a8" aria-label="查询选择器">查询选择器</a></li>
                <li>
                    <a href="#%e4%b8%80%e8%88%ac%e6%9f%a5%e8%af%a2" aria-label="一般查询">一般查询</a></li>
                <li>
                    <a href="#%e6%9f%a5%e8%af%a2%e5%85%b6%e4%bb%96%e6%9d%a1%e4%bb%b6" aria-label="查询其他条件">查询其他条件</a><ul>
                        
                <li>
                    <a href="#%e6%98%a0%e5%b0%84" aria-label="映射">映射</a></li>
                <li>
                    <a href="#%e6%95%b0%e7%bb%84%e5%ad%90%e5%85%83%e7%b4%a0%e9%80%89%e6%8b%a9" aria-label="数组子元素选择：">数组子元素选择：</a></li>
                <li>
                    <a href="#%e6%8e%92%e5%ba%8f" aria-label="排序">排序</a></li>
                <li>
                    <a href="#%e8%b7%b3%e8%bf%87%e5%92%8c%e9%99%90%e5%88%b6" aria-label="跳过和限制">跳过和限制</a></li>
                <li>
                    <a href="#%e6%9f%a5%e8%af%a2%e5%94%af%e4%b8%80%e5%80%bc" aria-label="查询唯一值">查询唯一值</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%81%9a%e5%90%88%e6%9f%a5%e8%af%a2" aria-label="聚合查询">聚合查询</a><ul>
                        
                <li>
                    <a href="#aggregate%e8%af%ad%e6%b3%95" aria-label="Aggregate语法">Aggregate语法</a></li>
                <li>
                    <a href="#match%e5%92%8cgroup" aria-label="$match和$group">$match和$group</a></li>
                <li>
                    <a href="#project" aria-label="$project">$project</a></li>
                <li>
                    <a href="#sort%e5%92%8climit%e5%92%8cskip" aria-label="$sort和$limit和$skip">$sort和$limit和$skip</a></li>
                <li>
                    <a href="#sample" aria-label="$sample">$sample</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e4%bf%ae%e6%94%b9%e6%96%87%e6%a1%a3" aria-label="修改文档">修改文档</a></li>
                <li>
                    <a href="#%e5%88%a0%e9%99%a4%e6%96%87%e6%a1%a3" aria-label="删除文档">删除文档</a></li>
                <li>
                    <a href="#%e6%96%87%e6%a1%a3%e5%85%b3%e7%b3%bb" aria-label="文档关系">文档关系</a></li>
                <li>
                    <a href="#test" aria-label="Test">Test</a></li>
                <li>
                    <a href="#%e6%8e%92%e5%ba%8f%e5%92%8c%e6%8a%95%e5%bd%b1" aria-label="排序和投影">排序和投影</a></li>
                <li>
                    <a href="#node%e6%95%b4%e5%90%88mongodb--mongoose" aria-label="node整合mongodb- Mongoose">node整合mongodb- Mongoose</a><ul>
                        
                <li>
                    <a href="#%e8%bf%9e%e6%8e%a5%e6%95%b0%e6%8d%ae%e5%ba%93" aria-label="连接数据库">连接数据库</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e7%a4%ba%e4%be%8b" aria-label="使用示例">使用示例</a></li>
                <li>
                    <a href="#model%e4%bd%bf%e7%94%a8" aria-label="Model使用">Model使用</a></li>
                <li>
                    <a href="#document%e4%bd%bf%e7%94%a8" aria-label="Document使用">Document使用</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="mongodb">MongoDB<a hidden class="anchor" aria-hidden="true" href="#mongodb">#</a></h1>
<h2 id="简介">简介：<a hidden class="anchor" aria-hidden="true" href="#简介">#</a></h2>
<blockquote>
<ul>
<li>MongoDB是为快速开发互联网Web应用而设计的数据库系统。</li>
<li>MongoDB的设许目标是极简、灵活、作为Web应用栈的一部分。</li>
<li>MongoDB的数据模型是面向文档的,所谓文档是- - -种类似于JSON的结构,简单理解MongoDB这个数据库中存的是各种各样的JSON。 ( BSON )</li>
</ul>
</blockquote>
<h2 id="三个概念">三个概念<a hidden class="anchor" aria-hidden="true" href="#三个概念">#</a></h2>
<ul>
<li>
<p>数据库( database )</p>
<blockquote>
<p>数据库是-个仓库,在仓库中可以存放集合。</p>
</blockquote>
</li>
<li>
<p>集合( collection )</p>
<blockquote>
<p>集合类似于数组,在集合中可以存放文档。</p>
</blockquote>
</li>
<li>
<p>文档( dotument )</p>
<blockquote>
<p>文档数据库中的最小单位,我们存储和操作的
内容都是文档。</p>
</blockquote>
</li>
</ul>
<h2 id="基本指令">基本指令<a hidden class="anchor" aria-hidden="true" href="#基本指令">#</a></h2>
<ul>
<li>
<p>show dbs</p>
<blockquote>
<p>显示当前的所有数据库</p>
</blockquote>
</li>
<li>
<p>use 数据库名</p>
<blockquote>
<p>进入指定的数据库中</p>
</blockquote>
</li>
<li>
<p>db</p>
<blockquote>
<p>显示当前所处的数据库</p>
</blockquote>
</li>
<li>
<p>show collections</p>
<blockquote>
<p>显示数据库中所有的集合</p>
</blockquote>
</li>
<li>
<p>db.<code>&lt;collection&gt;</code>.insert(doc)</p>
<blockquote>
<p>向集合中插入一个文档</p>
</blockquote>
</li>
<li>
<p>db.<code>&lt;collections&gt;</code>.find()</p>
<blockquote>
<p>查看数据库字段</p>
</blockquote>
</li>
</ul>
<h2 id="插入文档">插入文档<a hidden class="anchor" aria-hidden="true" href="#插入文档">#</a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="cm">/*
</span><span class="cm">	向数据库插入文档		
</span><span class="cm">	  db.&lt;collection&gt;.insert(
</span><span class="cm">	  	&lt;document or array of documents&gt;，
</span><span class="cm">	  	{
</span><span class="cm">	  		wirteConcern: &lt;document&gt;,
</span><span class="cm">            ordered: &lt;boolean&gt;
</span><span class="cm">	  	}
</span><span class="cm">	  )
</span><span class="cm">	  documents: 必填，表示需要插入的文档，可以是多个文档
</span><span class="cm">	  writeConcern：可选项，写策略
</span><span class="cm">	  ordered：可选，表示多个文档是否按照文档顺序写入
</span><span class="cm">			-- 向集合中插入一个或多个文档
</span><span class="cm">			-- 当我们向集合中插入文档时，如果没有给文档指定_id属性，则数据库会自动为文档添加_id，
</span><span class="cm">					该属性用来作为文档的唯一标识
</span><span class="cm">			-- _id可以自己指定，如果指定了数据库就不会再添加了，如果自己指定_id，也必须确保他的唯一性
</span><span class="cm">			
</span><span class="cm">		db.collection.insertOne()
</span><span class="cm">			-- 插入一个文档对象
</span><span class="cm">		db.collection.insertMany()
</span><span class="cm">			-- 插入多个文档对象
</span><span class="cm">*/</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="k">insert</span><span class="p">(</span><span class="err">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;zhubajie&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="p">,</span><span class="w"> </span><span class="n">gender</span><span class="p">:</span><span class="s2">&#34;男&#34;</span><span class="err">}</span><span class="p">)</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="k">insert</span><span class="p">([</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;shasen&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="mi">38</span><span class="p">,</span><span class="w"> </span><span class="n">gender</span><span class="p">:</span><span class="s2">&#34;男&#34;</span><span class="err">}</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;baigujing&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="n">gender</span><span class="p">:</span><span class="s2">&#34;女&#34;</span><span class="err">}</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;zhizhujing&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="n">gender</span><span class="p">:</span><span class="s2">&#34;女&#34;</span><span class="err">}</span><span class="w">
</span><span class="w"></span><span class="p">])</span><span class="w">
</span></code></pre></div><h2 id="查询文档">查询文档<a hidden class="anchor" aria-hidden="true" href="#查询文档">#</a></h2>
<h3 id="查询选择器">查询选择器<a hidden class="anchor" aria-hidden="true" href="#查询选择器">#</a></h3>
<table>
<thead>
<tr>
<th>运算符类型</th>
<th>运算符</th>
<th>运算符含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</td>
<td>$eq</td>
<td>等于</td>
</tr>
<tr>
<td></td>
<td>$lt</td>
<td>小于</td>
</tr>
<tr>
<td>比</td>
<td>$lte</td>
<td>小于等于</td>
</tr>
<tr>
<td></td>
<td>$gt</td>
<td>大于</td>
</tr>
<tr>
<td></td>
<td>$gte</td>
<td>大于等于</td>
</tr>
<tr>
<td>较</td>
<td>$in</td>
<td>判断元素是否在指定的集合范围里</td>
</tr>
<tr>
<td></td>
<td>$all</td>
<td>判断元素是否不在指定的集合范围里</td>
</tr>
<tr>
<td></td>
<td>$nin</td>
<td>判断元素是否不在指定的范围里</td>
</tr>
<tr>
<td>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</td>
<td>$ne</td>
<td>不等于</td>
</tr>
<tr>
<td>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</td>
<td>$not</td>
<td>不匹配结果</td>
</tr>
<tr>
<td>逻辑</td>
<td>$or</td>
<td>有一个条件成立则匹配</td>
</tr>
<tr>
<td></td>
<td>$nor</td>
<td>所有条件都必须匹配</td>
</tr>
<tr>
<td>运算</td>
<td>$and</td>
<td>所有条件都必须匹配</td>
</tr>
<tr>
<td>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</td>
<td>$exists</td>
<td>判断元素是否存在</td>
</tr>
<tr>
<td>其</td>
<td>.</td>
<td>子文档匹配</td>
</tr>
<tr>
<td>他</td>
<td>$regex</td>
<td>正则表达式</td>
</tr>
</tbody>
</table>
<h3 id="一般查询">一般查询<a hidden class="anchor" aria-hidden="true" href="#一般查询">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="cm">/*
</span><span class="cm">	查询
</span><span class="cm">			db.collection.find()
</span><span class="cm">				-- find()用来查询所有符合条件的文档
</span><span class="cm">				-- find()可以接受一个对象作为条件参数
</span><span class="cm">					{} 表示查询集合中所有的文档
</span><span class="cm">					{属性：值} 查询属性是指定的文档
</span><span class="cm">				-- find() 返回的是一个数组
</span><span class="cm">			db.collection.findOne()
</span><span class="cm">				-- 用来查询集合中符合条件的第一个文档
</span><span class="cm">				-- findOne() 返回的是一个文档对象
</span><span class="cm">			db.collection.find({}).count()
</span><span class="cm">				-- 查询所有结果的数量
</span><span class="cm">*/</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="k">insert</span><span class="p">(</span><span class="err">{</span><span class="n">_id</span><span class="p">:</span><span class="s2">&#34;hello&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="s2">&#34;zhubajie&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">:</span><span class="mi">28</span><span class="p">,</span><span class="w"> </span><span class="n">gender</span><span class="p">:</span><span class="s2">&#34;男&#34;</span><span class="err">}</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="err">{</span><span class="n">age</span><span class="p">:</span><span class="mi">28</span><span class="err">}</span><span class="p">)</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="n">findOne</span><span class="p">(</span><span class="err">{</span><span class="n">age</span><span class="p">:</span><span class="mi">28</span><span class="err">}</span><span class="p">).</span><span class="n">name</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="err">{}</span><span class="p">).</span><span class="k">count</span><span class="p">()</span><span class="w">
</span></code></pre></div><h3 id="查询其他条件">查询其他条件<a hidden class="anchor" aria-hidden="true" href="#查询其他条件">#</a></h3>
<h4 id="映射">映射<a hidden class="anchor" aria-hidden="true" href="#映射">#</a></h4>
<ul>
<li>字段选择：db.inventory.find({}, {&lsquo;item&rsquo;: 1})</li>
<li>字段排除：db.inventory.find({}, {&lsquo;item&rsquo;: 0})</li>
</ul>
<h4 id="数组子元素选择">数组子元素选择：<a hidden class="anchor" aria-hidden="true" href="#数组子元素选择">#</a></h4>
<ul>
<li>db.inventory.find({}, {&lsquo;favorites.movies&rsquo;: {'$slice': [1, 2]}, &lsquo;favorites.cites&rsquo;: 1}), $slice可以取俩个元素数组，分别表示跳过和限制的条数</li>
</ul>
<h4 id="排序">排序<a hidden class="anchor" aria-hidden="true" href="#排序">#</a></h4>
<ul>
<li>sort(): db.orders.find().sort({&lsquo;orderTime&rsquo;: 1, &lsquo;price&rsquo;: 1}) 1: 升序 2: 降序</li>
</ul>
<h4 id="跳过和限制">跳过和限制<a hidden class="anchor" aria-hidden="true" href="#跳过和限制">#</a></h4>
<ul>
<li>
<p>skip(n):跳过n条数据</p>
</li>
<li>
<p>limit(n):限制n条数据</p>
<p>e.g：orders.find().sort({&lsquo;orderTime&rsquo;: -1}).limit(5).skip(5)</p>
</li>
</ul>
<h4 id="查询唯一值">查询唯一值<a hidden class="anchor" aria-hidden="true" href="#查询唯一值">#</a></h4>
<ul>
<li>
<p>distinct()：查询指定字段的唯一值</p>
<p>e.g：db.users.distinct(&ldquo;age&rdquo;)</p>
</li>
</ul>
<h3 id="聚合查询">聚合查询<a hidden class="anchor" aria-hidden="true" href="#聚合查询">#</a></h3>
<blockquote>
<p>我们在查询时肯定回用到聚合，在MongoDB中聚合为aggregate，聚合函数主要用到$match，$group，$avg，$project，$concat，可以加&quot;$match&quot;也可以不加$match</p>
</blockquote>
<table>
<thead>
<tr>
<th>表达式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>$sum</td>
<td>计算总和</td>
</tr>
<tr>
<td>$avg</td>
<td>计算平均值</td>
</tr>
<tr>
<td>$min</td>
<td>获取集合中所有文档对应值的最小值</td>
</tr>
<tr>
<td>$max</td>
<td>获取集合中所有文档对应值的最大值</td>
</tr>
<tr>
<td>$push</td>
<td>在结果文档中插入值到一个数组中。</td>
</tr>
<tr>
<td>$addToSet</td>
<td>在文档中插入值到一个数组中，但不创建副本。</td>
</tr>
<tr>
<td>$first</td>
<td>根据资源文档的排序获取第一个文档数据。</td>
</tr>
<tr>
<td>$last</td>
<td>根据资源文档的排序获取最后一个文档数据。</td>
</tr>
</tbody>
</table>
<h4 id="aggregate语法">Aggregate语法<a hidden class="anchor" aria-hidden="true" href="#aggregate语法">#</a></h4>
<blockquote>
<p>基本格式： db.collection.aggregate(pipeline, options)</p>
<p>参数说明：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>pipeline</td>
<td>array</td>
<td>一系列数据聚合操作或阶段。在版本2.6中更改：该方法仍然可以将流水线阶段作为单独的参数接受，而不是作为数组中的元素；但是如果不将管道指定为数组，则不能指定options参数。</td>
</tr>
<tr>
<td>options</td>
<td>document</td>
<td>可选。aggregate()传递给聚合命令的其他选项。2.6版中的新增功能：仅当将管道指定为数组时才可用</td>
</tr>
</tbody>
</table>
</blockquote>
<h4 id="match和group">$match和$group<a hidden class="anchor" aria-hidden="true" href="#match和group">#</a></h4>
<blockquote>
<p>相当于sql中的where和group by</p>
<p>{&quot;$match&quot;:  {&ldquo;字段&rdquo;: &ldquo;条件&rdquo;}}，可以使用任何常用查询操作符$gt，$lt，$in等</p>
<p>{&quot;$group&quot;：{&quot;_id&quot;: 分组字段, &ldquo;新的字段名&rdquo;: &ldquo;聚合操作符&rdquo;}}</p>
<ol>
<li>将分组字段传给$group函数的_id字段即可</li>
<li>分组后聚合得到结果，类似于sql中聚合函数的聚合操作符：$sum、$avg、$max、$min、$first、$last</li>
</ol>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="o">#</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;$match&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;字段&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;条件&#34;</span><span class="err">}}，可以使用任何常用查询操作符$</span><span class="n">gt</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">lt</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">in等</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">_id</span><span class="w"> </span><span class="n">job</span><span class="p">,</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">sal</span><span class="p">)</span><span class="w"> </span><span class="n">avg_salary</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">emp</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">depno</span><span class="o">=</span><span class="mi">30</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">job</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">emp</span><span class="p">.</span><span class="k">aggregate</span><span class="p">([</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="s2">&#34;$match&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;depno&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;$eq&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="err">}}}</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="s2">&#34;$group&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;_id&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;$job&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;avg_salary&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;$avg&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;$sal&#34;</span><span class="err">}}}</span><span class="w">
</span><span class="w"></span><span class="p">])</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">_id</span><span class="w"> </span><span class="n">job</span><span class="p">,</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">sal</span><span class="p">)</span><span class="w"> </span><span class="n">avg_salary</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">emp</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">depno</span><span class="o">=</span><span class="mi">30</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">job</span><span class="w"> </span><span class="k">having</span><span class="w"> </span><span class="n">avg_salary</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2000</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">emp</span><span class="p">.</span><span class="k">aggregate</span><span class="p">([</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="s2">&#34;$match&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;depno&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;$eq&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="err">}}}</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="s2">&#34;$group&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;_id&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;$job&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;avg_salary&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;$avg&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;$sal&#34;</span><span class="err">}}}</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="s2">&#34;$match&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;avg_salary&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;$gt&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="err">}}}</span><span class="w">
</span><span class="w"></span><span class="p">])</span><span class="w">
</span></code></pre></div><p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/rex0520/resources_repository/images/20210709153836.png" alt="image-20210709153828201"  />
</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/rex0520/resources_repository/images/20210709153904.png" alt="image-20210709153904574"  />
</p>
<h4 id="project">$project<a hidden class="anchor" aria-hidden="true" href="#project">#</a></h4>
<blockquote>
<p>用于投射，即设定该键值对是否保留。1为保留，0为不保留，可对原有键值对做操作后增加自定义表达式(查询哪些要显示的列)</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="err">{</span><span class="s2">&#34;$project&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;要保留的字段名&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;要去掉的字段名&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;新增的字段名&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;表达式&#34;</span><span class="err">}}</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">emp</span><span class="p">.</span><span class="k">aggregate</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">ename</span><span class="p">,</span><span class="w"> </span><span class="n">job</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">sal</span><span class="o">+</span><span class="mi">400</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">new_sal</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">emp</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">emp</span><span class="p">.</span><span class="k">aggregate</span><span class="p">([</span><span class="err">{</span><span class="w">
</span><span class="w">	</span><span class="err">$</span><span class="n">project</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w">
</span><span class="w">		</span><span class="s2">&#34;ename&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
</span><span class="w">		</span><span class="s2">&#34;job&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
</span><span class="w">		</span><span class="s2">&#34;new_sal&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w">
</span><span class="w">			</span><span class="s2">&#34;$add&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;$sal&#34;</span><span class="p">,</span><span class="w"> </span><span class="mi">400</span><span class="p">]</span><span class="w">
</span><span class="w">		</span><span class="err">}</span><span class="w">
</span><span class="w">	</span><span class="err">}</span><span class="w">
</span><span class="w"></span><span class="err">}</span><span class="p">])</span><span class="w">
</span></code></pre></div><p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/rex0520/resources_repository/images/20210709153807.png" alt="image-20210709153758768"  />
</p>
<h4 id="sort和limit和skip">$sort和$limit和$skip<a hidden class="anchor" aria-hidden="true" href="#sort和limit和skip">#</a></h4>
<blockquote>
<p>排序：{&quot;$sort&quot;: {&ldquo;字段名&rdquo;: 1, “字段名”: -1}} #1升序，-1降序</p>
<p>限制：{&quot;$limit&quot;: n}</p>
<p>跳过：{&quot;$skip&quot;: n} #跳过多少个文档</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="o">#</span><span class="w"> </span><span class="err">例</span><span class="mi">1</span><span class="err">、取平均工资最高的前两个工作</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">emp</span><span class="p">.</span><span class="k">aggregate</span><span class="p">([</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="w">
</span><span class="w">		</span><span class="s2">&#34;$group&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;_id&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;$job&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;avg_sal&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;$avg&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;$sal&#34;</span><span class="err">}}</span><span class="w">
</span><span class="w">	</span><span class="err">}</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="w">
</span><span class="w">		</span><span class="s2">&#34;$sort&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;avg_sal&#34;</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="err">}</span><span class="w">
</span><span class="w">	</span><span class="err">}</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="w">
</span><span class="w">		</span><span class="s2">&#34;$limit&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="w">	</span><span class="err">}</span><span class="w">
</span><span class="w"></span><span class="p">])</span><span class="w">
</span><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="err">例</span><span class="mi">2</span><span class="err">、取平均工资最高的第二个部门</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">emp</span><span class="p">.</span><span class="k">aggregate</span><span class="p">([</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="w">
</span><span class="w">		</span><span class="s2">&#34;$group&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;_id&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;$job&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;avg_sal&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;$avg&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;$sal&#34;</span><span class="err">}}</span><span class="w">
</span><span class="w">	</span><span class="err">}</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="w">
</span><span class="w">		</span><span class="s2">&#34;$sort&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&#34;avg_sal&#34;</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="err">}</span><span class="w">
</span><span class="w">	</span><span class="err">}</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="w">
</span><span class="w">		</span><span class="s2">&#34;$skip&#34;</span><span class="p">:</span><span class="mi">1</span><span class="w">
</span><span class="w">	</span><span class="err">}</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="w">
</span><span class="w">		</span><span class="s2">&#34;$limit&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="w">	</span><span class="err">}</span><span class="w">
</span><span class="w"></span><span class="p">])</span><span class="w">
</span></code></pre></div><h4 id="sample">$sample<a hidden class="anchor" aria-hidden="true" href="#sample">#</a></h4>
<blockquote>
<p>随机选取n个：$sample</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="n">db</span><span class="p">.</span><span class="n">emp</span><span class="p">.</span><span class="k">aggregate</span><span class="p">([</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="s2">&#34;$sample&#34;</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="k">size</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="err">}}</span><span class="w">
</span><span class="w"></span><span class="p">])</span><span class="w">
</span></code></pre></div><h2 id="修改文档">修改文档<a hidden class="anchor" aria-hidden="true" href="#修改文档">#</a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="cm">/*
</span><span class="cm">	修改
</span><span class="cm">		db.collection.update(查询条件，新对象)
</span><span class="cm">			- update()默认情况下会使用新对象来替换旧对象(旧版本)
</span><span class="cm">			- update()旧版本新对象不写全或是不用$set，默认情况下会报错
</span><span class="cm">				(Invalid key &#39;age&#39;: update only works with $ operators and pipelines)
</span><span class="cm">			- 如果需要修改指定的属性，而不是替换需要使用&#34;修改操作符&#34;来完成修改
</span><span class="cm">				$set 可以用来修改文档中的指定属性
</span><span class="cm">				$unset 可以用来删除文档中的指定属性
</span><span class="cm">			- update()默认只修改一个
</span><span class="cm">		db.collection.updateMany()
</span><span class="cm">			- 同时修改多个符合条件的文档
</span><span class="cm">		db.collection.updateOne()
</span><span class="cm">			- 修改一个符合条件的文档
</span><span class="cm">*/</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="n">find</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">替换</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="k">update</span><span class="p">(</span><span class="err">{</span><span class="n">name</span><span class="p">:</span><span class="s2">&#34;shasen&#34;</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="err">}</span><span class="p">)</span><span class="w"> 
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="k">update</span><span class="p">(</span><span class="err">{</span><span class="n">name</span><span class="p">:</span><span class="s2">&#34;shasen&#34;</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="err">{$</span><span class="k">set</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="err">}}</span><span class="p">)</span><span class="w"> 
</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="k">update</span><span class="p">(</span><span class="err">{</span><span class="n">_id</span><span class="p">:</span><span class="w"> </span><span class="n">ObjectId</span><span class="p">(</span><span class="s2">&#34;60da92e09e15000095005504&#34;</span><span class="p">)</span><span class="err">}</span><span class="p">,</span><span class="err">{$</span><span class="k">set</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">name</span><span class="p">:</span><span class="s2">&#34;shaheshang&#34;</span><span class="err">}}</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="err">{</span><span class="n">_id</span><span class="p">:</span><span class="w"> </span><span class="n">ObjectId</span><span class="p">(</span><span class="s2">&#34;60da92e09e15000095005504&#34;</span><span class="p">)</span><span class="err">}</span><span class="p">)</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="k">update</span><span class="p">(</span><span class="err">{</span><span class="n">_id</span><span class="p">:</span><span class="w"> </span><span class="n">ObjectId</span><span class="p">(</span><span class="s2">&#34;60da92e09e15000095005504&#34;</span><span class="p">)</span><span class="err">}</span><span class="p">,</span><span class="err">{</span><span class="w">
</span><span class="w">	</span><span class="err">$</span><span class="k">set</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w">
</span><span class="w">		</span><span class="n">gender</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;男&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">		</span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;流沙河&#34;</span><span class="w">
</span><span class="w">	</span><span class="err">}</span><span class="w">
</span><span class="w"></span><span class="err">}</span><span class="p">)</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="k">update</span><span class="p">(</span><span class="err">{</span><span class="n">_id</span><span class="p">:</span><span class="w"> </span><span class="n">ObjectId</span><span class="p">(</span><span class="s2">&#34;60da92e09e15000095005504&#34;</span><span class="p">)</span><span class="err">}</span><span class="p">,</span><span class="err">{</span><span class="w">
</span><span class="w">	</span><span class="err">$</span><span class="n">unset</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w">
</span><span class="w">		</span><span class="n">address</span><span class="p">:</span><span class="mi">1</span><span class="w">
</span><span class="w">	</span><span class="err">}</span><span class="w">
</span><span class="w"></span><span class="err">}</span><span class="p">)</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="n">updateMany</span><span class="p">(</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;zhubajie&#34;</span><span class="err">}</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="w">
</span><span class="w">		</span><span class="err">$</span><span class="k">set</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w">
</span><span class="w">			</span><span class="n">address</span><span class="p">:</span><span class="s2">&#34;zhulaozhuang&#34;</span><span class="w">
</span><span class="w">		</span><span class="err">}</span><span class="w">
</span><span class="w">	</span><span class="err">}</span><span class="w">
</span><span class="w"></span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="k">update</span><span class="p">(</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;zhubajie&#34;</span><span class="err">}</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="w">
</span><span class="w">		</span><span class="err">$</span><span class="k">set</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w">
</span><span class="w">			</span><span class="n">address</span><span class="p">:</span><span class="s2">&#34;zhulaozhuang&#34;</span><span class="w">
</span><span class="w">		</span><span class="err">}</span><span class="w">
</span><span class="w">	</span><span class="err">}</span><span class="w">
</span><span class="w"></span><span class="p">)</span><span class="w">
</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="k">update</span><span class="p">(</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;zhubajie&#34;</span><span class="err">}</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="w">
</span><span class="w">		</span><span class="err">$</span><span class="k">set</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w">
</span><span class="w">			</span><span class="n">address</span><span class="p">:</span><span class="s2">&#34;hehehe&#34;</span><span class="w">
</span><span class="w">		</span><span class="err">}</span><span class="w">
</span><span class="w">	</span><span class="err">}</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="err">{</span><span class="w">
</span><span class="w">		</span><span class="n">multi</span><span class="p">:</span><span class="w"> </span><span class="k">true</span><span class="w">
</span><span class="w">	</span><span class="err">}</span><span class="w">
</span><span class="w"></span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="n">find</span><span class="p">()</span><span class="w">
</span><span class="w">
</span></code></pre></div><h2 id="删除文档">删除文档<a hidden class="anchor" aria-hidden="true" href="#删除文档">#</a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="cm">/*
</span><span class="cm">	删除
</span><span class="cm">	db.collection.remove()
</span><span class="cm">		-- 删除符合条件的所有文档(默认情况下会删除多个)
</span><span class="cm">				如果remove()第二个参数传递一个true，则只会删除一个
</span><span class="cm">		-- 如果值传递一个空对象作为参数，则会删除结合中的所有文档		
</span><span class="cm">	db.collection.deleteOne()
</span><span class="cm">	db.collection.deleteMany()
</span><span class="cm">		-- remove()可以根据条件来删除文档，传递的条件方式和find()一样
</span><span class="cm">	db.collection.drop();
</span><span class="cm">		-- 删除集合
</span><span class="cm">	db.dropDatabase() 删除数据库
</span><span class="cm">		-- 数据库中的数据都并不会删除，所以删除的方法很少调用
</span><span class="cm">			一般会在数据中添加一个字段，来表示数据是否被删除
</span><span class="cm">*/</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="err">{</span><span class="n">_id</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;hello&#34;</span><span class="err">}</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="n">find</span><span class="p">()</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="k">insert</span><span class="p">([</span><span class="err">{</span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="err">}</span><span class="p">])</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="err">{</span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">清空集合</span><span class="p">(</span><span class="err">性能略差</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="err">{}</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="k">show</span><span class="w"> </span><span class="n">collections</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">stus</span><span class="p">.</span><span class="k">drop</span><span class="p">()</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">show</span><span class="w"> </span><span class="n">dbs</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="n">dropDatabase</span><span class="p">();</span><span class="w">
</span></code></pre></div><h2 id="文档关系">文档关系<a hidden class="anchor" aria-hidden="true" href="#文档关系">#</a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="cm">/*
</span><span class="cm">	文档之间的关系
</span><span class="cm">		一对一(one to one)
</span><span class="cm">			-- 夫妻(一个丈夫 对应 一个妻子)
</span><span class="cm">			-- 在MongoDB，可以通过内嵌文档的形式来体现出一对一的关系
</span><span class="cm">		一对多(one to many) / 多对一(many to one)
</span><span class="cm">			-- 父母 - 孩子
</span><span class="cm">				 用户 - 订单
</span><span class="cm">				 文章 - 评论
</span><span class="cm">				 - 也可以通过内嵌文档来映射一对多的关系
</span><span class="cm">		多对多(many to many)
</span><span class="cm">			-- 分类 - 商品
</span><span class="cm">				 老师 - 学生
</span><span class="cm">*/</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">wifeAndHusband</span><span class="p">.</span><span class="nx">insert</span><span class="p">([</span>
	<span class="p">{</span>
		<span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;黄蓉&#34;</span><span class="p">,</span>
		<span class="nx">husband</span><span class="o">:</span> <span class="p">{</span>
			<span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;郭靖&#34;</span>
		<span class="p">}</span>
	<span class="p">},{</span>
		<span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;潘金莲&#34;</span><span class="p">,</span>
		<span class="nx">husband</span><span class="o">:</span> <span class="p">{</span>
			<span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;武大郎&#34;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">]);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">wifeAndHusband</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>
<span class="c1">// 一对多 用户(users) 和 订单()
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">insert</span><span class="p">([</span>
	<span class="p">{</span>
		<span class="nx">username</span><span class="o">:</span> <span class="s2">&#34;swk&#34;</span>
	<span class="p">},{</span>
		<span class="nx">username</span><span class="o">:</span> <span class="s2">&#34;zbj&#34;</span>
	<span class="p">}</span>
<span class="p">])</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">order</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span>
	<span class="nx">list</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;牛肉&#34;</span><span class="p">,</span> <span class="s2">&#34;漫画&#34;</span><span class="p">],</span>
	<span class="nx">user_id</span><span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;60dbc477c673000085000595&#34;</span><span class="p">)</span>
<span class="p">})</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">order</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>

<span class="c1">// 查找用户swk的订单
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">user_id</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span><span class="nx">username</span><span class="o">:</span> <span class="s2">&#34;zbj&#34;</span><span class="p">}).</span><span class="mi">_</span><span class="nx">id</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">order</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">user_id</span><span class="o">:</span> <span class="nx">user_id</span><span class="p">})</span>

<span class="c1">// 多对多
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">teachers</span><span class="p">.</span><span class="nx">insert</span><span class="p">([</span>
	<span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;洪七公&#34;</span><span class="p">},</span>
	<span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;黄药师&#34;</span><span class="p">},</span>
	<span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;龟仙人&#34;</span><span class="p">}</span>
<span class="p">])</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">stus</span><span class="p">.</span><span class="nx">insert</span><span class="p">([{</span>
		<span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;郭靖&#34;</span><span class="p">,</span>
		<span class="nx">tech_ids</span><span class="o">:</span> <span class="p">[</span>
			<span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;60dbc694c67300008500059a&#34;</span><span class="p">),</span>
			<span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;60dbc694c67300008500059b&#34;</span><span class="p">)</span>
		<span class="p">]</span>
	<span class="p">},{</span>
		<span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;孙悟空&#34;</span><span class="p">,</span>
		<span class="nx">tech_ids</span><span class="o">:</span> <span class="p">[</span>
			<span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;60dbc694c67300008500059a&#34;</span><span class="p">),</span>
			<span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;60dbc694c67300008500059b&#34;</span><span class="p">),</span>
			<span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;60dbc694c67300008500059c&#34;</span><span class="p">)</span>
		<span class="p">]</span>
	<span class="p">}</span>
<span class="p">])</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">teachers</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">stus</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>
</code></pre></div><h2 id="test">Test<a hidden class="anchor" aria-hidden="true" href="#test">#</a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">//17.向numbers中插入20000条数据
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[];</span>
<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="mi">20000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
	<span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">num</span><span class="o">:</span> <span class="nx">i</span><span class="p">});</span>
<span class="p">}</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">numbers</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">arr</span><span class="p">)</span>
<span class="c1">//18.查询numbers中num为500的文档
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">numbers</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">num</span><span class="o">:</span> <span class="mi">500</span><span class="p">})</span>
<span class="c1">//19.查询numbers中num大于5000的文档
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">numbers</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">num</span><span class="o">:</span> <span class="p">{</span><span class="nx">$gt</span><span class="o">:</span> <span class="mi">5000</span><span class="p">}})</span>
<span class="c1">//20.查询numbers中num小于30的文档
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">numbers</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">num</span><span class="o">:</span> <span class="p">{</span><span class="nx">$lt</span><span class="o">:</span> <span class="mi">30</span><span class="p">}})</span>
<span class="c1">//21.查询numbers中num大于40小于50的文档
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">numbers</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">num</span><span class="o">:</span> <span class="p">{</span><span class="nx">$gt</span><span class="o">:</span> <span class="mi">40</span><span class="p">,</span> <span class="nx">$lt</span><span class="o">:</span> <span class="mi">50</span><span class="p">}})</span>
<span class="c1">//22.查询numbers中num大于19996的文档
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">numbers</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">num</span><span class="o">:</span> <span class="p">{</span><span class="nx">$gt</span><span class="o">:</span> <span class="mi">19996</span><span class="p">}})</span>
<span class="c1">//23.查看numbers集合中的前10条数据
</span><span class="c1">//limit()设置显示数据的上限
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">numbers</span><span class="p">.</span><span class="nx">find</span><span class="p">({}).</span><span class="nx">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="c1">//在开发时，我们绝对不会执行不带条件的查询
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">numbers</span><span class="p">.</span><span class="nx">find</span><span class="p">({})</span>
<span class="c1">//24.查看numbers集合中的第11条到20条数据
</span><span class="c1">//skip()用于跳过指定数量的数据
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">numbers</span><span class="p">.</span><span class="nx">find</span><span class="p">({}).</span><span class="nx">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nx">skip</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="c1">//25.查看numbers集合中的第21条到30条数据
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">numbers</span><span class="p">.</span><span class="nx">find</span><span class="p">({}).</span><span class="nx">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nx">skip</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="c1">//26.将dept和emp集合导入到数据库中
</span><span class="c1"></span>
<span class="c1">//27.查询工资小于2000的员工
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">emp</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">sal</span><span class="o">:</span> <span class="p">{</span><span class="nx">$lt</span><span class="o">:</span> <span class="mi">2000</span><span class="p">}})</span>
<span class="c1">//28.查询工资在1000-2000之间的员工
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">emp</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">sal</span><span class="o">:</span> <span class="p">{</span><span class="nx">$gt</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="nx">$lt</span><span class="o">:</span> <span class="mi">2000</span><span class="p">}})</span>
<span class="c1">//29.查询工资小于1000或大于2500的员工
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">emp</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
	<span class="nx">$or</span><span class="o">:</span> <span class="p">[</span>
		<span class="p">{</span><span class="nx">sal</span><span class="o">:</span> <span class="p">{</span><span class="nx">$lt</span><span class="o">:</span> <span class="mi">1000</span><span class="p">}},</span>
		<span class="p">{</span><span class="nx">sal</span><span class="o">:</span> <span class="p">{</span><span class="nx">$gt</span><span class="o">:</span> <span class="mi">2500</span><span class="p">}}</span>
	<span class="p">]</span>
<span class="p">});</span>
<span class="c1">//30.查询财务部的所有员工
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">deptno</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">dep</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span><span class="nx">dname</span><span class="o">:</span> <span class="s2">&#34;财务部&#34;</span><span class="p">}).</span><span class="nx">deptno</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">emp</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">depno</span><span class="o">:</span> <span class="nx">deptno</span><span class="p">})</span>
<span class="c1">//31.查询销售部的所有员工
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">deptno</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">dep</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span><span class="nx">dname</span><span class="o">:</span> <span class="s2">&#34;销售部&#34;</span><span class="p">}).</span><span class="nx">deptno</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">emp</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">depno</span><span class="o">:</span> <span class="nx">deptno</span><span class="p">})</span>
<span class="c1">//32.查询所有mgr为7698的所有员工
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">emp</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">mgr</span><span class="o">:</span> <span class="mi">7698</span><span class="p">})</span>
<span class="c1">//33.为所有薪资低于1000的员工增加工资400元
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">emp</span><span class="p">.</span><span class="nx">updateMany</span><span class="p">({</span><span class="nx">sal</span><span class="o">:</span> <span class="p">{</span><span class="nx">$lte</span><span class="o">:</span> <span class="mi">1000</span><span class="p">}},</span> <span class="p">{</span>
			<span class="nx">$inc</span><span class="o">:</span> <span class="p">{</span>
				<span class="nx">sal</span><span class="o">:</span> <span class="mi">400</span>
			<span class="p">}</span> 
	<span class="p">}</span>
<span class="p">)</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">emp</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>
</code></pre></div><p>emp:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f5bfc1bc86928f4de4ac&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;empno&#34;</span> <span class="p">:</span> <span class="mf">7369.0</span><span class="p">,</span>
  <span class="nt">&#34;ename&#34;</span> <span class="p">:</span> <span class="s2">&#34;林冲&#34;</span><span class="p">,</span>
  <span class="nt">&#34;job&#34;</span> <span class="p">:</span> <span class="s2">&#34;职员&#34;</span><span class="p">,</span>
  <span class="nt">&#34;mgr&#34;</span> <span class="p">:</span> <span class="mf">7902.0</span><span class="p">,</span>
  <span class="nt">&#34;hiredate&#34;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&#34;1980-12-16T16:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;sal&#34;</span> <span class="p">:</span> <span class="mf">800.0</span><span class="p">,</span>
  <span class="nt">&#34;depno&#34;</span> <span class="p">:</span> <span class="mf">20.0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f5bfc1bc86928f4de4ad&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;empno&#34;</span> <span class="p">:</span> <span class="mf">7499.0</span><span class="p">,</span>
  <span class="nt">&#34;ename&#34;</span> <span class="p">:</span> <span class="s2">&#34;孙二娘&#34;</span><span class="p">,</span>
  <span class="nt">&#34;job&#34;</span> <span class="p">:</span> <span class="s2">&#34;销售&#34;</span><span class="p">,</span>
  <span class="nt">&#34;mgr&#34;</span> <span class="p">:</span> <span class="mf">7698.0</span><span class="p">,</span>
  <span class="nt">&#34;hiredate&#34;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&#34;1981-02-19T16:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;sal&#34;</span> <span class="p">:</span> <span class="mf">1600.0</span><span class="p">,</span>
  <span class="nt">&#34;comm&#34;</span> <span class="p">:</span> <span class="mf">300.0</span><span class="p">,</span>
  <span class="nt">&#34;depno&#34;</span> <span class="p">:</span> <span class="mf">30.0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f5bfc1bc86928f4de4ae&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;empno&#34;</span> <span class="p">:</span> <span class="mf">7521.0</span><span class="p">,</span>
  <span class="nt">&#34;ename&#34;</span> <span class="p">:</span> <span class="s2">&#34;扈三娘&#34;</span><span class="p">,</span>
  <span class="nt">&#34;job&#34;</span> <span class="p">:</span> <span class="s2">&#34;销售&#34;</span><span class="p">,</span>
  <span class="nt">&#34;mgr&#34;</span> <span class="p">:</span> <span class="mf">7698.0</span><span class="p">,</span>
  <span class="nt">&#34;hiredate&#34;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&#34;1981-02-21T16:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;sal&#34;</span> <span class="p">:</span> <span class="mf">1250.0</span><span class="p">,</span>
  <span class="nt">&#34;comm&#34;</span> <span class="p">:</span> <span class="mf">500.0</span><span class="p">,</span>
  <span class="nt">&#34;depno&#34;</span> <span class="p">:</span> <span class="mf">30.0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f5bfc1bc86928f4de4af&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;empno&#34;</span> <span class="p">:</span> <span class="mf">7566.0</span><span class="p">,</span>
  <span class="nt">&#34;ename&#34;</span> <span class="p">:</span> <span class="s2">&#34;卢俊义&#34;</span><span class="p">,</span>
  <span class="nt">&#34;job&#34;</span> <span class="p">:</span> <span class="s2">&#34;经理&#34;</span><span class="p">,</span>
  <span class="nt">&#34;mgr&#34;</span> <span class="p">:</span> <span class="mf">7839.0</span><span class="p">,</span>
  <span class="nt">&#34;hiredate&#34;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&#34;1981-04-01T16:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;sal&#34;</span> <span class="p">:</span> <span class="mf">2975.0</span><span class="p">,</span>
  <span class="nt">&#34;depno&#34;</span> <span class="p">:</span> <span class="mf">20.0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f5bfc1bc86928f4de4b0&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;empno&#34;</span> <span class="p">:</span> <span class="mf">7654.0</span><span class="p">,</span>
  <span class="nt">&#34;ename&#34;</span> <span class="p">:</span> <span class="s2">&#34;潘金莲&#34;</span><span class="p">,</span>
  <span class="nt">&#34;job&#34;</span> <span class="p">:</span> <span class="s2">&#34;销售&#34;</span><span class="p">,</span>
  <span class="nt">&#34;mgr&#34;</span> <span class="p">:</span> <span class="mf">7698.0</span><span class="p">,</span>
  <span class="nt">&#34;hiredate&#34;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&#34;1981-09-27T16:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;sal&#34;</span> <span class="p">:</span> <span class="mf">1250.0</span><span class="p">,</span>
  <span class="nt">&#34;comm&#34;</span> <span class="p">:</span> <span class="mf">1400.0</span><span class="p">,</span>
  <span class="nt">&#34;depno&#34;</span> <span class="p">:</span> <span class="mf">30.0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f5bfc1bc86928f4de4b1&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;empno&#34;</span> <span class="p">:</span> <span class="mf">7698.0</span><span class="p">,</span>
  <span class="nt">&#34;ename&#34;</span> <span class="p">:</span> <span class="s2">&#34;西门庆&#34;</span><span class="p">,</span>
  <span class="nt">&#34;job&#34;</span> <span class="p">:</span> <span class="s2">&#34;经理&#34;</span><span class="p">,</span>
  <span class="nt">&#34;mgr&#34;</span> <span class="p">:</span> <span class="mf">7839.0</span><span class="p">,</span>
  <span class="nt">&#34;hiredate&#34;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&#34;1981-04-30T16:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;sal&#34;</span> <span class="p">:</span> <span class="mf">2850.0</span><span class="p">,</span>
  <span class="nt">&#34;depno&#34;</span> <span class="p">:</span> <span class="mf">30.0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f5bfc1bc86928f4de4b2&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;empno&#34;</span> <span class="p">:</span> <span class="mf">7782.0</span><span class="p">,</span>
  <span class="nt">&#34;ename&#34;</span> <span class="p">:</span> <span class="s2">&#34;柴进&#34;</span><span class="p">,</span>
  <span class="nt">&#34;job&#34;</span> <span class="p">:</span> <span class="s2">&#34;经理&#34;</span><span class="p">,</span>
  <span class="nt">&#34;mgr&#34;</span> <span class="p">:</span> <span class="mf">7839.0</span><span class="p">,</span>
  <span class="nt">&#34;hiredate&#34;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&#34;1981-06-08T16:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;sal&#34;</span> <span class="p">:</span> <span class="mf">2450.0</span><span class="p">,</span>
  <span class="nt">&#34;depno&#34;</span> <span class="p">:</span> <span class="mf">10.0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f5bfc1bc86928f4de4b3&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;empno&#34;</span> <span class="p">:</span> <span class="mf">7788.0</span><span class="p">,</span>
  <span class="nt">&#34;ename&#34;</span> <span class="p">:</span> <span class="s2">&#34;公孙胜&#34;</span><span class="p">,</span>
  <span class="nt">&#34;job&#34;</span> <span class="p">:</span> <span class="s2">&#34;分析师&#34;</span><span class="p">,</span>
  <span class="nt">&#34;mgr&#34;</span> <span class="p">:</span> <span class="mf">7566.0</span><span class="p">,</span>
  <span class="nt">&#34;hiredate&#34;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&#34;1987-07-12T16:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;sal&#34;</span> <span class="p">:</span> <span class="mf">3000.0</span><span class="p">,</span>
  <span class="nt">&#34;depno&#34;</span> <span class="p">:</span> <span class="mf">20.0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f5bfc1bc86928f4de4b4&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;empno&#34;</span> <span class="p">:</span> <span class="mf">7839.0</span><span class="p">,</span>
  <span class="nt">&#34;ename&#34;</span> <span class="p">:</span> <span class="s2">&#34;宋江&#34;</span><span class="p">,</span>
  <span class="nt">&#34;job&#34;</span> <span class="p">:</span> <span class="s2">&#34;董事长&#34;</span><span class="p">,</span>
  <span class="nt">&#34;hiredate&#34;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&#34;1981-11-16T16:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;sal&#34;</span> <span class="p">:</span> <span class="mf">5000.0</span><span class="p">,</span>
  <span class="nt">&#34;depno&#34;</span> <span class="p">:</span> <span class="mf">10.0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f5bfc1bc86928f4de4b5&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;empno&#34;</span> <span class="p">:</span> <span class="mf">7844.0</span><span class="p">,</span>
  <span class="nt">&#34;ename&#34;</span> <span class="p">:</span> <span class="s2">&#34;阎婆惜&#34;</span><span class="p">,</span>
  <span class="nt">&#34;job&#34;</span> <span class="p">:</span> <span class="s2">&#34;销售&#34;</span><span class="p">,</span>
  <span class="nt">&#34;mgr&#34;</span> <span class="p">:</span> <span class="mf">7698.0</span><span class="p">,</span>
  <span class="nt">&#34;hiredate&#34;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&#34;1981-09-07T16:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;sal&#34;</span> <span class="p">:</span> <span class="mf">1500.0</span><span class="p">,</span>
  <span class="nt">&#34;comm&#34;</span> <span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
  <span class="nt">&#34;depno&#34;</span> <span class="p">:</span> <span class="mf">30.0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f5bfc1bc86928f4de4b6&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;empno&#34;</span> <span class="p">:</span> <span class="mf">7876.0</span><span class="p">,</span>
  <span class="nt">&#34;ename&#34;</span> <span class="p">:</span> <span class="s2">&#34;李逵&#34;</span><span class="p">,</span>
  <span class="nt">&#34;job&#34;</span> <span class="p">:</span> <span class="s2">&#34;职员&#34;</span><span class="p">,</span>
  <span class="nt">&#34;mgr&#34;</span> <span class="p">:</span> <span class="mf">7902.0</span><span class="p">,</span>
  <span class="nt">&#34;hiredate&#34;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&#34;1987-07-12T16:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;sal&#34;</span> <span class="p">:</span> <span class="mf">1100.0</span><span class="p">,</span>
  <span class="nt">&#34;depno&#34;</span> <span class="p">:</span> <span class="mf">20.0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f5bfc1bc86928f4de4b7&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;empno&#34;</span> <span class="p">:</span> <span class="mf">7900.0</span><span class="p">,</span>
  <span class="nt">&#34;ename&#34;</span> <span class="p">:</span> <span class="s2">&#34;武松&#34;</span><span class="p">,</span>
  <span class="nt">&#34;job&#34;</span> <span class="p">:</span> <span class="s2">&#34;职员&#34;</span><span class="p">,</span>
  <span class="nt">&#34;mgr&#34;</span> <span class="p">:</span> <span class="mf">7782.0</span><span class="p">,</span>
  <span class="nt">&#34;hiredate&#34;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&#34;1981-12-02T16:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;sal&#34;</span> <span class="p">:</span> <span class="mf">950.0</span><span class="p">,</span>
  <span class="nt">&#34;depno&#34;</span> <span class="p">:</span> <span class="mf">10.0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f5bfc1bc86928f4de4b8&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;empno&#34;</span> <span class="p">:</span> <span class="mf">7902.0</span><span class="p">,</span>
  <span class="nt">&#34;ename&#34;</span> <span class="p">:</span> <span class="s2">&#34;吴用&#34;</span><span class="p">,</span>
  <span class="nt">&#34;job&#34;</span> <span class="p">:</span> <span class="s2">&#34;分析师&#34;</span><span class="p">,</span>
  <span class="nt">&#34;mgr&#34;</span> <span class="p">:</span> <span class="mf">7566.0</span><span class="p">,</span>
  <span class="nt">&#34;hiredate&#34;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&#34;1981-12-02T16:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;sal&#34;</span> <span class="p">:</span> <span class="mf">3000.0</span><span class="p">,</span>
  <span class="nt">&#34;depno&#34;</span> <span class="p">:</span> <span class="mf">20.0</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f5bfc1bc86928f4de4b9&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;empno&#34;</span> <span class="p">:</span> <span class="mf">7934.0</span><span class="p">,</span>
  <span class="nt">&#34;ename&#34;</span> <span class="p">:</span> <span class="s2">&#34;鲁智深&#34;</span><span class="p">,</span>
  <span class="nt">&#34;job&#34;</span> <span class="p">:</span> <span class="s2">&#34;职员&#34;</span><span class="p">,</span>
  <span class="nt">&#34;mgr&#34;</span> <span class="p">:</span> <span class="mf">7782.0</span><span class="p">,</span>
  <span class="nt">&#34;hiredate&#34;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&#34;1982-01-22T16:00:00Z&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;sal&#34;</span> <span class="p">:</span> <span class="mf">1300.0</span><span class="p">,</span>
  <span class="nt">&#34;depno&#34;</span> <span class="p">:</span> <span class="mf">10.0</span>
<span class="p">}</span>

</code></pre></div><p>dept</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f2bac1bc86928f4de49a&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;deptno&#34;</span> <span class="p">:</span> <span class="mf">10.0</span><span class="p">,</span>
  <span class="nt">&#34;dname&#34;</span> <span class="p">:</span> <span class="s2">&#34;财务部&#34;</span><span class="p">,</span>
  <span class="nt">&#34;loc&#34;</span> <span class="p">:</span> <span class="s2">&#34;北京&#34;</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f2bac1bc86928f4de49b&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;deptno&#34;</span> <span class="p">:</span> <span class="mf">20.0</span><span class="p">,</span>
  <span class="nt">&#34;dname&#34;</span> <span class="p">:</span> <span class="s2">&#34;办公室&#34;</span><span class="p">,</span>
  <span class="nt">&#34;loc&#34;</span> <span class="p">:</span> <span class="s2">&#34;上海&#34;</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f2bac1bc86928f4de49c&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;deptno&#34;</span> <span class="p">:</span> <span class="mf">30.0</span><span class="p">,</span>
  <span class="nt">&#34;dname&#34;</span> <span class="p">:</span> <span class="s2">&#34;销售部&#34;</span><span class="p">,</span>
  <span class="nt">&#34;loc&#34;</span> <span class="p">:</span> <span class="s2">&#34;广州&#34;</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&#34;_id&#34;</span> <span class="p">:</span> <span class="err">ObjectId(</span><span class="s2">&#34;5941f2bac1bc86928f4de49d&#34;</span><span class="err">)</span><span class="p">,</span>
  <span class="nt">&#34;deptno&#34;</span> <span class="p">:</span> <span class="mf">40.0</span><span class="p">,</span>
  <span class="nt">&#34;dname&#34;</span> <span class="p">:</span> <span class="s2">&#34;运营部&#34;</span><span class="p">,</span>
  <span class="nt">&#34;loc&#34;</span> <span class="p">:</span> <span class="s2">&#34;深圳&#34;</span>
<span class="p">}</span>

</code></pre></div><h2 id="排序和投影">排序和投影<a hidden class="anchor" aria-hidden="true" href="#排序和投影">#</a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 查询文档时，默认情况下是按照_id的值进行排列(升序)
</span><span class="c1">//sort()可以用来指定文档的排序的规则，sort()需要传递一个对象来指定排序规则 1表示升序 -1表示降序
</span><span class="c1">//limit skip sort 可以任意的顺序进行调用
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">emp</span><span class="p">.</span><span class="nx">find</span><span class="p">({}).</span><span class="nx">sort</span><span class="p">({</span><span class="nx">sal</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">})</span>

<span class="c1">//在查询时，可以在第二个参数的位置来设置查询结果的 投影
</span><span class="c1"></span><span class="nx">db</span><span class="p">.</span><span class="nx">emp</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="p">{</span><span class="nx">ename</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">_</span><span class="nx">id</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">sal</span><span class="o">:</span> <span class="mi">1</span><span class="p">});</span>
</code></pre></div><h2 id="node整合mongodb--mongoose">node整合mongodb- Mongoose<a hidden class="anchor" aria-hidden="true" href="#node整合mongodb--mongoose">#</a></h2>
<p><a href="http://mongoosejs.com/">http://mongoosejs.com/</a></p>
<h3 id="连接数据库">连接数据库<a hidden class="anchor" aria-hidden="true" href="#连接数据库">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="cm">/*
</span><span class="cm">  1. 下载安装Mongoose
</span><span class="cm">    npm i mongoose --save
</span><span class="cm">  2. 在项目中引入mongoose
</span><span class="cm">    var mongoose = require(&#34;mongoose&#34;)
</span><span class="cm">  3. 连接MongoDB数据库
</span><span class="cm">    mongoose.connect(&#39;mongodb://localhost:27017/test&#39;, {useMongoClient: true});
</span><span class="cm">    - 如果端口号是默认端口号(27017) 则可以省略不写
</span><span class="cm">
</span><span class="cm">  4. 断开数据库连接(一般不需要调用)
</span><span class="cm">    - MongoDB数据库，一般情况下，只需要连接一次，连接一次以后，除非项目停止，服务器关闭，否则连接一般不会断开
</span><span class="cm">      mongoose.disconnect()
</span><span class="cm">  - 监听MongoDB数据库的连接状态
</span><span class="cm">    - 在Mongoose对象中，有一个属性叫做Connection，该对象表示的就是数据库连接
</span><span class="cm">      通过监视该对象的状态，可以来监听数据库的连接与断开
</span><span class="cm">
</span><span class="cm">      数据库连接成功的事件
</span><span class="cm">      mongoose.connection.once(&#34;open&#34;, function());
</span><span class="cm">
</span><span class="cm">      数据库断开的事件
</span><span class="cm">      mongoose.connection.once(&#34;close&#34;, function());
</span><span class="cm">
</span><span class="cm">      Schema
</span><span class="cm">      Model
</span><span class="cm">      Document
</span><span class="cm">*/</span>
<span class="c1">// 引入
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;mongoose&#34;</span><span class="p">);</span>
<span class="c1">// 连接数据库
</span><span class="c1">// mongoose.connect(&#34;mongodb://127.0.0.1/mongoose_test&#34;, { useNewUrlParser: true } );
</span><span class="c1"></span><span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">&#39;mongodb://localhost:27017/test&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">useNewUrlParser</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">useUnifiedTopology</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="nx">mongoose</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s2">&#34;open&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;数据库连接成功~~~~~&#34;</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">mongoose</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s2">&#34;close&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;数据库已经断开~~~~~&#34;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">//断开数据库连接
</span><span class="c1"></span><span class="nx">mongoose</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">()</span>
</code></pre></div><h3 id="使用示例">使用示例<a hidden class="anchor" aria-hidden="true" href="#使用示例">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;mongoose&#34;</span><span class="p">);</span>
<span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s2">&#34;mongodb://localhost/mongoose_test&#34;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">useNewUrlParser</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">useUnifiedTopology</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">});</span>

<span class="c1">// 创建Schema(模式对象)
</span><span class="c1"></span><span class="kd">var</span> <span class="p">{</span>
  <span class="nx">Schema</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">mongoose</span>
<span class="kd">var</span> <span class="nx">stuSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">age</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span>
  <span class="nx">gender</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">default</span><span class="o">:</span> <span class="s2">&#34;female&#34;</span>
  <span class="p">},</span>
  <span class="nx">address</span><span class="o">:</span> <span class="nb">String</span>
<span class="p">})</span>

<span class="c1">// 通过Schema来创建Model
</span><span class="c1">// Model代表的是数据库中的集合，通过Model才能对数据库进行操作
</span><span class="c1">// mongoose.model(modelName, schema);
</span><span class="c1">// modelName 就是要映射的集合名 mongoose会自动转换成复数
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">StuModel</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s2">&#34;student&#34;</span><span class="p">,</span> <span class="nx">stuSchema</span><span class="p">)</span>

<span class="c1">// 向数据库中插入一个文档
</span><span class="c1">// StuModel.create(doc, function)); 
</span><span class="c1"></span><span class="nx">StuModel</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;白骨精&#34;</span><span class="p">,</span>
  <span class="nx">age</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span>
  <span class="nx">address</span><span class="o">:</span> <span class="s2">&#34;白骨洞&#34;</span>
<span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;插入成功&#34;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div><h3 id="model使用">Model使用<a hidden class="anchor" aria-hidden="true" href="#model使用">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;mongoose&#34;</span><span class="p">);</span>
<span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s2">&#34;mongodb://localhost/mongoose_test&#34;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">useNewUrlParser</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">useUnifiedTopology</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">});</span>

<span class="c1">// 创建Schema(模式对象)
</span><span class="c1"></span><span class="kd">var</span> <span class="p">{</span>
  <span class="nx">Schema</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">mongoose</span>
<span class="kd">var</span> <span class="nx">stuSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">age</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span>
  <span class="nx">gender</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">default</span><span class="o">:</span> <span class="s2">&#34;female&#34;</span>
  <span class="p">},</span>
  <span class="nx">address</span><span class="o">:</span> <span class="nb">String</span>
<span class="p">})</span>

<span class="c1">// 通过Schema来创建Model
</span><span class="c1">// Model代表的是数据库中的集合，通过Model才能对数据库进行操作
</span><span class="c1">// mongoose.model(modelName, schema);
</span><span class="c1">// modelName 就是要映射的集合名 mongoose会自动转换成复数
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">StuModel</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s2">&#34;student&#34;</span><span class="p">,</span> <span class="nx">stuSchema</span><span class="p">)</span>

<span class="cm">/*
</span><span class="cm">  - 有了Model，我们就可以用来对数据库进行增删改查的操作了
</span><span class="cm">  Model.create(doc(s), [callback])
</span><span class="cm">  - 用来创建一个或多个文档并添加到数据库中
</span><span class="cm">  - 参数：
</span><span class="cm">    doc(s) 可以是一个文档对象，也可以是一个文档对象的数组
</span><span class="cm">    callback 当操作完成以后调用的回调函数
</span><span class="cm">  查询的:
</span><span class="cm">  Model.find(conditions, [projection], [options], [callback])
</span><span class="cm">    - 查询所有符合条件的文档
</span><span class="cm">  Model.findById(id, [projection], [options], [callback])
</span><span class="cm">    - 根据文档的id属性查询文档
</span><span class="cm">  Model.findOne([conditions], [projection], [options], [callback])
</span><span class="cm">    - 查询符合条件的第一个文档，总会返回一个具体的文档
</span><span class="cm">
</span><span class="cm">    conditions 查询的条件
</span><span class="cm">    projection 投影 需要的字段
</span><span class="cm">      - 两种方式
</span><span class="cm">          {name: 1, _id: 0}
</span><span class="cm">          &#34;name -_id&#34;
</span><span class="cm">    options 查询选项(skip, limit)
</span><span class="cm">    callback 回调函数，查询结果会通过回调函数返回
</span><span class="cm">            回调函数必须传，如果不传回调函数，不会查询
</span><span class="cm">*/</span>
<span class="c1">// StuModel.find({}, &#34;name age&#34;, {
</span><span class="c1">//   skip: 3,
</span><span class="c1">//   limit: 1
</span><span class="c1">// }, (err, docs) =&gt; {
</span><span class="c1">//   if (!err) {
</span><span class="c1">//     console.log(docs);
</span><span class="c1">//   }
</span><span class="c1">// })
</span><span class="c1">// StuModel.findOne({}, (err, docs) =&gt; {
</span><span class="c1">//   if (!err) {
</span><span class="c1">//     console.log(docs);
</span><span class="c1">//   }
</span><span class="c1">// })
</span><span class="c1">// StuModel.findById(&#34;60dbdbb2ecd64b4db4605b27&#34;, (err, docs) =&gt; {
</span><span class="c1">//   if (!err) {
</span><span class="c1">//     // console.log(docs);
</span><span class="c1">//     // 通过find()查询的结果，返回的对象，就是Document，文档对象
</span><span class="c1">//     // Document对象是Model的实例
</span><span class="c1">//     console.log(docs instanceof StuModel);
</span><span class="c1">//   }
</span><span class="c1">// })
</span><span class="c1"></span>
<span class="c1">// StuModel.create([{
</span><span class="c1">//   name: &#34;沙和尚&#34;,
</span><span class="c1">//   age: 28,
</span><span class="c1">//   gender: &#34;male&#34;,
</span><span class="c1">//   address: &#34;流沙河&#34;
</span><span class="c1">// }], (error) =&gt; {
</span><span class="c1">//   if (!error) {
</span><span class="c1">//     console.log(arguments);
</span><span class="c1">//   }
</span><span class="c1">// })
</span><span class="c1"></span>
<span class="cm">/*
</span><span class="cm">  修改
</span><span class="cm">  Model.update(conditions, doc, [options], [callback])
</span><span class="cm">  Model.updateMany(conditions, doc, [options], [callback])
</span><span class="cm">  Model.updateOne(conditions, doc, [options], [callback])
</span><span class="cm">  Model.replaceOne(conditions, doc, [options], [callback])
</span><span class="cm">    - 用来修改一个或多个文档
</span><span class="cm">    - 参数： 
</span><span class="cm">      conditions 查询条件
</span><span class="cm">      doc 修改后的对象
</span><span class="cm">      options 配置参数
</span><span class="cm">      callback 回调函数
</span><span class="cm">*/</span>

<span class="c1">// 修改唐僧的年龄为20
</span><span class="c1">// StuModel.updateOne({
</span><span class="c1">//   name: &#34;唐僧&#34;
</span><span class="c1">// }, {
</span><span class="c1">//   $set: {
</span><span class="c1">//     age: 20
</span><span class="c1">//   }
</span><span class="c1">// }, (err) =&gt; {
</span><span class="c1">//   if (!err) {
</span><span class="c1">//     console.log(&#34;修改成功&#34;);
</span><span class="c1">//   }
</span><span class="c1">// })
</span><span class="c1"></span>
<span class="cm">/*
</span><span class="cm">  删除
</span><span class="cm">  Model.remove(conditions, [callback])
</span><span class="cm">  Model.deleteOne(conditions, [callback])
</span><span class="cm">  Model.deleteMany(conditions, [callback])
</span><span class="cm"> */</span>

<span class="c1">// StuModel.deleteOne({
</span><span class="c1">//     name: &#34;沙和尚&#34;
</span><span class="c1">//   },
</span><span class="c1">//   err =&gt; {
</span><span class="c1">//     if (!err) {
</span><span class="c1">//       console.log(&#34;删除成功&#34;);
</span><span class="c1">//     }
</span><span class="c1">//   })
</span><span class="c1"></span>
<span class="cm">/*
</span><span class="cm">  Model.count(conditions, [callback])
</span><span class="cm">    - 统计文档的数量的
</span><span class="cm">*/</span>
<span class="nx">StuModel</span><span class="p">.</span><span class="nx">count</span><span class="p">({},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">count</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div><h3 id="document使用">Document使用<a hidden class="anchor" aria-hidden="true" href="#document使用">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="cm">/*
</span><span class="cm">  Document 和 集合中的文档一一对应，Document是Model实例
</span><span class="cm">    通过Model查询到结果都是Document
</span><span class="cm">*/</span>
<span class="c1">// 创建一个Document
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;mongoose&#34;</span><span class="p">);</span>
<span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s2">&#34;mongodb://localhost/mongoose_test&#34;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">useNewUrlParser</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">useUnifiedTopology</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">});</span>

<span class="c1">// 创建Schema(模式对象)
</span><span class="c1"></span><span class="kd">var</span> <span class="p">{</span>
  <span class="nx">Schema</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">mongoose</span>
<span class="kd">var</span> <span class="nx">stuSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">age</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span>
  <span class="nx">gender</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">default</span><span class="o">:</span> <span class="s2">&#34;female&#34;</span>
  <span class="p">},</span>
  <span class="nx">address</span><span class="o">:</span> <span class="nb">String</span>
<span class="p">})</span>
<span class="c1">// 通过Schema来创建Model
</span><span class="c1">// Model代表的是数据库中的集合，通过Model才能对数据库进行操作
</span><span class="c1">// mongoose.model(modelName, schema);
</span><span class="c1">// modelName 就是要映射的集合名 mongoose会自动转换成复数
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">StuModel</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s2">&#34;student&#34;</span><span class="p">,</span> <span class="nx">stuSchema</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">stu</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StuModel</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;奔波霸&#34;</span><span class="p">,</span>
  <span class="nx">age</span><span class="o">:</span> <span class="mi">48</span><span class="p">,</span>
  <span class="nx">gender</span><span class="o">:</span> <span class="s2">&#34;male&#34;</span><span class="p">,</span>
  <span class="nx">address</span><span class="o">:</span> <span class="s2">&#34;碧波潭&#34;</span>
<span class="p">});</span>
<span class="cm">/*
</span><span class="cm">  document的方法
</span><span class="cm">    Model#save([options], [fn])
</span><span class="cm">*/</span>
<span class="c1">// stu.save(err =&gt; {
</span><span class="c1">//   if (!err) {
</span><span class="c1">//     console.log(&#34;保存成功&#34;);
</span><span class="c1">//   }
</span><span class="c1">// })
</span><span class="c1"></span><span class="nx">StuModel</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/*
</span><span class="cm">      update(update,[options],[callback])
</span><span class="cm">        -- 修改对象
</span><span class="cm">      remove([callback])
</span><span class="cm">        -- 删除对象
</span><span class="cm">    */</span>
    <span class="c1">// console.log(doc);
</span><span class="c1"></span>    <span class="c1">// doc.update({
</span><span class="c1"></span>    <span class="c1">//   $set: {
</span><span class="c1"></span>    <span class="c1">//     age: 28
</span><span class="c1"></span>    <span class="c1">//   }
</span><span class="c1"></span>    <span class="c1">// }, err =&gt; {
</span><span class="c1"></span>    <span class="c1">//   if (!err) {
</span><span class="c1"></span>    <span class="c1">//     console.log(&#34;修改成功&#34;);
</span><span class="c1"></span>    <span class="c1">//   }
</span><span class="c1"></span>    <span class="c1">// })
</span><span class="c1"></span>    <span class="c1">// doc.remove(err =&gt; {
</span><span class="c1"></span>    <span class="c1">//   if (!err) {
</span><span class="c1"></span>    <span class="c1">//     console.log(&#34;大师兄再见&#34;);
</span><span class="c1"></span>    <span class="c1">//   }
</span><span class="c1"></span>    <span class="c1">// })
</span><span class="c1"></span>    <span class="cm">/*
</span><span class="cm">      get(name)
</span><span class="cm">        -获取文档中的指定属性值
</span><span class="cm">      set()
</span><span class="cm">      id
</span><span class="cm">        - 获取文档的_id属性值
</span><span class="cm">      toJSON()
</span><span class="cm">        - 转换为一个JSON字符串
</span><span class="cm">      toObject()
</span><span class="cm">        - 将Document转换成普通的JSON对象
</span><span class="cm">      
</span><span class="cm">    */</span>
    <span class="c1">// console.log(doc.get(&#34;age&#34;));
</span><span class="c1"></span>    <span class="c1">// console.log(doc.age);
</span><span class="c1"></span>    <span class="c1">// doc.set(&#34;name&#34;, &#34;猪🐖&#34;)
</span><span class="c1"></span>    <span class="c1">// doc.name = &#34;哈哈哈&#34;
</span><span class="c1"></span>
    <span class="nx">doc</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">toObject</span><span class="p">();</span>
    <span class="k">delete</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">address</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>

  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://rex0520.github.io/tags/nosql/">NoSQL</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://rex0520.github.io/posts/back/java/microservices/dubbo%E5%9F%BA%E7%A1%80/">
    <span class="title">« Prev Page</span>
    <br>
    <span>Dubbo基础</span>
  </a>
  <a class="next" href="https://rex0520.github.io/posts/back/java/microservices/docker%E5%9F%BA%E7%A1%80/">
    <span class="title">Next Page »</span>
    <br>
    <span>Docker基础</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Mongodb基础 on twitter"
        href="https://twitter.com/intent/tweet/?text=Mongodb%e5%9f%ba%e7%a1%80&amp;url=https%3a%2f%2frex0520.github.io%2fposts%2fnosql%2fmongodb%2f&amp;hashtags=NoSQL">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Mongodb基础 on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frex0520.github.io%2fposts%2fnosql%2fmongodb%2f&amp;title=Mongodb%e5%9f%ba%e7%a1%80&amp;summary=Mongodb%e5%9f%ba%e7%a1%80&amp;source=https%3a%2f%2frex0520.github.io%2fposts%2fnosql%2fmongodb%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Mongodb基础 on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2frex0520.github.io%2fposts%2fnosql%2fmongodb%2f&title=Mongodb%e5%9f%ba%e7%a1%80">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Mongodb基础 on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frex0520.github.io%2fposts%2fnosql%2fmongodb%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Mongodb基础 on whatsapp"
        href="https://api.whatsapp.com/send?text=Mongodb%e5%9f%ba%e7%a1%80%20-%20https%3a%2f%2frex0520.github.io%2fposts%2fnosql%2fmongodb%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Mongodb基础 on telegram"
        href="https://telegram.me/share/url?text=Mongodb%e5%9f%ba%e7%a1%80&amp;url=https%3a%2f%2frex0520.github.io%2fposts%2fnosql%2fmongodb%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
<script src="https://utteranc.es/client.js" repo="Rex0520/blogcomment"
  issue-term="title" theme="github-light" crossorigin="anonymous"
  async>
  </script>

</article>
    </main>
    
<footer class="footer">
  <span>&copy; 2021 <a href="https://rex0520.github.io/">Rex</a></span>
  <span>
    Powered by
    <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
    <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
  </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
    <path d="M12 6H0l6-6z" />
  </svg>
</a>

<script>
  let menu = document.getElementById('menu')
  menu.scrollLeft = localStorage.getItem("menu-scroll-position");
  menu.onscroll = function () {
    localStorage.setItem("menu-scroll-position", menu.scrollLeft);
  }

  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener("click", function (e) {
      e.preventDefault();
      var id = this.getAttribute("href").substr(1);
      if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
          behavior: "smooth"
        });
      } else {
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
      }
      if (id === "top") {
        history.replaceState(null, null, " ");
      } else {
        history.pushState(null, null, `#${id}`);
      }
    });
  });

</script>
<script>
  var mybutton = document.getElementById("top-link");
  window.onscroll = function () {
    if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
      mybutton.style.visibility = "visible";
      mybutton.style.opacity = "1";
    } else {
      mybutton.style.visibility = "hidden";
      mybutton.style.opacity = "0";
    }
  };

</script>
<script>
  document.getElementById("theme-toggle").addEventListener("click", () => {
    if (document.body.className.includes("dark")) {
      document.body.classList.remove('dark');
      localStorage.setItem("pref-theme", 'light');
    } else {
      document.body.classList.add('dark');
      localStorage.setItem("pref-theme", 'dark');
    }
  })

</script>
<script>
  document.querySelectorAll('pre > code').forEach((codeblock) => {
    const container = codeblock.parentNode.parentNode;

    const copybutton = document.createElement('button');
    copybutton.classList.add('copy-code');
    copybutton.innerText = 'copy';

    function copyingDone() {
      copybutton.innerText = 'copied!';
      setTimeout(() => {
        copybutton.innerText = 'copy';
      }, 2000);
    }

    copybutton.addEventListener('click', (cb) => {
      if ('clipboard' in navigator) {
        navigator.clipboard.writeText(codeblock.textContent);
        copyingDone();
        return;
      }

      const range = document.createRange();
      range.selectNodeContents(codeblock);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand('copy');
        copyingDone();
      } catch (e) { };
      selection.removeRange(range);
    });

    if (container.classList.contains("highlight")) {
      container.appendChild(copybutton);
    } else if (container.parentNode.firstChild == container) {
      
    } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
      
      codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
    } else {
      
      codeblock.parentNode.appendChild(copybutton);
    }
  });
</script>

<script src="/assets/js/mermaid.min.js"></script>
<script>
  
  
  const mermaidKeywords = [
    "graph TD",
    "graph TB",
    "graph BT",
    "graph RL",
    "graph LR",
    "sequenceDiagram",
    "gantt",
    "classDiagram",
    "gitGraph",
    "erDiagram",
    "journey"
  ];
  var col = document.querySelector('.language-fallback');
  var htmlCollection = document.getElementsByClassName('language-fallback')
  console.log(col)
  console.log(htmlCollection)
  Array.prototype.slice.call(htmlCollection)
  console.log(Array.prototype.slice.call(htmlCollection))
  Array.from(htmlCollection).forEach(ele => {
    var graphDefinition = ele.innerText;
    if (mermaidKeywords.some((keyword) => graphDefinition.startsWith(keyword))) {
      ele.parentElement.parentElement.outerHTML = `<div class="mermaid">${ele.innerText}</div>`
    }
  })
  Array.from(document.getElementsByClassName('language-mermaid')).forEach(ele => {
    ele.parentElement.outerHTML = `<div class="mermaid">${ele.innerText}</div>`
  })
</script>
<style>
   
  .mermaid svg {
    display: block;
    margin: auto;
  }
</style></body>

</html>
