<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Rabbitmq使用 | Rex</title>
<meta name="keywords" content="微服务" />
<meta name="description" content="Rabbitmq使用">
<meta name="author" content="Rex">
<link rel="canonical" href="https://rex0520.github.io/posts/back/java/microservices/rabbitmq/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.css" rel="preload stylesheet" as="style">
<link rel="preload" href="http://cdn.rexweb.xyz/img/20210821105340.png" as="image">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://rex0520.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://rex0520.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://rex0520.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://rex0520.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://rex0520.github.io/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.87.0" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Rabbitmq使用" />
<meta property="og:description" content="Rabbitmq使用" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rex0520.github.io/posts/back/java/microservices/rabbitmq/" /><meta property="og:image" content="https://cdn.rexweb.xyz/img/20210820141535.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-21T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-06-21T00:00:00&#43;00:00" /><meta property="og:site_name" content="RexHub" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://cdn.rexweb.xyz/img/20210820141535.jpg"/>

<meta name="twitter:title" content="Rabbitmq使用"/>
<meta name="twitter:description" content="Rabbitmq使用"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://rex0520.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Rabbitmq使用",
      "item": "https://rex0520.github.io/posts/back/java/microservices/rabbitmq/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Rabbitmq使用",
  "name": "Rabbitmq使用",
  "description": "Rabbitmq使用",
  "keywords": [
    "微服务"
  ],
  "articleBody": "RabbitMQ RabbitMQ简介 核心思想  接受并转发消息。\n producer: P queue: queue_name Consumer: C 消息队列：  业务无关 FIFO 容灾 性能  特点：  开源、跨语言 Erlang语言编写 应用广泛 社区活跃、API丰富  AMBQ协议  Advanced Message Queue Protocol   RabbitMQ核心概念  Server：服务 connection：与Server建立连接 channel：信道，几乎所有的操作都在信道上进行，客户端可以建立多个信道 message：消息，有properties和body组成 virtual host：虚拟主机，顶层隔离。同一个虚拟主机下，不能有重复的交换机和queue Exchange：交换机，接收生产者的消息的，然后根据指定的路由器去把消息转发到锁绑定的队列上 binding：绑定交换机和队列 routing key：路由键，路由规则，虚拟机可以用它来确定这个消息如何进行一个路由 queue：队列，消费者只需要监听队列来消费信息，不需要关注消息来自于哪个Exchange Exchange和Message Queue存在着绑定的关系，一个Exchange可以绑定多个消息队列 消息流转过程      RabbitMQ常用命令 systemctl start rabbitmq-server # 启动rabbitmq rabbitmqctl status # 查看状态 RabbitMQ后台管理  http://1.117.91.88:15672/#/connections rabbitmq management\n RabbitMQ应用 第一个java应用 Hello world   导入依赖\n   com.rabbitmq amqp-client 5.8.0   org.slf4j slf4j-nop 1.7.29      Send.java\n  package helloworld; import com.rabbitmq.client.Channel; import com.rabbitmq.client.Connection; import com.rabbitmq.client.ConnectionFactory; import java.io.IOException; import java.util.concurrent.TimeoutException; /** * @Description: Hello world发送类，连接到RabbitMQ服务端， * 然后发送一条消息，然后退出。 * @Author: Rex * @Create: 2021-06-16 12:54 */ public class Send { private final static String QUEUE_NAME = \"hello\"; public static void main(String[] args) throws IOException, TimeoutException { // 创建连接工厂  ConnectionFactory factory = new ConnectionFactory(); // 设置RabbitMQ地址  factory.setHost(\"1.117.91.88\"); factory.setUsername(\"admin\"); factory.setPassword(\"admin\"); // 建立连接  Connection conn = factory.newConnection(); // 获得信道  Channel channel = conn.createChannel(); // 声明队列  channel.queueDeclare(QUEUE_NAME, false, false, false, null); // 发布消息  String message = \"Hello rex!\"; channel.basicPublish(\"\", QUEUE_NAME, null, message.getBytes(\"UTF-8\")); System.out.println(\"发送了消息：\" + message); // 关闭连接  channel.close(); conn.close(); } }     Resv.java\n  package helloworld; import com.rabbitmq.client.*; import java.io.IOException; import java.util.concurrent.TimeoutException; /** * @Description: 接受消息，并打印，持续运行 * @Author: Rex * @Create: 2021-06-16 13:11 */ public class Recv { private final static String QUEUE_NAME = \"hello\"; public static void main(String[] args) throws IOException, TimeoutException { // 创建连接工厂  ConnectionFactory factory = new ConnectionFactory(); // 设置RabbitMQ地址  factory.setHost(\"1.117.91.88\"); factory.setUsername(\"admin\"); factory.setPassword(\"admin\"); // 建立连接  Connection conn = factory.newConnection(); // 获得信道  Channel channel = conn.createChannel(); // 声明队列  channel.queueDeclare(QUEUE_NAME, false, false, false, null); // 接受消息  channel.basicConsume(QUEUE_NAME, true, new DefaultConsumer(channel){ @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { String message = new String(body, \"UTF-8\"); System.out.println(\"接收到了消息：\" + message); } }); } }     控制台\n  Send 发送了消息：Hello rex! Recv 接收到了消息：Hello rex!     多个消费者平均分配 NewTask.java\npackage workqueues; import com.rabbitmq.client.*; import java.io.IOException; import java.util.concurrent.TimeoutException; /** * @Description: 消费者，接受前面的批量消息 * @Author: Rex * @Create: 2021-06-16 14:23 */ public class Worker { private final static String TASK_QUEUE_NAME = \"task_queue\"; public static void main(String[] args) throws IOException, TimeoutException { // 创建连接工厂  ConnectionFactory factory = new ConnectionFactory(); // 设置RabbitMQ地址  factory.setHost(\"1.117.91.88\"); factory.setUsername(\"admin\"); factory.setPassword(\"admin\"); // 建立连接  Connection conn = factory.newConnection(); // 获得信道  Channel channel = conn.createChannel(); // 声明队列  channel.basicQos(1); channel.queueDeclare(TASK_QUEUE_NAME, true, false, false, null); System.out.println(\"开始接收消息\"); channel.basicConsume(TASK_QUEUE_NAME, false, new DefaultConsumer(channel){ @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { String message = new String(body, \"UTF-8\"); System.out.println(\"收到了消息：\" + message); try { doWork(message); } finally { System.out.println(\"完成消息处理\"); channel.basicAck(envelope.getDeliveryTag(), false); } } }); } private static void doWork(String task){ char[] chars = task.toCharArray(); for (char ch : chars) { if (ch == '.'){ try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); } } } } } Worker\npackage workqueues; import com.rabbitmq.client.*; import java.io.IOException; import java.util.concurrent.TimeoutException; /** * @Description: 消费者，接受前面的批量消息 * @Author: Rex * @Create: 2021-06-16 14:23 */ public class Worker { private final static String TASK_QUEUE_NAME = \"task_queue\"; public static void main(String[] args) throws IOException, TimeoutException { // 创建连接工厂  ConnectionFactory factory = new ConnectionFactory(); // 设置RabbitMQ地址  factory.setHost(\"1.117.91.88\"); factory.setUsername(\"admin\"); factory.setPassword(\"admin\"); // 建立连接  Connection conn = factory.newConnection(); // 获得信道  Channel channel = conn.createChannel(); // 声明队列  channel.basicQos(1); channel.queueDeclare(TASK_QUEUE_NAME, true, false, false, null); System.out.println(\"开始接收消息\"); channel.basicConsume(TASK_QUEUE_NAME, false, new DefaultConsumer(channel){ @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { String message = new String(body, \"UTF-8\"); System.out.println(\"收到了消息：\" + message); try { doWork(message); } finally { System.out.println(\"完成消息处理\"); channel.basicAck(envelope.getDeliveryTag(), false); } } }); } private static void doWork(String task){ char[] chars = task.toCharArray(); for (char ch : chars) { if (ch == '.'){ try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); } } } } } 控制台\nNewTask 发送了消息：message 0... 发送了消息：message 1 发送了消息：message 2... 发送了消息：message 3 发送了消息：message 4... 发送了消息：message 5 发送了消息：message 6... 发送了消息：message 7 发送了消息：message 8... 发送了消息：message 9 Worker(1) 开始接收消息 收到了消息：message 0... 完成消息处理 收到了消息：message 5 完成消息处理 收到了消息：message 7 完成消息处理 收到了消息：message 8... 完成消息处理 Worker(2) 开始接收消息 收到了消息：message 1 完成消息处理 收到了消息：message 3 完成消息处理 收到了消息：message 4... 完成消息处理 收到了消息：message 9 完成消息处理 Worker(3) 开始接收消息 收到了消息：message 2... 完成消息处理 收到了消息：message 6... 完成消息处理 交换机 交换机工作模式   fanout\n 广播，这种模式只需要将队列绑定到交换机上即可，是不需要设置路由键的\n EmitLog.java\npackage fanout; import com.rabbitmq.client.BuiltinExchangeType; import com.rabbitmq.client.Channel; import com.rabbitmq.client.Connection; import com.rabbitmq.client.ConnectionFactory; import java.io.IOException; import java.nio.charset.StandardCharsets; import java.util.concurrent.Exchanger; import java.util.concurrent.TimeoutException; /** * @Description: 发送日志信息 * @Author: Rex * @Create: 2021-06-17 15:58 */ public class EmitLog { private static final String EXCHANGE_NAME = \"logs\"; public static void main(String[] args) throws IOException, TimeoutException { ConnectionFactory factory = new ConnectionFactory(); factory.setHost(\"1.117.91.88\"); factory.setUsername(\"admin\"); factory.setPassword(\"admin\"); Connection conn = factory.newConnection(); Channel channel = conn.createChannel(); channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT.getType()); String message = \"info: Hello World!\"; channel.basicPublish(EXCHANGE_NAME, \"\", null, message.getBytes(StandardCharsets.UTF_8)); System.out.println(\"发送了消息：\" + message); channel.close(); conn.close(); } } ReceiveLogs.java\npackage fanout; import com.rabbitmq.client.*; import java.io.IOException; import java.nio.charset.StandardCharsets; import java.util.concurrent.TimeoutException; /** * @Description: 接受日志消息 * @Author: Rex * @Create: 2021-06-17 16:07 */ public class ReceiveLogs { private static final String EXCHANGE_NAME = \"logs\"; public static void main(String[] args) throws IOException, TimeoutException { ConnectionFactory factory = new ConnectionFactory(); factory.setHost(\"1.117.91.88\"); factory.setUsername(\"admin\"); factory.setPassword(\"admin\"); Connection conn = factory.newConnection(); Channel channel = conn.createChannel(); channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT.getType()); // 临时队列  String queueName = channel.queueDeclare().getQueue(); // 将队列绑定在交换机上  channel.queueBind(queueName, EXCHANGE_NAME, \"\"); System.out.println(\"开始接受消息\"); DefaultConsumer consumer = new DefaultConsumer(channel){ @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { String message = new String(body, StandardCharsets.UTF_8); System.out.println(\"收到消息：\" + message); } }; channel.basicConsume(queueName, true, consumer); } } 控制台\nEmitLog 发送了消息：info: Hello World! ReceiveLogs 开始接受消息 收到消息：info: Hello World! ReceiveLogs(2) 开始接受消息 收到消息：info: Hello World! ReceiveLogs(3) 开始接受消息 收到消息：info: Hello World!   direct\n 根据RoutingKey匹配消息路由到指定的队列\n EmitLogDirect\npackage direct; import com.rabbitmq.client.BuiltinExchangeType; import com.rabbitmq.client.Channel; import com.rabbitmq.client.Connection; import com.rabbitmq.client.ConnectionFactory; import java.io.IOException; import java.nio.charset.StandardCharsets; import java.util.concurrent.TimeoutException; /** * @Description: direct类型的交换机，发送消息 * @Author: Rex * @Create: 2021-06-17 16:31 */ public class EmitLogDirect { private static final String EXCHANGE_NAME = \"direct_logs\"; public static void main(String[] args) throws IOException, TimeoutException { ConnectionFactory factory = new ConnectionFactory(); factory.setHost(\"1.117.91.88\"); factory.setUsername(\"admin\"); factory.setPassword(\"admin\"); Connection conn = factory.newConnection(); Channel channel = conn.createChannel(); channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT.getType()); String message = \"info: Hello World!\"; channel.basicPublish(EXCHANGE_NAME, \"info\", null, message.getBytes(StandardCharsets.UTF_8)); System.out.println(\"发送了消息，\" + \"等级为info，消息内容：\"+ message); message = \"warning: Hello World!\"; channel.basicPublish(EXCHANGE_NAME, \"warning\", null, message.getBytes(StandardCharsets.UTF_8)); System.out.println(\"发送了消息，\" + \"等级为warning，消息内容：\"+ message); message = \"error: Hello World!\"; channel.basicPublish(EXCHANGE_NAME, \"error\", null, message.getBytes(StandardCharsets.UTF_8)); System.out.println(\"发送了消息，\" + \"等级为error，消息内容：\"+ message); channel.close(); conn.close(); } } ReceiveLogsDirect1.java\npackage direct; import com.rabbitmq.client.*; import java.io.IOException; import java.nio.charset.StandardCharsets; import java.util.concurrent.TimeoutException; /** * @Description: 接受3个类型等级的日志 * @Author: Rex * @Create: 2021-06-17 16:37 */ public class ReceiveLogsDirect1 { private static final String EXCHANGE_NAME = \"direct_logs\"; public static void main(String[] args) throws IOException, TimeoutException { ConnectionFactory factory = new ConnectionFactory(); factory.setHost(\"1.117.91.88\"); factory.setUsername(\"admin\"); factory.setPassword(\"admin\"); Connection conn = factory.newConnection(); Channel channel = conn.createChannel(); channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT.getType()); // 生成一个随机的临时的队列  String queueName = channel.queueDeclare().getQueue(); // 一个交换机同时绑定3个对列  channel.queueBind(queueName, EXCHANGE_NAME, \"info\"); channel.queueBind(queueName, EXCHANGE_NAME, \"warning\"); channel.queueBind(queueName, EXCHANGE_NAME, \"error\"); System.out.println(\"开始接受消息\"); DefaultConsumer consumer = new DefaultConsumer(channel){ @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { String message = new String(body, StandardCharsets.UTF_8); System.out.println(\"收到消息：\" + message); } }; channel.basicConsume(queueName, true, consumer); } } ReceiveLogsDirect2.java\npackage direct; import com.rabbitmq.client.*; import java.io.IOException; import java.nio.charset.StandardCharsets; import java.util.concurrent.TimeoutException; /** * @Description: 接受1个类型等级的日志 * @Author: Rex * @Create: 2021-06-17 16:37 */ public class ReceiveLogsDirect2 { private static final String EXCHANGE_NAME = \"direct_logs\"; public static void main(String[] args) throws IOException, TimeoutException { ConnectionFactory factory = new ConnectionFactory(); factory.setHost(\"1.117.91.88\"); factory.setUsername(\"admin\"); factory.setPassword(\"admin\"); Connection conn = factory.newConnection(); Channel channel = conn.createChannel(); channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT.getType()); // 生成一个随机的临时的队列  String queueName = channel.queueDeclare().getQueue(); // 一个交换机只绑定1个对列  channel.queueBind(queueName, EXCHANGE_NAME, \"error\"); System.out.println(\"开始接受消息\"); DefaultConsumer consumer = new DefaultConsumer(channel){ @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { String message = new String(body, StandardCharsets.UTF_8); System.out.println(\"收到消息：\" + message); } }; channel.basicConsume(queueName, true, consumer); } } 控制台\nEmitLogDirect: 发送了消息，等级为info，消息内容：info: Hello World! 发送了消息，等级为warning，消息内容：warning: Hello World! 发送了消息，等级为error，消息内容：error: Hello World! ReceiveLogsDirect1: 开始接受消息 收到消息：info: Hello World! 收到消息：warning: Hello World! 收到消息：error: Hello World! ReceiveLogsDirect2: 开始接受消息 收到消息：error: Hello World!   topic\n 生产者指定RoutingKey消息根据消费端指定的队列通过模糊匹配的方式进行相应转发\n *可以代替一个单词 #可以代替零个或多个单词   EmitLogTopic.java\npackage topic; import com.rabbitmq.client.BuiltinExchangeType; import com.rabbitmq.client.Channel; import com.rabbitmq.client.Connection; import com.rabbitmq.client.ConnectionFactory; import java.io.IOException; import java.nio.charset.StandardCharsets; import java.util.concurrent.TimeoutException; /** * @Description: Topic模式交换机，发送消息 * @Author: Rex * @Create: 2021-06-18 11:23 */ public class EmitLogTopic { private static final String EXCHANGE_NAME = \"topic_logs\"; public static void main(String[] args) throws IOException, TimeoutException { ConnectionFactory factory = new ConnectionFactory(); factory.setHost(\"1.117.91.88\"); factory.setUsername(\"admin\"); factory.setPassword(\"admin\"); Connection conn = factory.newConnection(); Channel channel = conn.createChannel(); channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.TOPIC.getType()); String message = \"Animal world!\"; String[] routingKeys = new String[9]; routingKeys[0] = \"quick.orange.rabbit\"; routingKeys[1] = \"lazy.orange.elephant\"; routingKeys[2] = \"quick.orange.fox\"; routingKeys[3] = \"lazy.brown.fox\"; routingKeys[4] = \"lazy.pink.rabbit\"; routingKeys[5] = \"quick.brown.fox\"; routingKeys[6] = \"orange\"; routingKeys[7] = \"quick.orange.male.rabbit\"; routingKeys[8] = \"lazy.orange.male.rabbit\"; for (int i = 0; i  routingKeys.length; i++) { channel.basicPublish(EXCHANGE_NAME, routingKeys[i], null, message.getBytes(StandardCharsets.UTF_8)); System.out.println(\"发送了：\" + message + \"routingKey：\" + routingKeys[i]); } channel.close(); conn.close(); } } ReceiveLogsTopic1.java\npackage topic; import com.rabbitmq.client.*; import java.io.IOException; import java.nio.charset.StandardCharsets; import java.util.concurrent.TimeoutException; /** * @Description: 特定路由键 * @Author: Rex * @Create: 2021-06-18 11:48 */ public class ReceiveLogsTopic1 { private static final String EXCHANGE_NAME = \"topic_logs\"; public static void main(String[] args) throws IOException, TimeoutException { ConnectionFactory factory = new ConnectionFactory(); factory.setHost(\"1.117.91.88\"); factory.setUsername(\"admin\"); factory.setPassword(\"admin\"); Connection conn = factory.newConnection(); Channel channel = conn.createChannel(); channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.TOPIC.getType()); // 生成一个随机的临时的队列  String queueName = channel.queueDeclare().getQueue(); String routingKey = \"*.orange.*\"; channel.queueBind(queueName, EXCHANGE_NAME, routingKey); System.out.println(\"开始接受消息\"); DefaultConsumer consumer = new DefaultConsumer(channel){ @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { String message = new String(body, StandardCharsets.UTF_8); System.out.println(\"收到消息：\" + message + \" routingKey: \" + envelope.getRoutingKey()); } }; channel.basicConsume(queueName, true, consumer); } } ReveiveLogsTopic2.java\npackage topic; import com.rabbitmq.client.*; import java.io.IOException; import java.nio.charset.StandardCharsets; import java.util.concurrent.TimeoutException; /** * @Description: 特定路由键 * @Author: Rex * @Create: 2021-06-18 11:48 */ public class ReceiveLogsTopic1 { private static final String EXCHANGE_NAME = \"topic_logs\"; public static void main(String[] args) throws IOException, TimeoutException { ConnectionFactory factory = new ConnectionFactory(); factory.setHost(\"1.117.91.88\"); factory.setUsername(\"admin\"); factory.setPassword(\"admin\"); Connection conn = factory.newConnection(); Channel channel = conn.createChannel(); channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.TOPIC.getType()); // 生成一个随机的临时的队列  String queueName = channel.queueDeclare().getQueue(); String routingKey = \"*.orange.*\"; channel.queueBind(queueName, EXCHANGE_NAME, routingKey); System.out.println(\"开始接受消息\"); DefaultConsumer consumer = new DefaultConsumer(channel){ @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { String message = new String(body, StandardCharsets.UTF_8); System.out.println(\"收到消息：\" + message + \" routingKey: \" + envelope.getRoutingKey()); } }; channel.basicConsume(queueName, true, consumer); } } 控制台\nEmitLogTopic 发送了：Animal world!routingKey：quick.orange.rabbit 发送了：Animal world!routingKey：lazy.orange.elephant 发送了：Animal world!routingKey：quick.orange.fox 发送了：Animal world!routingKey：lazy.brown.fox 发送了：Animal world!routingKey：lazy.pink.rabbit 发送了：Animal world!routingKey：quick.brown.fox 发送了：Animal world!routingKey：orange 发送了：Animal world!routingKey：quick.orange.male.rabbit 发送了：Animal world!routingKey：lazy.orange.male.rabbit ReceiveLogsTopic1 开始接受消息 收到消息：Animal world! routingKey: quick.orange.rabbit 收到消息：Animal world! routingKey: lazy.orange.elephant 收到消息：Animal world! routingKey: quick.orange.fox ReceiveLogsTopic2 开始接受消息 收到消息：Animal world! routingKey: quick.orange.rabbit 收到消息：Animal world! routingKey: lazy.orange.elephant 收到消息：Animal world! routingKey: lazy.brown.fox 收到消息：Animal world! routingKey: lazy.pink.rabbit 收到消息：Animal world! routingKey: lazy.orange.male.rabbit   headers（不常用）\n 根据发送消息内容中的headers属性来匹配\n   SpringBoot整合RabbitMQ   引入依赖文件\n org.springframework.boot spring-boot-starter-amqp     编写application.propertise\nconsumer\nserver.port=8081 spring.application.name=consumer spring.rabbitmq.addresses=1.117.91.88:5672 spring.rabbitmq.username=admin spring.rabbitmq.password=admin spring.rabbitmq.virtual-host=/ spring.rabbitmq.connection-timeout=15000 producer\nserver.port=8080 spring.application.name=producer spring.rabbitmq.addresses=1.117.91.88:5672 spring.rabbitmq.username=admin spring.rabbitmq.password=admin spring.rabbitmq.virtual-host=/ spring.rabbitmq.connection-timeout=15000   生产者中编写配置文件\npackage com.imooc.springbootrabbitmqproducer; import org.springframework.amqp.core.Binding; import org.springframework.amqp.core.BindingBuilder; import org.springframework.amqp.core.Queue; import org.springframework.amqp.core.TopicExchange; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; /** * @Description: rabbitmq配置类 * @Author: Rex * @Create: 2021-06-19 9:58 */ @Configuration public class TopicRabbitConfig { @Bean public Queue queue1(){ return new Queue(\"queue1\"); } @Bean public Queue queue2(){ return new Queue(\"queue2\"); } @Bean TopicExchange exchange(){ return new TopicExchange(\"bootExchange\"); } @Bean Binding bindingExchangeMessage1(Queue queue1, TopicExchange exchange){ return BindingBuilder.bind(queue1).to(exchange).with(\"dog.red\"); } @Bean Binding bindingExchangeMessage2(Queue queue2, TopicExchange exchange){ return BindingBuilder.bind(queue2).to(exchange).with(\"dog.#\"); } }   生产者发送消息\npackage com.imooc.springbootrabbitmqproducer; import org.springframework.amqp.core.AmqpTemplate; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.stereotype.Component; /** * @Description: 发送消息 * @Author: Rex * @Create: 2021-06-19 10:06 */ @Component public class MessageSender { @Autowired private AmqpTemplate rabbitmqTemplate; public void send1(){ String message = \"This is message 1, routing key is dog.red\"; System.out.println(\"发送了：\" + message); this.rabbitmqTemplate.convertAndSend(\"bootExchange\", \"dog.red\", message); } public void send2(){ String message = \"This is message 1, routing key is dog.black\"; System.out.println(\"发送了：\" + message); this.rabbitmqTemplate.convertAndSend(\"bootExchange\", \"dog.black\", message); } }   消费者接受消息\nReceiver1.java\npackage com.imooc.springbootrabbitmqconsumer; import org.springframework.amqp.rabbit.annotation.RabbitHandler; import org.springframework.amqp.rabbit.annotation.RabbitListener; import org.springframework.stereotype.Component; /** * @Description: 接收者1 * @Author: Rex * @Create: 2021-06-19 10:11 */ @Component @RabbitListener(queues = \"queue1\") public class Receiver1 { @RabbitHandler public void process(String message){ System.out.println(\"Receiver1：\" + message); } } Receiver2.java\npackage com.imooc.springbootrabbitmqconsumer; import org.springframework.amqp.rabbit.annotation.RabbitHandler; import org.springframework.amqp.rabbit.annotation.RabbitListener; import org.springframework.stereotype.Component; /** * @Description: 接收者2 * @Author: Rex * @Create: 2021-06-19 10:11 */ @Component @RabbitListener(queues = \"queue2\") public class Receiver2 { @RabbitHandler public void process(String message){ System.out.println(\"Receiver2：\" + message); } }   生产者发送消息\npackage com.imooc.springbootrabbitmqproducer; import org.junit.jupiter.api.Test; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.test.context.SpringBootTest; @SpringBootTest class SpringBootRabbitmqProducerApplicationTests { @Autowired private MessageSender messageSender; @Test public void send1(){ messageSender.send1(); } @Test public void send2(){ messageSender.send2(); } }   结果\n生产者：\n2021-06-19 10:19:00.888 INFO 20912 --- [ main] ringBootRabbitmqProducerApplicationTests : Starting SpringBootRabbitmqProducerApplicationTests on LAPTOP-LRX with PID 20912 (started by Rex in G:\\Web开发\\后端\\code\\spring-boot-rabbitmq-producer) 2021-06-19 10:19:00.891 INFO 20912 --- [ main] ringBootRabbitmqProducerApplicationTests : No active profile set, falling back to default profiles: default 2021-06-19 10:19:05.283 INFO 20912 --- [ main] ringBootRabbitmqProducerApplicationTests : Started SpringBootRabbitmqProducerApplicationTests in 5.244 seconds (JVM running for 8.205) 发送了：This is message 1, routing key is dog.red 2021-06-19 10:19:05.814 INFO 20912 --- [ main] o.s.a.r.c.CachingConnectionFactory : Attempting to connect to: [1.117.91.88:5672] 2021-06-19 10:19:06.059 INFO 20912 --- [ main] o.s.a.r.c.CachingConnectionFactory : Created new connection: rabbitConnectionFactory#7072bc39:0/SimpleConnection@ff6077 [delegate=amqp://admin@1.117.91.88:5672/, localPort= 10788] 发送了：This is message 1, routing key is dog.black 消费者\n2021-06-19 10:18:35.322 INFO 30312 --- [ main] .s.SpringBootRabbitmqConsumerApplication : Starting SpringBootRabbitmqConsumerApplication on LAPTOP-LRX with PID 30312 (started by Rex in G:\\Web开发\\后端\\code\\spring-boot-rabbitmq-consumer) 2021-06-19 10:18:35.328 INFO 30312 --- [ main] .s.SpringBootRabbitmqConsumerApplication : No active profile set, falling back to default profiles: default 2021-06-19 10:18:37.160 INFO 30312 --- [ main] o.s.a.r.c.CachingConnectionFactory : Attempting to connect to: [1.117.91.88:5672] 2021-06-19 10:18:37.299 INFO 30312 --- [ main] o.s.a.r.c.CachingConnectionFactory : Created new connection: rabbitConnectionFactory#21a21c64:0/SimpleConnection@7c098bb3 [delegate=amqp://admin@1.117.91.88:5672/, localPort= 7674] Receiver1：This is message 1, routing key is dog.red Receiver2：This is message 1, routing key is dog.red Receiver2：This is message 1, routing key is dog.black 2021-06-19 10:18:37.602 INFO 30312 --- [ main] .s.SpringBootRabbitmqConsumerApplication : Started SpringBootRabbitmqConsumerApplication in 3.042 seconds (JVM running for 6.02) Receiver1：This is message 1, routing key is dog.red Receiver2：This is message 1, routing key is dog.red Receiver2：This is message 1, routing key is dog.black   @RabbitListener   当@RabbitListener注解标注在方法上，监听到队列 debug 中有消息时则会进行接收并处理。 当@RabbitListener标注在类上面时，需配合@RabbitHandler注解一起使用。   @RabbitHandler  （@RabbitHandle注解用于表示收到某队列对应类型的消息时，要执行的内容。）\n当有收到某队列queue里面的消息的时候，就交给有@RabbitHandler注解的方法处理，具体使用哪个方法处理，根据 MessageConverter 转换后的参数类型。RabbitMQ支持任何类型的数据消息。\n ",
  "wordCount" : "2170",
  "inLanguage": "en",
  "datePublished": "2021-06-21T00:00:00Z",
  "dateModified": "2021-06-21T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Rex"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://rex0520.github.io/posts/back/java/microservices/rabbitmq/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Rex",
    "logo": {
      "@type": "ImageObject",
      "url": "https://rex0520.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://rex0520.github.io/" accesskey="h" title="Home (Alt + H)">
                <img src="http://cdn.rexweb.xyz/img/20210821105340.png" alt="logo" aria-label="logo"
                    height="35">Home</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://rex0520.github.io/posts/" title="文章">
                    <span>文章</span>
                </a>
            </li>
            <li>
                <a href="https://rex0520.github.io/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="https://rex0520.github.io/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://rex0520.github.io/archives/" title="时间轴">
                    <span>时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://rex0520.github.io/search/" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header><main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://rex0520.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://rex0520.github.io/posts/">Posts</a></div>
    <h1 class="post-title">
      Rabbitmq使用
    </h1>
    <div class="post-description">
      Rabbitmq使用
    </div>
    <div class="post-meta">2021-06-21&nbsp;·&nbsp;11 min&nbsp;·&nbsp;Rex&nbsp;|&nbsp;<a href="https://github.com/Rex0520/Rex0520.github.io" rel="noopener noreferrer" target="_blank">来这修改</a>
</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#rabbitmq" aria-label="RabbitMQ">RabbitMQ</a><ul>
                        
                <li>
                    <a href="#rabbitmq%e7%ae%80%e4%bb%8b" aria-label="RabbitMQ简介">RabbitMQ简介</a><ul>
                        
                <li>
                    <a href="#%e6%a0%b8%e5%bf%83%e6%80%9d%e6%83%b3" aria-label="核心思想">核心思想</a></li>
                <li>
                    <a href="#producer-p" aria-label="producer: P">producer: P</a></li>
                <li>
                    <a href="#queue-queue_name" aria-label="queue: queue_name">queue: queue_name</a></li>
                <li>
                    <a href="#consumer-c" aria-label="Consumer: C">Consumer: C</a></li>
                <li>
                    <a href="#%e6%b6%88%e6%81%af%e9%98%9f%e5%88%97" aria-label="消息队列：">消息队列：</a></li>
                <li>
                    <a href="#%e7%89%b9%e7%82%b9" aria-label="特点：">特点：</a></li>
                <li>
                    <a href="#ambq%e5%8d%8f%e8%ae%ae" aria-label="AMBQ协议">AMBQ协议</a></li>
                <li>
                    <a href="#rabbitmq%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5" aria-label="RabbitMQ核心概念">RabbitMQ核心概念</a></li></ul>
                </li>
                <li>
                    <a href="#rabbitmq%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4" aria-label="RabbitMQ常用命令">RabbitMQ常用命令</a></li>
                <li>
                    <a href="#rabbitmq%e5%90%8e%e5%8f%b0%e7%ae%a1%e7%90%86" aria-label="RabbitMQ后台管理">RabbitMQ后台管理</a></li>
                <li>
                    <a href="#rabbitmq%e5%ba%94%e7%94%a8" aria-label="RabbitMQ应用">RabbitMQ应用</a><ul>
                        
                <li>
                    <a href="#%e7%ac%ac%e4%b8%80%e4%b8%aajava%e5%ba%94%e7%94%a8-hello-world" aria-label="第一个java应用 Hello world">第一个java应用 Hello world</a></li>
                <li>
                    <a href="#%e5%a4%9a%e4%b8%aa%e6%b6%88%e8%b4%b9%e8%80%85%e5%b9%b3%e5%9d%87%e5%88%86%e9%85%8d" aria-label="多个消费者平均分配">多个消费者平均分配</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%ba%a4%e6%8d%a2%e6%9c%ba" aria-label="交换机">交换机</a><ul>
                        
                <li>
                    <a href="#%e4%ba%a4%e6%8d%a2%e6%9c%ba%e5%b7%a5%e4%bd%9c%e6%a8%a1%e5%bc%8f" aria-label="交换机工作模式">交换机工作模式</a></li></ul>
                </li>
                <li>
                    <a href="#springboot%e6%95%b4%e5%90%88rabbitmq" aria-label="SpringBoot整合RabbitMQ">SpringBoot整合RabbitMQ</a><ul>
                        
                <li>
                    <a href="#rabbitlistener" aria-label="@RabbitListener">@RabbitListener</a></li>
                <li>
                    <a href="#rabbithandler" aria-label="@RabbitHandler">@RabbitHandler</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="rabbitmq">RabbitMQ<a hidden class="anchor" aria-hidden="true" href="#rabbitmq">#</a></h1>
<h2 id="rabbitmq简介">RabbitMQ简介<a hidden class="anchor" aria-hidden="true" href="#rabbitmq简介">#</a></h2>
<h3 id="核心思想">核心思想<a hidden class="anchor" aria-hidden="true" href="#核心思想">#</a></h3>
<blockquote>
<p>接受并转发消息。</p>
</blockquote>
<h3 id="producer-p">producer: P<a hidden class="anchor" aria-hidden="true" href="#producer-p">#</a></h3>
<h3 id="queue-queue_name">queue: queue_name<a hidden class="anchor" aria-hidden="true" href="#queue-queue_name">#</a></h3>
<h3 id="consumer-c">Consumer: C<a hidden class="anchor" aria-hidden="true" href="#consumer-c">#</a></h3>
<h3 id="消息队列">消息队列：<a hidden class="anchor" aria-hidden="true" href="#消息队列">#</a></h3>
<ul>
<li>业务无关</li>
<li>FIFO</li>
<li>容灾</li>
<li>性能</li>
</ul>
<h3 id="特点">特点：<a hidden class="anchor" aria-hidden="true" href="#特点">#</a></h3>
<ul>
<li>开源、跨语言</li>
<li>Erlang语言编写</li>
<li>应用广泛</li>
<li>社区活跃、API丰富</li>
</ul>
<h3 id="ambq协议">AMBQ协议<a hidden class="anchor" aria-hidden="true" href="#ambq协议">#</a></h3>
<ul>
<li>Advanced Message Queue Protocol</li>
<li><img loading="lazy" src="https://cdn.jsdelivr.net/gh/rex0520/resources_repository/images/20210615084133.png" alt="image-20210615084120805"  />
</li>
</ul>
<h3 id="rabbitmq核心概念">RabbitMQ核心概念<a hidden class="anchor" aria-hidden="true" href="#rabbitmq核心概念">#</a></h3>
<ul>
<li>Server：服务</li>
<li>connection：与Server建立连接</li>
<li>channel：信道，几乎所有的操作都在信道上进行，客户端可以建立多个信道</li>
<li>message：消息，有properties和body组成</li>
<li>virtual host：虚拟主机，顶层隔离。同一个虚拟主机下，不能有重复的交换机和queue</li>
<li>Exchange：交换机，接收生产者的消息的，然后根据指定的路由器去把消息转发到锁绑定的队列上</li>
<li>binding：绑定交换机和队列</li>
<li>routing key：路由键，路由规则，虚拟机可以用它来确定这个消息如何进行一个路由</li>
<li>queue：队列，消费者只需要监听队列来消费信息，不需要关注消息来自于哪个Exchange</li>
<li>Exchange和Message Queue存在着绑定的关系，一个Exchange可以绑定多个消息队列</li>
<li>消息流转过程
<ul>
<li><img loading="lazy" src="https://cdn.jsdelivr.net/gh/rex0520/resources_repository/images/20210615084915.png" alt="image-20210615084915086"  />
</li>
</ul>
</li>
</ul>
<h2 id="rabbitmq常用命令">RabbitMQ常用命令<a hidden class="anchor" aria-hidden="true" href="#rabbitmq常用命令">#</a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">systemctl start rabbitmq-server <span class="c1"># 启动rabbitmq</span>
rabbitmqctl status <span class="c1"># 查看状态</span>
</code></pre></div><h2 id="rabbitmq后台管理">RabbitMQ后台管理<a hidden class="anchor" aria-hidden="true" href="#rabbitmq后台管理">#</a></h2>
<blockquote>
<p>http://1.117.91.88:15672/#/connections rabbitmq management</p>
</blockquote>
<h2 id="rabbitmq应用">RabbitMQ应用<a hidden class="anchor" aria-hidden="true" href="#rabbitmq应用">#</a></h2>
<h3 id="第一个java应用-hello-world">第一个java应用 Hello world<a hidden class="anchor" aria-hidden="true" href="#第一个java应用-hello-world">#</a></h3>
<ul>
<li>
<p>导入依赖</p>
<ul>
<li>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.rabbitmq<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>amqp-client<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>5.8.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>slf4j-nop<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.7.29<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p>Send.java</p>
<ul>
<li>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">helloworld</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Channel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Connection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.ConnectionFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeoutException</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Description: Hello world发送类，连接到RabbitMQ服务端，
</span><span class="cm"> * 然后发送一条消息，然后退出。
</span><span class="cm"> * @Author: Rex
</span><span class="cm"> * @Create: 2021-06-16 12:54
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Send</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">QUEUE_NAME</span> <span class="o">=</span> <span class="s">&#34;hello&#34;</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">TimeoutException</span> <span class="o">{</span>
    <span class="c1">// 创建连接工厂
</span><span class="c1"></span>    <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="o">();</span>
    <span class="c1">// 设置RabbitMQ地址
</span><span class="c1"></span>    <span class="n">factory</span><span class="o">.</span><span class="na">setHost</span><span class="o">(</span><span class="s">&#34;1.117.91.88&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="c1">// 建立连接
</span><span class="c1"></span>    <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newConnection</span><span class="o">();</span>
    <span class="c1">// 获得信道
</span><span class="c1"></span>    <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createChannel</span><span class="o">();</span>
    <span class="c1">// 声明队列
</span><span class="c1"></span>    <span class="n">channel</span><span class="o">.</span><span class="na">queueDeclare</span><span class="o">(</span><span class="n">QUEUE_NAME</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="c1">// 发布消息
</span><span class="c1"></span>    <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&#34;Hello rex!&#34;</span><span class="o">;</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">basicPublish</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">,</span> <span class="n">QUEUE_NAME</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">&#34;UTF-8&#34;</span><span class="o">));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;发送了消息：&#34;</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
    <span class="c1">// 关闭连接
</span><span class="c1"></span>    <span class="n">channel</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></li>
</ul>
</li>
<li>
<p>Resv.java</p>
<ul>
<li>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">helloworld</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeoutException</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Description: 接受消息，并打印，持续运行
</span><span class="cm"> * @Author: Rex
</span><span class="cm"> * @Create: 2021-06-16 13:11
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Recv</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">QUEUE_NAME</span> <span class="o">=</span> <span class="s">&#34;hello&#34;</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">TimeoutException</span> <span class="o">{</span>
    <span class="c1">// 创建连接工厂
</span><span class="c1"></span>    <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="o">();</span>
    <span class="c1">// 设置RabbitMQ地址
</span><span class="c1"></span>    <span class="n">factory</span><span class="o">.</span><span class="na">setHost</span><span class="o">(</span><span class="s">&#34;1.117.91.88&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="c1">// 建立连接
</span><span class="c1"></span>    <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newConnection</span><span class="o">();</span>
    <span class="c1">// 获得信道
</span><span class="c1"></span>    <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createChannel</span><span class="o">();</span>
    <span class="c1">// 声明队列
</span><span class="c1"></span>    <span class="n">channel</span><span class="o">.</span><span class="na">queueDeclare</span><span class="o">(</span><span class="n">QUEUE_NAME</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="c1">// 接受消息
</span><span class="c1"></span>    <span class="n">channel</span><span class="o">.</span><span class="na">basicConsume</span><span class="o">(</span><span class="n">QUEUE_NAME</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="k">new</span> <span class="n">DefaultConsumer</span><span class="o">(</span><span class="n">channel</span><span class="o">){</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleDelivery</span><span class="o">(</span><span class="n">String</span> <span class="n">consumerTag</span><span class="o">,</span> <span class="n">Envelope</span> <span class="n">envelope</span><span class="o">,</span> <span class="n">AMQP</span><span class="o">.</span><span class="na">BasicProperties</span> <span class="n">properties</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> <span class="s">&#34;UTF-8&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;接收到了消息：&#34;</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">});</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></li>
</ul>
</li>
<li>
<p>控制台</p>
<ul>
<li>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Send
发送了消息：Hello rex!
Recv
接收到了消息：Hello rex!
</code></pre></div></li>
</ul>
</li>
</ul>
<h3 id="多个消费者平均分配">多个消费者平均分配<a hidden class="anchor" aria-hidden="true" href="#多个消费者平均分配">#</a></h3>
<p>NewTask.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">workqueues</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeoutException</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Description: 消费者，接受前面的批量消息
</span><span class="cm"> * @Author: Rex
</span><span class="cm"> * @Create: 2021-06-16 14:23
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Worker</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">TASK_QUEUE_NAME</span> <span class="o">=</span> <span class="s">&#34;task_queue&#34;</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">TimeoutException</span> <span class="o">{</span>
    <span class="c1">// 创建连接工厂
</span><span class="c1"></span>    <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="o">();</span>
    <span class="c1">// 设置RabbitMQ地址
</span><span class="c1"></span>    <span class="n">factory</span><span class="o">.</span><span class="na">setHost</span><span class="o">(</span><span class="s">&#34;1.117.91.88&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="c1">// 建立连接
</span><span class="c1"></span>    <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newConnection</span><span class="o">();</span>
    <span class="c1">// 获得信道
</span><span class="c1"></span>    <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createChannel</span><span class="o">();</span>
    <span class="c1">// 声明队列
</span><span class="c1"></span>    <span class="n">channel</span><span class="o">.</span><span class="na">basicQos</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">queueDeclare</span><span class="o">(</span><span class="n">TASK_QUEUE_NAME</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;开始接收消息&#34;</span><span class="o">);</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">basicConsume</span><span class="o">(</span><span class="n">TASK_QUEUE_NAME</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="k">new</span> <span class="n">DefaultConsumer</span><span class="o">(</span><span class="n">channel</span><span class="o">){</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleDelivery</span><span class="o">(</span><span class="n">String</span> <span class="n">consumerTag</span><span class="o">,</span> <span class="n">Envelope</span> <span class="n">envelope</span><span class="o">,</span> <span class="n">AMQP</span><span class="o">.</span><span class="na">BasicProperties</span> <span class="n">properties</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> <span class="s">&#34;UTF-8&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;收到了消息：&#34;</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
          <span class="n">doWork</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;完成消息处理&#34;</span><span class="o">);</span>
          <span class="n">channel</span><span class="o">.</span><span class="na">basicAck</span><span class="o">(</span><span class="n">envelope</span><span class="o">.</span><span class="na">getDeliveryTag</span><span class="o">(),</span> <span class="kc">false</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">});</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">doWork</span><span class="o">(</span><span class="n">String</span> <span class="n">task</span><span class="o">){</span>
    <span class="kt">char</span><span class="o">[]</span> <span class="n">chars</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">char</span> <span class="n">ch</span> <span class="o">:</span> <span class="n">chars</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39;.&#39;</span><span class="o">){</span>
        <span class="k">try</span> <span class="o">{</span>
          <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1000</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><p>Worker</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">workqueues</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeoutException</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Description: 消费者，接受前面的批量消息
</span><span class="cm"> * @Author: Rex
</span><span class="cm"> * @Create: 2021-06-16 14:23
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Worker</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">TASK_QUEUE_NAME</span> <span class="o">=</span> <span class="s">&#34;task_queue&#34;</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">TimeoutException</span> <span class="o">{</span>
    <span class="c1">// 创建连接工厂
</span><span class="c1"></span>    <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="o">();</span>
    <span class="c1">// 设置RabbitMQ地址
</span><span class="c1"></span>    <span class="n">factory</span><span class="o">.</span><span class="na">setHost</span><span class="o">(</span><span class="s">&#34;1.117.91.88&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="c1">// 建立连接
</span><span class="c1"></span>    <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newConnection</span><span class="o">();</span>
    <span class="c1">// 获得信道
</span><span class="c1"></span>    <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createChannel</span><span class="o">();</span>
    <span class="c1">// 声明队列
</span><span class="c1"></span>    <span class="n">channel</span><span class="o">.</span><span class="na">basicQos</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">queueDeclare</span><span class="o">(</span><span class="n">TASK_QUEUE_NAME</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;开始接收消息&#34;</span><span class="o">);</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">basicConsume</span><span class="o">(</span><span class="n">TASK_QUEUE_NAME</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="k">new</span> <span class="n">DefaultConsumer</span><span class="o">(</span><span class="n">channel</span><span class="o">){</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleDelivery</span><span class="o">(</span><span class="n">String</span> <span class="n">consumerTag</span><span class="o">,</span> <span class="n">Envelope</span> <span class="n">envelope</span><span class="o">,</span> <span class="n">AMQP</span><span class="o">.</span><span class="na">BasicProperties</span> <span class="n">properties</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> <span class="s">&#34;UTF-8&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;收到了消息：&#34;</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
          <span class="n">doWork</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;完成消息处理&#34;</span><span class="o">);</span>
          <span class="n">channel</span><span class="o">.</span><span class="na">basicAck</span><span class="o">(</span><span class="n">envelope</span><span class="o">.</span><span class="na">getDeliveryTag</span><span class="o">(),</span> <span class="kc">false</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">});</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">doWork</span><span class="o">(</span><span class="n">String</span> <span class="n">task</span><span class="o">){</span>
    <span class="kt">char</span><span class="o">[]</span> <span class="n">chars</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">char</span> <span class="n">ch</span> <span class="o">:</span> <span class="n">chars</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39;.&#39;</span><span class="o">){</span>
        <span class="k">try</span> <span class="o">{</span>
          <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1000</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><p>控制台</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">NewTask
发送了消息：message 0...
发送了消息：message 1
发送了消息：message 2...
发送了消息：message 3
发送了消息：message 4...
发送了消息：message 5
发送了消息：message 6...
发送了消息：message 7
发送了消息：message 8...
发送了消息：message 9
Worker(1)
开始接收消息
收到了消息：message 0...
完成消息处理
收到了消息：message 5
完成消息处理
收到了消息：message 7
完成消息处理
收到了消息：message 8...
完成消息处理
Worker(2)
开始接收消息
收到了消息：message 1
完成消息处理
收到了消息：message 3
完成消息处理
收到了消息：message 4...
完成消息处理
收到了消息：message 9
完成消息处理
Worker(3)
开始接收消息
收到了消息：message 2...
完成消息处理
收到了消息：message 6...
完成消息处理

</code></pre></div><h2 id="交换机">交换机<a hidden class="anchor" aria-hidden="true" href="#交换机">#</a></h2>
<h3 id="交换机工作模式">交换机工作模式<a hidden class="anchor" aria-hidden="true" href="#交换机工作模式">#</a></h3>
<ul>
<li>
<p>fanout</p>
<blockquote>
<p>广播，这种模式只需要将队列绑定到交换机上即可，是不需要设置路由键的</p>
</blockquote>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/rex0520/resources_repository/images/20210617160830.png" alt="image-20210617160830730"  />
</p>
<p>EmitLog.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">fanout</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.BuiltinExchangeType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Channel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Connection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.ConnectionFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.StandardCharsets</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Exchanger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeoutException</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Description: 发送日志信息
</span><span class="cm"> * @Author: Rex
</span><span class="cm"> * @Create: 2021-06-17 15:58
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmitLog</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">EXCHANGE_NAME</span> <span class="o">=</span> <span class="s">&#34;logs&#34;</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">TimeoutException</span> <span class="o">{</span>
    <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="o">();</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setHost</span><span class="o">(</span><span class="s">&#34;1.117.91.88&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newConnection</span><span class="o">();</span>
    <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createChannel</span><span class="o">();</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">exchangeDeclare</span><span class="o">(</span><span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="n">BuiltinExchangeType</span><span class="o">.</span><span class="na">FANOUT</span><span class="o">.</span><span class="na">getType</span><span class="o">());</span>

    <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&#34;info: Hello World!&#34;</span><span class="o">;</span>

    <span class="n">channel</span><span class="o">.</span><span class="na">basicPublish</span><span class="o">(</span><span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="s">&#34;&#34;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;发送了消息：&#34;</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><p>ReceiveLogs.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">fanout</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.StandardCharsets</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeoutException</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Description: 接受日志消息
</span><span class="cm"> * @Author: Rex
</span><span class="cm"> * @Create: 2021-06-17 16:07
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReceiveLogs</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">EXCHANGE_NAME</span> <span class="o">=</span> <span class="s">&#34;logs&#34;</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">TimeoutException</span> <span class="o">{</span>
    <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="o">();</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setHost</span><span class="o">(</span><span class="s">&#34;1.117.91.88&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newConnection</span><span class="o">();</span>
    <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createChannel</span><span class="o">();</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">exchangeDeclare</span><span class="o">(</span><span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="n">BuiltinExchangeType</span><span class="o">.</span><span class="na">FANOUT</span><span class="o">.</span><span class="na">getType</span><span class="o">());</span>
    <span class="c1">// 临时队列
</span><span class="c1"></span>    <span class="n">String</span> <span class="n">queueName</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="na">queueDeclare</span><span class="o">().</span><span class="na">getQueue</span><span class="o">();</span>
    <span class="c1">// 将队列绑定在交换机上
</span><span class="c1"></span>    <span class="n">channel</span><span class="o">.</span><span class="na">queueBind</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="s">&#34;&#34;</span><span class="o">);</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;开始接受消息&#34;</span><span class="o">);</span>
    <span class="n">DefaultConsumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConsumer</span><span class="o">(</span><span class="n">channel</span><span class="o">){</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleDelivery</span><span class="o">(</span><span class="n">String</span> <span class="n">consumerTag</span><span class="o">,</span> <span class="n">Envelope</span> <span class="n">envelope</span><span class="o">,</span> <span class="n">AMQP</span><span class="o">.</span><span class="na">BasicProperties</span> <span class="n">properties</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;收到消息：&#34;</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">};</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">basicConsume</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">consumer</span><span class="o">);</span>

  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><p>控制台</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">EmitLog
发送了消息：info: Hello World!
ReceiveLogs
开始接受消息
收到消息：info: Hello World!
ReceiveLogs(2)
开始接受消息
收到消息：info: Hello World!
ReceiveLogs(3)
开始接受消息
收到消息：info: Hello World!
</code></pre></div></li>
<li>
<p>direct</p>
<blockquote>
<p>根据RoutingKey匹配消息路由到指定的队列</p>
</blockquote>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/rex0520/resources_repository/images/20210617162705.png" alt="image-20210617162705523"  />
</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/rex0520/resources_repository/images/20210617162737.png" alt="image-20210617162736803"  />
</p>
<p>EmitLogDirect</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">direct</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.BuiltinExchangeType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Channel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Connection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.ConnectionFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.StandardCharsets</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeoutException</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Description: direct类型的交换机，发送消息
</span><span class="cm"> * @Author: Rex
</span><span class="cm"> * @Create: 2021-06-17 16:31
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmitLogDirect</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">EXCHANGE_NAME</span> <span class="o">=</span> <span class="s">&#34;direct_logs&#34;</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">TimeoutException</span> <span class="o">{</span>
    <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="o">();</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setHost</span><span class="o">(</span><span class="s">&#34;1.117.91.88&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newConnection</span><span class="o">();</span>
    <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createChannel</span><span class="o">();</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">exchangeDeclare</span><span class="o">(</span><span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="n">BuiltinExchangeType</span><span class="o">.</span><span class="na">DIRECT</span><span class="o">.</span><span class="na">getType</span><span class="o">());</span>

    <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&#34;info: Hello World!&#34;</span><span class="o">;</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">basicPublish</span><span class="o">(</span><span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="s">&#34;info&#34;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;发送了消息，&#34;</span> <span class="o">+</span> <span class="s">&#34;等级为info，消息内容：&#34;</span><span class="o">+</span> <span class="n">message</span><span class="o">);</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s">&#34;warning: Hello World!&#34;</span><span class="o">;</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">basicPublish</span><span class="o">(</span><span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="s">&#34;warning&#34;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;发送了消息，&#34;</span> <span class="o">+</span> <span class="s">&#34;等级为warning，消息内容：&#34;</span><span class="o">+</span> <span class="n">message</span><span class="o">);</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s">&#34;error: Hello World!&#34;</span><span class="o">;</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">basicPublish</span><span class="o">(</span><span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="s">&#34;error&#34;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;发送了消息，&#34;</span> <span class="o">+</span> <span class="s">&#34;等级为error，消息内容：&#34;</span><span class="o">+</span> <span class="n">message</span><span class="o">);</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><p>ReceiveLogsDirect1.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">direct</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.StandardCharsets</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeoutException</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Description: 接受3个类型等级的日志
</span><span class="cm"> * @Author: Rex
</span><span class="cm"> * @Create: 2021-06-17 16:37
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReceiveLogsDirect1</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">EXCHANGE_NAME</span> <span class="o">=</span> <span class="s">&#34;direct_logs&#34;</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">TimeoutException</span> <span class="o">{</span>
    <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="o">();</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setHost</span><span class="o">(</span><span class="s">&#34;1.117.91.88&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newConnection</span><span class="o">();</span>
    <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createChannel</span><span class="o">();</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">exchangeDeclare</span><span class="o">(</span><span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="n">BuiltinExchangeType</span><span class="o">.</span><span class="na">DIRECT</span><span class="o">.</span><span class="na">getType</span><span class="o">());</span>
    <span class="c1">// 生成一个随机的临时的队列
</span><span class="c1"></span>    <span class="n">String</span> <span class="n">queueName</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="na">queueDeclare</span><span class="o">().</span><span class="na">getQueue</span><span class="o">();</span>
    <span class="c1">// 一个交换机同时绑定3个对列
</span><span class="c1"></span>    <span class="n">channel</span><span class="o">.</span><span class="na">queueBind</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="s">&#34;info&#34;</span><span class="o">);</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">queueBind</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="s">&#34;warning&#34;</span><span class="o">);</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">queueBind</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="s">&#34;error&#34;</span><span class="o">);</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;开始接受消息&#34;</span><span class="o">);</span>
    <span class="n">DefaultConsumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConsumer</span><span class="o">(</span><span class="n">channel</span><span class="o">){</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleDelivery</span><span class="o">(</span><span class="n">String</span> <span class="n">consumerTag</span><span class="o">,</span> <span class="n">Envelope</span> <span class="n">envelope</span><span class="o">,</span> <span class="n">AMQP</span><span class="o">.</span><span class="na">BasicProperties</span> <span class="n">properties</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;收到消息：&#34;</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">};</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">basicConsume</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">consumer</span><span class="o">);</span>

  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><p>ReceiveLogsDirect2.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">direct</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.StandardCharsets</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeoutException</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Description: 接受1个类型等级的日志
</span><span class="cm"> * @Author: Rex
</span><span class="cm"> * @Create: 2021-06-17 16:37
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReceiveLogsDirect2</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">EXCHANGE_NAME</span> <span class="o">=</span> <span class="s">&#34;direct_logs&#34;</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">TimeoutException</span> <span class="o">{</span>
    <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="o">();</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setHost</span><span class="o">(</span><span class="s">&#34;1.117.91.88&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newConnection</span><span class="o">();</span>
    <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createChannel</span><span class="o">();</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">exchangeDeclare</span><span class="o">(</span><span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="n">BuiltinExchangeType</span><span class="o">.</span><span class="na">DIRECT</span><span class="o">.</span><span class="na">getType</span><span class="o">());</span>
    <span class="c1">// 生成一个随机的临时的队列
</span><span class="c1"></span>    <span class="n">String</span> <span class="n">queueName</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="na">queueDeclare</span><span class="o">().</span><span class="na">getQueue</span><span class="o">();</span>
    <span class="c1">// 一个交换机只绑定1个对列
</span><span class="c1"></span>    <span class="n">channel</span><span class="o">.</span><span class="na">queueBind</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="s">&#34;error&#34;</span><span class="o">);</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;开始接受消息&#34;</span><span class="o">);</span>
    <span class="n">DefaultConsumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConsumer</span><span class="o">(</span><span class="n">channel</span><span class="o">){</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleDelivery</span><span class="o">(</span><span class="n">String</span> <span class="n">consumerTag</span><span class="o">,</span> <span class="n">Envelope</span> <span class="n">envelope</span><span class="o">,</span> <span class="n">AMQP</span><span class="o">.</span><span class="na">BasicProperties</span> <span class="n">properties</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;收到消息：&#34;</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">};</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">basicConsume</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">consumer</span><span class="o">);</span>

  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><p>控制台</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">EmitLogDirect:
发送了消息，等级为info，消息内容：info: Hello World!
发送了消息，等级为warning，消息内容：warning: Hello World!
发送了消息，等级为error，消息内容：error: Hello World!
ReceiveLogsDirect1:
开始接受消息
收到消息：info: Hello World!
收到消息：warning: Hello World!
收到消息：error: Hello World!
ReceiveLogsDirect2:
开始接受消息
收到消息：error: Hello World!

</code></pre></div></li>
<li>
<p>topic</p>
<blockquote>
<p>生产者指定RoutingKey消息根据消费端指定的队列通过模糊匹配的方式进行相应转发</p>
<ul>
<li>*可以代替一个单词</li>
<li>#可以代替零个或多个单词</li>
</ul>
</blockquote>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/rex0520/resources_repository/images/20210618112136.png" alt="image-20210618112136020"  />
</p>
<p>EmitLogTopic.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">topic</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.BuiltinExchangeType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Channel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Connection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.ConnectionFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.StandardCharsets</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeoutException</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Description: Topic模式交换机，发送消息
</span><span class="cm"> * @Author: Rex
</span><span class="cm"> * @Create: 2021-06-18 11:23
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmitLogTopic</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">EXCHANGE_NAME</span> <span class="o">=</span> <span class="s">&#34;topic_logs&#34;</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">TimeoutException</span> <span class="o">{</span>
    <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="o">();</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setHost</span><span class="o">(</span><span class="s">&#34;1.117.91.88&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newConnection</span><span class="o">();</span>
    <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createChannel</span><span class="o">();</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">exchangeDeclare</span><span class="o">(</span><span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="n">BuiltinExchangeType</span><span class="o">.</span><span class="na">TOPIC</span><span class="o">.</span><span class="na">getType</span><span class="o">());</span>

    <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&#34;Animal world!&#34;</span><span class="o">;</span>

    <span class="n">String</span><span class="o">[]</span> <span class="n">routingKeys</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">9</span><span class="o">];</span>
    <span class="n">routingKeys</span><span class="o">[</span><span class="n">0</span><span class="o">]</span> <span class="o">=</span> <span class="s">&#34;quick.orange.rabbit&#34;</span><span class="o">;</span>
    <span class="n">routingKeys</span><span class="o">[</span><span class="n">1</span><span class="o">]</span> <span class="o">=</span> <span class="s">&#34;lazy.orange.elephant&#34;</span><span class="o">;</span>
    <span class="n">routingKeys</span><span class="o">[</span><span class="n">2</span><span class="o">]</span> <span class="o">=</span> <span class="s">&#34;quick.orange.fox&#34;</span><span class="o">;</span>
    <span class="n">routingKeys</span><span class="o">[</span><span class="n">3</span><span class="o">]</span> <span class="o">=</span> <span class="s">&#34;lazy.brown.fox&#34;</span><span class="o">;</span>
    <span class="n">routingKeys</span><span class="o">[</span><span class="n">4</span><span class="o">]</span> <span class="o">=</span> <span class="s">&#34;lazy.pink.rabbit&#34;</span><span class="o">;</span>
    <span class="n">routingKeys</span><span class="o">[</span><span class="n">5</span><span class="o">]</span> <span class="o">=</span> <span class="s">&#34;quick.brown.fox&#34;</span><span class="o">;</span>
    <span class="n">routingKeys</span><span class="o">[</span><span class="n">6</span><span class="o">]</span> <span class="o">=</span> <span class="s">&#34;orange&#34;</span><span class="o">;</span>
    <span class="n">routingKeys</span><span class="o">[</span><span class="n">7</span><span class="o">]</span> <span class="o">=</span> <span class="s">&#34;quick.orange.male.rabbit&#34;</span><span class="o">;</span>
    <span class="n">routingKeys</span><span class="o">[</span><span class="n">8</span><span class="o">]</span> <span class="o">=</span> <span class="s">&#34;lazy.orange.male.rabbit&#34;</span><span class="o">;</span>

    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">routingKeys</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">channel</span><span class="o">.</span><span class="na">basicPublish</span><span class="o">(</span><span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="n">routingKeys</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="kc">null</span><span class="o">,</span> <span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">));</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;发送了：&#34;</span> <span class="o">+</span> <span class="n">message</span> <span class="o">+</span> <span class="s">&#34;routingKey：&#34;</span> <span class="o">+</span> <span class="n">routingKeys</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
    <span class="o">}</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><p>ReceiveLogsTopic1.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">topic</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.StandardCharsets</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeoutException</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Description: 特定路由键
</span><span class="cm"> * @Author: Rex
</span><span class="cm"> * @Create: 2021-06-18 11:48
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReceiveLogsTopic1</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">EXCHANGE_NAME</span> <span class="o">=</span> <span class="s">&#34;topic_logs&#34;</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">TimeoutException</span> <span class="o">{</span>
    <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="o">();</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setHost</span><span class="o">(</span><span class="s">&#34;1.117.91.88&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newConnection</span><span class="o">();</span>
    <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createChannel</span><span class="o">();</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">exchangeDeclare</span><span class="o">(</span><span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="n">BuiltinExchangeType</span><span class="o">.</span><span class="na">TOPIC</span><span class="o">.</span><span class="na">getType</span><span class="o">());</span>
    <span class="c1">// 生成一个随机的临时的队列
</span><span class="c1"></span>    <span class="n">String</span> <span class="n">queueName</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="na">queueDeclare</span><span class="o">().</span><span class="na">getQueue</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">routingKey</span> <span class="o">=</span> <span class="s">&#34;*.orange.*&#34;</span><span class="o">;</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">queueBind</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="n">routingKey</span><span class="o">);</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;开始接受消息&#34;</span><span class="o">);</span>
    <span class="n">DefaultConsumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConsumer</span><span class="o">(</span><span class="n">channel</span><span class="o">){</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleDelivery</span><span class="o">(</span><span class="n">String</span> <span class="n">consumerTag</span><span class="o">,</span> <span class="n">Envelope</span> <span class="n">envelope</span><span class="o">,</span> <span class="n">AMQP</span><span class="o">.</span><span class="na">BasicProperties</span> <span class="n">properties</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;收到消息：&#34;</span> <span class="o">+</span> <span class="n">message</span> <span class="o">+</span> <span class="s">&#34; routingKey: &#34;</span> <span class="o">+</span> <span class="n">envelope</span><span class="o">.</span><span class="na">getRoutingKey</span><span class="o">());</span>
      <span class="o">}</span>
    <span class="o">};</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">basicConsume</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">consumer</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><p>ReveiveLogsTopic2.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">topic</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.rabbitmq.client.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.StandardCharsets</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeoutException</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Description: 特定路由键
</span><span class="cm"> * @Author: Rex
</span><span class="cm"> * @Create: 2021-06-18 11:48
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReceiveLogsTopic1</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">EXCHANGE_NAME</span> <span class="o">=</span> <span class="s">&#34;topic_logs&#34;</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">TimeoutException</span> <span class="o">{</span>
    <span class="n">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="o">();</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setHost</span><span class="o">(</span><span class="s">&#34;1.117.91.88&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;admin&#34;</span><span class="o">);</span>
    <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newConnection</span><span class="o">();</span>
    <span class="n">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createChannel</span><span class="o">();</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">exchangeDeclare</span><span class="o">(</span><span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="n">BuiltinExchangeType</span><span class="o">.</span><span class="na">TOPIC</span><span class="o">.</span><span class="na">getType</span><span class="o">());</span>
    <span class="c1">// 生成一个随机的临时的队列
</span><span class="c1"></span>    <span class="n">String</span> <span class="n">queueName</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="na">queueDeclare</span><span class="o">().</span><span class="na">getQueue</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">routingKey</span> <span class="o">=</span> <span class="s">&#34;*.orange.*&#34;</span><span class="o">;</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">queueBind</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="n">EXCHANGE_NAME</span><span class="o">,</span> <span class="n">routingKey</span><span class="o">);</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;开始接受消息&#34;</span><span class="o">);</span>
    <span class="n">DefaultConsumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConsumer</span><span class="o">(</span><span class="n">channel</span><span class="o">){</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleDelivery</span><span class="o">(</span><span class="n">String</span> <span class="n">consumerTag</span><span class="o">,</span> <span class="n">Envelope</span> <span class="n">envelope</span><span class="o">,</span> <span class="n">AMQP</span><span class="o">.</span><span class="na">BasicProperties</span> <span class="n">properties</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">body</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;收到消息：&#34;</span> <span class="o">+</span> <span class="n">message</span> <span class="o">+</span> <span class="s">&#34; routingKey: &#34;</span> <span class="o">+</span> <span class="n">envelope</span><span class="o">.</span><span class="na">getRoutingKey</span><span class="o">());</span>
      <span class="o">}</span>
    <span class="o">};</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">basicConsume</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">consumer</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><p>控制台</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">EmitLogTopic
发送了：Animal world!routingKey：quick.orange.rabbit
发送了：Animal world!routingKey：lazy.orange.elephant
发送了：Animal world!routingKey：quick.orange.fox
发送了：Animal world!routingKey：lazy.brown.fox
发送了：Animal world!routingKey：lazy.pink.rabbit
发送了：Animal world!routingKey：quick.brown.fox
发送了：Animal world!routingKey：orange
发送了：Animal world!routingKey：quick.orange.male.rabbit
发送了：Animal world!routingKey：lazy.orange.male.rabbit
ReceiveLogsTopic1
开始接受消息
收到消息：Animal world! routingKey: quick.orange.rabbit
收到消息：Animal world! routingKey: lazy.orange.elephant
收到消息：Animal world! routingKey: quick.orange.fox
ReceiveLogsTopic2
开始接受消息
收到消息：Animal world! routingKey: quick.orange.rabbit
收到消息：Animal world! routingKey: lazy.orange.elephant
收到消息：Animal world! routingKey: lazy.brown.fox
收到消息：Animal world! routingKey: lazy.pink.rabbit
收到消息：Animal world! routingKey: lazy.orange.male.rabbit
</code></pre></div></li>
<li>
<p>headers（不常用）</p>
<blockquote>
<p>根据发送消息内容中的headers属性来匹配</p>
</blockquote>
</li>
</ul>
<h2 id="springboot整合rabbitmq">SpringBoot整合RabbitMQ<a hidden class="anchor" aria-hidden="true" href="#springboot整合rabbitmq">#</a></h2>
<ul>
<li>
<p>引入依赖文件</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-amqp <span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></li>
<li>
<p>编写application.propertise</p>
<p>consumer</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">server.port=8081
spring.application.name=consumer

spring.rabbitmq.addresses=1.117.91.88:5672
spring.rabbitmq.username=admin
spring.rabbitmq.password=admin
spring.rabbitmq.virtual-host=/
spring.rabbitmq.connection-timeout=15000

</code></pre></div><p>producer</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">server.port=8080
spring.application.name=producer

spring.rabbitmq.addresses=1.117.91.88:5672
spring.rabbitmq.username=admin
spring.rabbitmq.password=admin
spring.rabbitmq.virtual-host=/
spring.rabbitmq.connection-timeout=15000
</code></pre></div></li>
<li>
<p>生产者中编写配置文件</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.imooc.springbootrabbitmqproducer</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Binding</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.BindingBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Queue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.TopicExchange</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>


<span class="cm">/**
</span><span class="cm"> * @Description: rabbitmq配置类
</span><span class="cm"> * @Author: Rex
</span><span class="cm"> * @Create: 2021-06-19 9:58
</span><span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TopicRabbitConfig</span> <span class="o">{</span>
  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="n">Queue</span> <span class="nf">queue1</span><span class="o">(){</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Queue</span><span class="o">(</span><span class="s">&#34;queue1&#34;</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="n">Queue</span> <span class="nf">queue2</span><span class="o">(){</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Queue</span><span class="o">(</span><span class="s">&#34;queue2&#34;</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Bean</span>
  <span class="n">TopicExchange</span> <span class="nf">exchange</span><span class="o">(){</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TopicExchange</span><span class="o">(</span><span class="s">&#34;bootExchange&#34;</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Bean</span>
  <span class="n">Binding</span> <span class="nf">bindingExchangeMessage1</span><span class="o">(</span><span class="n">Queue</span> <span class="n">queue1</span><span class="o">,</span> <span class="n">TopicExchange</span> <span class="n">exchange</span><span class="o">){</span>
    <span class="k">return</span> <span class="n">BindingBuilder</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">queue1</span><span class="o">).</span><span class="na">to</span><span class="o">(</span><span class="n">exchange</span><span class="o">).</span><span class="na">with</span><span class="o">(</span><span class="s">&#34;dog.red&#34;</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Bean</span>
  <span class="n">Binding</span> <span class="nf">bindingExchangeMessage2</span><span class="o">(</span><span class="n">Queue</span> <span class="n">queue2</span><span class="o">,</span> <span class="n">TopicExchange</span> <span class="n">exchange</span><span class="o">){</span>
    <span class="k">return</span> <span class="n">BindingBuilder</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">queue2</span><span class="o">).</span><span class="na">to</span><span class="o">(</span><span class="n">exchange</span><span class="o">).</span><span class="na">with</span><span class="o">(</span><span class="s">&#34;dog.#&#34;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></li>
<li>
<p>生产者发送消息</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.imooc.springbootrabbitmqproducer</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.AmqpTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Description: 发送消息
</span><span class="cm"> * @Author: Rex
</span><span class="cm"> * @Create: 2021-06-19 10:06
</span><span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageSender</span> <span class="o">{</span>
  <span class="nd">@Autowired</span>
  <span class="kd">private</span> <span class="n">AmqpTemplate</span> <span class="n">rabbitmqTemplate</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">send1</span><span class="o">(){</span>
    <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&#34;This is message 1, routing key is dog.red&#34;</span><span class="o">;</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;发送了：&#34;</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">rabbitmqTemplate</span><span class="o">.</span><span class="na">convertAndSend</span><span class="o">(</span><span class="s">&#34;bootExchange&#34;</span><span class="o">,</span> <span class="s">&#34;dog.red&#34;</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">send2</span><span class="o">(){</span>
    <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&#34;This is message 1, routing key is dog.black&#34;</span><span class="o">;</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;发送了：&#34;</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">rabbitmqTemplate</span><span class="o">.</span><span class="na">convertAndSend</span><span class="o">(</span><span class="s">&#34;bootExchange&#34;</span><span class="o">,</span> <span class="s">&#34;dog.black&#34;</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></li>
<li>
<p>消费者接受消息</p>
<p>Receiver1.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.imooc.springbootrabbitmqconsumer</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.annotation.RabbitHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.annotation.RabbitListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Description: 接收者1
</span><span class="cm"> * @Author: Rex
</span><span class="cm"> * @Create: 2021-06-19 10:11
</span><span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="nd">@RabbitListener</span><span class="o">(</span><span class="n">queues</span> <span class="o">=</span> <span class="s">&#34;queue1&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Receiver1</span> <span class="o">{</span>

  <span class="nd">@RabbitHandler</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">){</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Receiver1：&#34;</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><p>Receiver2.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.imooc.springbootrabbitmqconsumer</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.annotation.RabbitHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.annotation.RabbitListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @Description: 接收者2
</span><span class="cm"> * @Author: Rex
</span><span class="cm"> * @Create: 2021-06-19 10:11
</span><span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="nd">@RabbitListener</span><span class="o">(</span><span class="n">queues</span> <span class="o">=</span> <span class="s">&#34;queue2&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Receiver2</span> <span class="o">{</span>

  <span class="nd">@RabbitHandler</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">){</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Receiver2：&#34;</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></li>
<li>
<p>生产者发送消息</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.imooc.springbootrabbitmqproducer</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>

<span class="nd">@SpringBootTest</span>
<span class="kd">class</span> <span class="nc">SpringBootRabbitmqProducerApplicationTests</span> <span class="o">{</span>
  <span class="nd">@Autowired</span>
  <span class="kd">private</span> <span class="n">MessageSender</span> <span class="n">messageSender</span><span class="o">;</span>

  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">send1</span><span class="o">(){</span>
    <span class="n">messageSender</span><span class="o">.</span><span class="na">send1</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">send2</span><span class="o">(){</span>
    <span class="n">messageSender</span><span class="o">.</span><span class="na">send2</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></li>
<li>
<p>结果</p>
<p>生产者：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">2021-06-19 10:19:00.888  INFO 20912 --- [           main] ringBootRabbitmqProducerApplicationTests : Starting SpringBootRabbitmqProducerApplicationTests on LAPTOP-LRX with PID 20912 (started by Rex in G:\Web开发\后端\code\spring-boot-rabbitmq-producer)
2021-06-19 10:19:00.891  INFO 20912 --- [           main] ringBootRabbitmqProducerApplicationTests : No active profile set, falling back to default profiles: default
2021-06-19 10:19:05.283  INFO 20912 --- [           main] ringBootRabbitmqProducerApplicationTests : Started SpringBootRabbitmqProducerApplicationTests in 5.244 seconds (JVM running for 8.205)
发送了：This is message 1, routing key is dog.red
2021-06-19 10:19:05.814  INFO 20912 --- [           main] o.s.a.r.c.CachingConnectionFactory       : Attempting to connect to: [1.117.91.88:5672]
2021-06-19 10:19:06.059  INFO 20912 --- [           main] o.s.a.r.c.CachingConnectionFactory       : Created new connection: rabbitConnectionFactory#7072bc39:0/SimpleConnection@ff6077 [delegate=amqp://admin@1.117.91.88:5672/, localPort= 10788]
发送了：This is message 1, routing key is dog.black

</code></pre></div><p>消费者</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">2021-06-19 10:18:35.322  INFO 30312 --- [           main] .s.SpringBootRabbitmqConsumerApplication : Starting SpringBootRabbitmqConsumerApplication on LAPTOP-LRX with PID 30312 (started by Rex in G:\Web开发\后端\code\spring-boot-rabbitmq-consumer)
2021-06-19 10:18:35.328  INFO 30312 --- [           main] .s.SpringBootRabbitmqConsumerApplication : No active profile set, falling back to default profiles: default
2021-06-19 10:18:37.160  INFO 30312 --- [           main] o.s.a.r.c.CachingConnectionFactory       : Attempting to connect to: [1.117.91.88:5672]
2021-06-19 10:18:37.299  INFO 30312 --- [           main] o.s.a.r.c.CachingConnectionFactory       : Created new connection: rabbitConnectionFactory#21a21c64:0/SimpleConnection@7c098bb3 [delegate=amqp://admin@1.117.91.88:5672/, localPort= 7674]
Receiver1：This is message 1, routing key is dog.red
Receiver2：This is message 1, routing key is dog.red
Receiver2：This is message 1, routing key is dog.black
2021-06-19 10:18:37.602  INFO 30312 --- [           main] .s.SpringBootRabbitmqConsumerApplication : Started SpringBootRabbitmqConsumerApplication in 3.042 seconds (JVM running for 6.02)
Receiver1：This is message 1, routing key is dog.red
Receiver2：This is message 1, routing key is dog.red
Receiver2：This is message 1, routing key is dog.black
</code></pre></div></li>
</ul>
<h3 id="rabbitlistener">@RabbitListener<a hidden class="anchor" aria-hidden="true" href="#rabbitlistener">#</a></h3>
<blockquote>
<ol>
<li>当@RabbitListener注解标注在方法上，监听到队列 debug 中有消息时则会进行接收并处理。</li>
<li>当@RabbitListener标注在类上面时，需配合@RabbitHandler注解一起使用。</li>
</ol>
</blockquote>
<h3 id="rabbithandler">@RabbitHandler<a hidden class="anchor" aria-hidden="true" href="#rabbithandler">#</a></h3>
<blockquote>
<p>（@RabbitHandle注解用于表示收到某队列对应类型的消息时，要执行的内容。）</p>
<p>当有收到某队列queue里面的消息的时候，就交给有@RabbitHandler注解的方法处理，具体使用哪个方法处理，根据 MessageConverter 转换后的参数类型。RabbitMQ支持任何类型的数据消息。</p>
</blockquote>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://rex0520.github.io/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://rex0520.github.io/posts/back/java/microservices/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">
    <span class="title">« Prev Page</span>
    <br>
    <span>微服务</span>
  </a>
  <a class="next" href="https://rex0520.github.io/posts/front/css3/">
    <span class="title">Next Page »</span>
    <br>
    <span>CSS3</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Rabbitmq使用 on twitter"
        href="https://twitter.com/intent/tweet/?text=Rabbitmq%e4%bd%bf%e7%94%a8&amp;url=https%3a%2f%2frex0520.github.io%2fposts%2fback%2fjava%2fmicroservices%2frabbitmq%2f&amp;hashtags=%e5%be%ae%e6%9c%8d%e5%8a%a1">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Rabbitmq使用 on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frex0520.github.io%2fposts%2fback%2fjava%2fmicroservices%2frabbitmq%2f&amp;title=Rabbitmq%e4%bd%bf%e7%94%a8&amp;summary=Rabbitmq%e4%bd%bf%e7%94%a8&amp;source=https%3a%2f%2frex0520.github.io%2fposts%2fback%2fjava%2fmicroservices%2frabbitmq%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Rabbitmq使用 on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2frex0520.github.io%2fposts%2fback%2fjava%2fmicroservices%2frabbitmq%2f&title=Rabbitmq%e4%bd%bf%e7%94%a8">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Rabbitmq使用 on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frex0520.github.io%2fposts%2fback%2fjava%2fmicroservices%2frabbitmq%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Rabbitmq使用 on whatsapp"
        href="https://api.whatsapp.com/send?text=Rabbitmq%e4%bd%bf%e7%94%a8%20-%20https%3a%2f%2frex0520.github.io%2fposts%2fback%2fjava%2fmicroservices%2frabbitmq%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Rabbitmq使用 on telegram"
        href="https://telegram.me/share/url?text=Rabbitmq%e4%bd%bf%e7%94%a8&amp;url=https%3a%2f%2frex0520.github.io%2fposts%2fback%2fjava%2fmicroservices%2frabbitmq%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
<script src="https://utteranc.es/client.js" repo="Rex0520/blogcomment"
  issue-term="title" theme="github-light" crossorigin="anonymous"
  async>
  </script>

</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2021 <a href="https://rex0520.github.io/">Rex</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/mermaid@8.10.1/dist/mermaid.min.js"></script>

<script>
    
    
    const mermaidKeywords = [
        "graph TD",
        "graph TB",
        "graph BT",
        "graph RL",
        "graph LR",
        "sequenceDiagram",
        "gantt",
        "classDiagram",
        "gitGraph",
        "erDiagram",
        "journey"
    ];
    var col = document.querySelector('.language-fallback');
    var htmlCollection = document.getElementsByClassName('language-fallback')
    console.log(col)
    console.log(htmlCollection)
    Array.prototype.slice.call(htmlCollection)
    console.log(Array.prototype.slice.call(htmlCollection))
    Array.from(htmlCollection).forEach(ele => {
        var graphDefinition = ele.innerText;
        if (mermaidKeywords.some((keyword) => graphDefinition.startsWith(keyword))) {
            ele.parentElement.parentElement.outerHTML = `<div class="mermaid">${ele.innerText}</div>`
        }
    })
    Array.from(document.getElementsByClassName('language-mermaid')).forEach(ele => {
        ele.parentElement.outerHTML = `<div class="mermaid">${ele.innerText}</div>`
    })
</script>
<style>
     
    .mermaid svg {
        display: block;
        margin: auto;
    }
</style></body>

</html>
