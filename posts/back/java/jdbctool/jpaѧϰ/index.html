<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>JPA学习 | Rex中心站</title>
<meta name="keywords" content="JDBC" />
<meta name="description" content="JPA学习">
<meta name="author" content="Rex">
<link rel="canonical" href="https://rex0520.github.io/posts/back/java/jdbctool/jpa%D1%A7%CF%B0/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.css" rel="preload stylesheet" as="style">
<link rel="preload" href="http://cdn.rexhub.xyz/img/20210821105340.png" as="image">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://rex0520.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://rex0520.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://rex0520.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://rex0520.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://rex0520.github.io/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.100.2" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="JPA学习" />
<meta property="og:description" content="JPA学习" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rex0520.github.io/posts/back/java/jdbctool/jpa%D1%A7%CF%B0/" /><meta property="og:image" content="https://cdn.rexhub.xyz/img/20210820141535.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-22T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-03-22T00:00:00&#43;00:00" /><meta property="og:site_name" content="RexHub" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://cdn.rexhub.xyz/img/20210820141535.jpg"/>

<meta name="twitter:title" content="JPA学习"/>
<meta name="twitter:description" content="JPA学习"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://rex0520.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "JPA学习",
      "item": "https://rex0520.github.io/posts/back/java/jdbctool/jpa%D1%A7%CF%B0/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "JPA学习",
  "name": "JPA学习",
  "description": "JPA学习",
  "keywords": [
    "JDBC"
  ],
  "articleBody": "JPA 一、什么是jpa ​\tJPA是Java Persistence API的意思，是一种ORM框架。是使用JDK 5.0注解或XML描述对象－关系表的映射关系的元数据，并将运行期的面向对象语言程序中的实体对象持久化到数据库中。\n二、基于注解的使用 JPA常用注解 注解 解释 @Entity 声明类为实体或表。 @Table 声明表名。 @Basic 指明非约束明确的各个字段。 @Embedded 指定类或它的值是一个可嵌入的类的实体的属性。 @Id 指定的类的属性，用于识别（一个表中的主键）。 @GeneratedValue 指定如何标识属性可以被初始化，例如自动、手动、或从序列表中获得的值。 @Transient 指定的属性，它是不持久的，即：该值永远不会存储再数据库中。 @Column 指定持久属性栏属性。 @SequenceGenerator 指定在@GeneratedValue注解中指定的属性的值。它创建了一个序列。 @TableGenerator 指定在@GeneratedValue批注指定属性的值发生器。它创造了的值生成的表。 @AccessType 这种类型的注释用于设置访问类型。如果设置@AccessType(FIELD)，则可以直接访问变量并且不需要getter和setter，但必须为public。如果设置@AccessType(PROPERTY)，通过getter和setter方法访问Entity的变量。 @JoinColumn 指定一个实体组织或实体的集合。这是用在多对一和一对多关联。 @UniqueConstraint 指定的字段和用于主要或辅助表的唯一约束。 @ColumnResult 参考使用select字句的SQL查询中的列明。 @ManyToMany 定义了连接表之间的多对多的的关系 @ManyToOne 定义了连接表之间的多对一的关系 @OneToMany 定义了连接表之间存在一个一对多的关系。 @OneToOne 定义了连接表之间有一个一对一的关系 @NamedQueries 指定命名查询的列表 @NamedQuery 指定使用静态名称的查询。 三、使用 在application.properties文件中的配置\n#jpa的配置 spring.jpa.database-platform=org.hibernate.dialect.MySQL5InnoDBDialect spring.jpa.show-sql=true spring.jpa.hibernate.ddl-auto=create tips:\n​\tjpa.hibernate.ddl-auto是hibernate的配置属性，其主要作用是：自动创建、更新、验证数据库表结构。该参数的几种配置如下：\ncreate：每次加载hibernate时都会删除上一次的生成的表，然后根据你的model类再重新来生成新表，哪怕两次没有任何改变也要这样执行，这就是导致数据库表数据丢失的一个重要原因。\ncreate-drop：每次加载hibernate时根据model类生成表，但是sessionFactory一关闭,表就自动删除。\nupdate：最常用的属性，第一次加载hibernate时根据model类会自动建立起表的结构（前提是先建立好数据库），以后加载hibernate时根据model类自动更新表结构，即使表结构改变了但表中的行仍然存在不会删除以前的行。要注意的是当部署到服务器后，表结构是不会被马上建立起来的，是要等应用第一次运行起来后才会。\nvalidate：每次加载hibernate时，验证创建数据库表结构，只会和数据库中的表进行比较，不会创建新表，但是会插入新值。\n四、JPQL查询 ​\t常用关键字\nkeyword sample jpaql snippet And findByLastnameAndFirstname …where x.firstname = ?1 and x.lastname = ?2 Or findByLastnameOrFirstname …where x.firstname = ?1 or x.lastname = ?2 Is, Equals findByFirstnameIs, findByFirstnameEquals …where x.firstname = ?1 Between findByStartDateBetween …where x.firstname between ?1 and ?2 LessThan findByAgeLessThan …where x.age \u003c ?1 LessThanEqual findByAgeLessThanEqual …where x.age \u003c= ?1 GreaterThan findByAgeGreaterThan …where x.age \u003e ?1 GreaterThanEqual findByAgeGreaterThanEqual …where x.age \u003e= ?1 After findByStartDateAfter …where x.startDate \u003e ?1 Before findByStartDateBefore …where x.startDate \u003c ?1 IsNull findByAgeIsNull …where x.age is null IsNotNull, NotNull findByAge(IS)NotNull …where x.age not null Like findByFirstnameLike …where x.firstname like ?1 NotLike findByFirstnameNotLike …where x.firstname not like ?1 StartingWith findByFirstnameStartingWith …where x.firstname like ?1(parameter bound with appended %) EndingWith findByFirstnameEndingWith …where x.firstname like ?1(parameter bound with prepended %) Containing findByFirstnameContaining …where x.firstname like ?1(parameter bound with wrapped in %) OrderBy findByAgeOrderByLastnameDesc … where x.age = ?1 order by x.lastname desc Not findByLastnameNot … where x.lastname \u003c\u003e ?1 In findByAgeIn (Collection ages) … where x.age in ?1 NotIn findByAgeNotIn (Collection ages) … where x.age not in ?1 TRUE findByActiveTrue() …where x.active=true FALSE findByActiveFalse() …where x.active=false IgnoreCase findByFirstnameIgnoreCase …where UPPER(x.firstname) = UPPER(?1) 五、自定义Query 使用原生的sql语句 @Query(nativeQuery = true) 1.查询 实例 public interface UserRepository extends Repository\u003cUser, Long\u003e { /** * 根据id查询用户信息 * * User为ORM映射的类名，即为ORM映射的实体类名 * 根据参数的顺序，参数分别为?1，?2，?3...... * * @param id * @return */ @Query(\"select u from User u where u.id=?1\") public User findUser(Long id); /** * 根据id查询用户信息 * * User为ORM映射的类名，即为ORM映射的实体类名 * :id为传递的参数 * * @param id * @return */ @Query(\"select u from User u where u.id=:id\") public User findUserByParam(@Param(\"id\") Long id); /** * 根据id和name查询用户信息 * * User为ORM映射的类名，即为ORM映射的实体类名 * 根据参数的顺序，分别为?1，?2，?3...... * * @param id * @return */ @Query(\"select u from User u where u.id=?1 and u.name=?2\") public User findUserByIdAndName(Long id, String name); /** * 查询所有用户信息 * * User为ORM映射的类名，即为ORM映射的实体类名 * * @return */ @Query(\"select u from User u\") public List\u003cUser\u003e findUserList(); /** * 根据name模糊查询 * * User为ORM映射的类名，即为ORM映射的实体类名 * 根据参数的顺序，分别为?1，?2，?3...... * * @param name * @return */ @Query(\"select u from User u where name like %?1%\") public List\u003cUser\u003e findUserListByLikeName(String name); /** * 根据name模糊查询 * * User为ORM映射的类名，即为ORM映射的实体类名 * 根据参数的顺序，分别为?1，?2，?3...... * * @param name * @return */ @Query(\"select u from User u where name like concat('%',?1,'%') \") public List\u003cUser\u003e findUserListByLikeConcatName(String name); /** * 根据id查询用户信息 * * nativeQuery = true时，JPA能够识别真正的SQL语句 * * @param id * @return */ @Query(value = \"select * from user where id=?1\", nativeQuery = true) public User findUserByNativeQuery(int id); /** * 使用SpEL表达式 * * 从Spring Data JPA 1.4版开始，我们支持在手动定义的查询中使用受限制的SpEL模板表达式@Query。 * 在执行查询时，将根据预定义的变量集评估这些表达式。Spring Data JPA支持一个名为的变量entityName。它的用法是select x from #{#entityName} x。 * 它插入entityName与给定存储库关联的域类型。该entityName解决如下：如果域类型已设置的name属性@Entity的注释，它被使用。否则，使用域类型的简单类名 * * @param name * @return */ @Query(\"select u from #{#entityName} u where u.name = ?1\") public List\u003cUser\u003e findBySpEL(String name); } 2.更新/删除 示例 ​\tUserRepository.java\n@Transactional//事务：原子性，回滚 @Modifying @Query(\"update User set gender=:gender where userName=:name \") public int updateUser(@Param(\"gender\") Integer gender ,@Param(\"name\") String userName); 3.多表联查 示例 ​\tUserDepartVo.java\n@Data @AllArgsConstructor public class UserDepartVo { String code; String userName; Integer gender; String name; } ​\tUserRepository.java\n//查询所有用户的code，姓名，性别，部门名称 @Query(\"select new com.wzy.jxx.jpa.UserDepartVo(u.code,u.userName,u.gender,d.name) \" + \"from User u,Department d where u.departmentId=d.id\") public List\u003cUserDepartVo\u003e getUserDeparment(); 4.分页查询 示例1 ​\tUserRepository.java\n@Query(\"select u from User u where gender=?1 and age between ?2 and ?3 \") public Page\u003cUser\u003e findPageByGender3(Integer gender, Integer minAge, Integer maxAge,Pageable pageable); ​\tUserController.java\n@PostMapping(\"/findPageByGender3\") public Page\u003cUser\u003e findPageByGender3(Integer page, Integer size,Integer gender, Integer minAge, Integer maxAge){ Pageable pageable = PageRequest.of(page,size); return userRepository.findPageByGender3(gender, minAge, maxAge, pageable); } 示例2 ​\tUserRepository.java\n@Query(value = \"select * from User WHERE gender = ?1\",nativeQuery = true) Page\u003cUser\u003e findPageByGender(Integer gender, Pageable page); ​\tUserController.java\n@PostMapping(\"findPageByGender\") public Page\u003cUser\u003e findPageByGender(Integer gender){ Pageable pageable = PageRequest.of(0,20); Page\u003cUser\u003e userPage = userRepository.findPageByGender(gender,pageable); List\u003cUser\u003e users = userPage.getContent(); return userPage; } 5.排序查询 示例 ​\tUserRepository.java\n@Query(value = \"select u from User u WHERE gender = ?1\") List\u003cUser\u003e findByGenderSort(Integer gender, Sort sort); ​\tUserController.java\n@PostMapping(\"findByGenderSort\") public List\u003cUser\u003e findByGenderSort(Integer gender){ Sort sort = Sort.by(Sort.Direction.DESC, \"id\"); List\u003cUser\u003e users = userRepository.findByGenderSort(gender,sort); return users; } ",
  "wordCount" : "690",
  "inLanguage": "en",
  "datePublished": "2021-03-22T00:00:00Z",
  "dateModified": "2021-03-22T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Rex"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://rex0520.github.io/posts/back/java/jdbctool/jpa%D1%A7%CF%B0/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Rex中心站",
    "logo": {
      "@type": "ImageObject",
      "url": "https://rex0520.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://rex0520.github.io/" accesskey="h" title="Home (Alt + H)">
                <img src="http://cdn.rexhub.xyz/img/20210821105340.png" alt="logo" aria-label="logo"
                    height="35">Home</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://rex0520.github.io/posts/" title="文章">
                    <span>文章</span>
                </a>
            </li>
            <li>
                <a href="https://rex0520.github.io/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="https://rex0520.github.io/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://rex0520.github.io/archives/" title="时间轴">
                    <span>时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://rex0520.github.io/search/" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header><main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://rex0520.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://rex0520.github.io/posts/">Posts</a></div>
    <h1 class="post-title">
      JPA学习
    </h1>
    <div class="post-description">
      JPA学习
    </div>
    <div class="post-meta">2021-03-22&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Rex&nbsp;|&nbsp;<a href="https://github.com/Rex0520/Rex0520.github.io" rel="noopener noreferrer" target="_blank">来这修改</a>
</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#jpa" aria-label="JPA">JPA</a><ul>
                        
                <li>
                    <a href="#%e4%b8%80%e4%bb%80%e4%b9%88%e6%98%afjpa" aria-label="一、什么是jpa">一、什么是jpa</a></li>
                <li>
                    <a href="#%e4%ba%8c%e5%9f%ba%e4%ba%8e%e6%b3%a8%e8%a7%a3%e7%9a%84%e4%bd%bf%e7%94%a8" aria-label="二、基于注解的使用">二、基于注解的使用</a></li>
                <li>
                    <a href="#%e4%b8%89%e4%bd%bf%e7%94%a8" aria-label="三、使用">三、使用</a></li>
                <li>
                    <a href="#%e5%9b%9bjpql%e6%9f%a5%e8%af%a2" aria-label="四、JPQL查询">四、JPQL查询</a></li>
                <li>
                    <a href="#%e4%ba%94%e8%87%aa%e5%ae%9a%e4%b9%89query" aria-label="五、自定义Query">五、自定义Query</a><ul>
                        
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e5%8e%9f%e7%94%9f%e7%9a%84sql%e8%af%ad%e5%8f%a5" aria-label="使用原生的sql语句">使用原生的sql语句</a></li>
                <li>
                    <a href="#1%e6%9f%a5%e8%af%a2" aria-label="1.查询">1.查询</a><ul>
                        
                <li>
                    <a href="#%e5%ae%9e%e4%be%8b" aria-label="实例">实例</a></li></ul>
                </li>
                <li>
                    <a href="#2%e6%9b%b4%e6%96%b0%e5%88%a0%e9%99%a4" aria-label="2.更新/删除">2.更新/删除</a><ul>
                        
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b" aria-label="示例">示例</a></li></ul>
                </li>
                <li>
                    <a href="#3%e5%a4%9a%e8%a1%a8%e8%81%94%e6%9f%a5" aria-label="3.多表联查">3.多表联查</a><ul>
                        
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b-1" aria-label="示例">示例</a></li></ul>
                </li>
                <li>
                    <a href="#4%e5%88%86%e9%a1%b5%e6%9f%a5%e8%af%a2" aria-label="4.分页查询">4.分页查询</a><ul>
                        
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b1" aria-label="示例1">示例1</a></li>
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b2" aria-label="示例2">示例2</a></li></ul>
                </li>
                <li>
                    <a href="#5%e6%8e%92%e5%ba%8f%e6%9f%a5%e8%af%a2" aria-label="5.排序查询">5.排序查询</a><ul>
                        
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b-2" aria-label="示例">示例</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="jpa">JPA<a hidden class="anchor" aria-hidden="true" href="#jpa">#</a></h1>
<h2 id="一什么是jpa">一、什么是jpa<a hidden class="anchor" aria-hidden="true" href="#一什么是jpa">#</a></h2>
<p>​	JPA是Java Persistence API的意思，是一种ORM框架。是使用JDK 5.0注解或XML描述对象－关系表的映射关系的元数据，并将运行期的面向对象语言程序中的实体对象持久化到数据库中。</p>
<h2 id="二基于注解的使用">二、基于注解的使用<a hidden class="anchor" aria-hidden="true" href="#二基于注解的使用">#</a></h2>
<ol>
<li>JPA常用注解
<table>
<thead>
<tr>
<th>注解</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Entity</td>
<td>声明类为实体或表。</td>
</tr>
<tr>
<td>@Table</td>
<td>声明表名。</td>
</tr>
<tr>
<td>@Basic</td>
<td>指明非约束明确的各个字段。</td>
</tr>
<tr>
<td>@Embedded</td>
<td>指定类或它的值是一个可嵌入的类的实体的属性。</td>
</tr>
<tr>
<td>@Id</td>
<td>指定的类的属性，用于识别（一个表中的主键）。</td>
</tr>
<tr>
<td>@GeneratedValue</td>
<td>指定如何标识属性可以被初始化，例如自动、手动、或从序列表中获得的值。</td>
</tr>
<tr>
<td>@Transient</td>
<td>指定的属性，它是不持久的，即：该值永远不会存储再数据库中。</td>
</tr>
<tr>
<td>@Column</td>
<td>指定持久属性栏属性。</td>
</tr>
<tr>
<td>@SequenceGenerator</td>
<td>指定在@GeneratedValue注解中指定的属性的值。它创建了一个序列。</td>
</tr>
<tr>
<td>@TableGenerator</td>
<td>指定在@GeneratedValue批注指定属性的值发生器。它创造了的值生成的表。</td>
</tr>
<tr>
<td>@AccessType</td>
<td>这种类型的注释用于设置访问类型。如果设置@AccessType(FIELD)，则可以直接访问变量并且不需要getter和setter，但必须为public。如果设置@AccessType(PROPERTY)，通过getter和setter方法访问Entity的变量。</td>
</tr>
<tr>
<td>@JoinColumn</td>
<td>指定一个实体组织或实体的集合。这是用在多对一和一对多关联。</td>
</tr>
<tr>
<td>@UniqueConstraint</td>
<td>指定的字段和用于主要或辅助表的唯一约束。</td>
</tr>
<tr>
<td>@ColumnResult</td>
<td>参考使用select字句的SQL查询中的列明。</td>
</tr>
<tr>
<td>@ManyToMany</td>
<td>定义了连接表之间的多对多的的关系</td>
</tr>
<tr>
<td>@ManyToOne</td>
<td>定义了连接表之间的多对一的关系</td>
</tr>
<tr>
<td>@OneToMany</td>
<td>定义了连接表之间存在一个一对多的关系。</td>
</tr>
<tr>
<td>@OneToOne</td>
<td>定义了连接表之间有一个一对一的关系</td>
</tr>
<tr>
<td>@NamedQueries</td>
<td>指定命名查询的列表</td>
</tr>
<tr>
<td>@NamedQuery</td>
<td>指定使用静态名称的查询。</td>
</tr>
</tbody>
</table>
</li>
</ol>
<h2 id="三使用">三、使用<a hidden class="anchor" aria-hidden="true" href="#三使用">#</a></h2>
<ol>
<li>
<p>在application.properties文件中的配置</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#jpa的配置
</span></span><span class="line"><span class="cl">spring.jpa.database-platform=org.hibernate.dialect.MySQL5InnoDBDialect
</span></span><span class="line"><span class="cl">spring.jpa.show-sql=true
</span></span><span class="line"><span class="cl">spring.jpa.hibernate.ddl-auto=create
</span></span></code></pre></div><p>tips:</p>
<p>​	jpa.hibernate.ddl-auto是hibernate的配置属性，其主要作用是：自动创建、更新、验证数据库表结构。该参数的几种配置如下：</p>
<ul>
<li>
<p>create：每次加载hibernate时都会删除上一次的生成的表，然后根据你的model类再重新来生成新表，哪怕两次没有任何改变也要这样执行，这就是导致数据库表数据丢失的一个重要原因。</p>
</li>
<li>
<p>create-drop：每次加载hibernate时根据model类生成表，但是sessionFactory一关闭,表就自动删除。</p>
</li>
<li>
<p>update：最常用的属性，第一次加载hibernate时根据model类会自动建立起表的结构（前提是先建立好数据库），以后加载hibernate时根据model类自动更新表结构，即使表结构改变了但表中的行仍然存在不会删除以前的行。要注意的是当部署到服务器后，表结构是不会被马上建立起来的，是要等应用第一次运行起来后才会。</p>
</li>
<li>
<p>validate：每次加载hibernate时，验证创建数据库表结构，只会和数据库中的表进行比较，不会创建新表，但是会插入新值。</p>
</li>
</ul>
</li>
</ol>
<h2 id="四jpql查询">四、JPQL查询<a hidden class="anchor" aria-hidden="true" href="#四jpql查询">#</a></h2>
<p>​	常用关键字</p>
<table>
<thead>
<tr>
<th>keyword</th>
<th>sample</th>
<th>jpaql snippet</th>
</tr>
</thead>
<tbody>
<tr>
<td>And</td>
<td>findByLastnameAndFirstname</td>
<td>&hellip;where x.firstname = ?1 and x.lastname = ?2</td>
</tr>
<tr>
<td>Or</td>
<td>findByLastnameOrFirstname</td>
<td>&hellip;where x.firstname = ?1 or x.lastname = ?2</td>
</tr>
<tr>
<td>Is, Equals</td>
<td>findByFirstnameIs, findByFirstnameEquals</td>
<td>&hellip;where x.firstname = ?1</td>
</tr>
<tr>
<td>Between</td>
<td>findByStartDateBetween</td>
<td>&hellip;where x.firstname between ?1 and ?2</td>
</tr>
<tr>
<td>LessThan</td>
<td>findByAgeLessThan</td>
<td>&hellip;where x.age &lt; ?1</td>
</tr>
<tr>
<td>LessThanEqual</td>
<td>findByAgeLessThanEqual</td>
<td>&hellip;where x.age &lt;= ?1</td>
</tr>
<tr>
<td>GreaterThan</td>
<td>findByAgeGreaterThan</td>
<td>&hellip;where x.age &gt; ?1</td>
</tr>
<tr>
<td>GreaterThanEqual</td>
<td>findByAgeGreaterThanEqual</td>
<td>&hellip;where x.age &gt;= ?1</td>
</tr>
<tr>
<td>After</td>
<td>findByStartDateAfter</td>
<td>&hellip;where x.startDate &gt; ?1</td>
</tr>
<tr>
<td>Before</td>
<td>findByStartDateBefore</td>
<td>&hellip;where x.startDate &lt; ?1</td>
</tr>
<tr>
<td>IsNull</td>
<td>findByAgeIsNull</td>
<td>&hellip;where x.age is null</td>
</tr>
<tr>
<td>IsNotNull, NotNull</td>
<td>findByAge(IS)NotNull</td>
<td>&hellip;where x.age not null</td>
</tr>
<tr>
<td>Like</td>
<td>findByFirstnameLike</td>
<td>&hellip;where x.firstname like ?1</td>
</tr>
<tr>
<td>NotLike</td>
<td>findByFirstnameNotLike</td>
<td>&hellip;where x.firstname not like ?1</td>
</tr>
<tr>
<td>StartingWith</td>
<td>findByFirstnameStartingWith</td>
<td>&hellip;where x.firstname like ?1(parameter bound with appended %)</td>
</tr>
<tr>
<td>EndingWith</td>
<td>findByFirstnameEndingWith</td>
<td>&hellip;where x.firstname like ?1(parameter bound with prepended %)</td>
</tr>
<tr>
<td>Containing</td>
<td>findByFirstnameContaining</td>
<td>&hellip;where x.firstname like ?1(parameter bound with wrapped in %)</td>
</tr>
<tr>
<td>OrderBy</td>
<td>findByAgeOrderByLastnameDesc</td>
<td>&hellip; where x.age = ?1 order by x.lastname desc</td>
</tr>
<tr>
<td>Not</td>
<td>findByLastnameNot</td>
<td>&hellip; where x.lastname &lt;&gt; ?1</td>
</tr>
<tr>
<td>In</td>
<td>findByAgeIn (Collection ages)</td>
<td>&hellip; where x.age in ?1</td>
</tr>
<tr>
<td>NotIn</td>
<td>findByAgeNotIn (Collection ages)</td>
<td>&hellip; where x.age not in ?1</td>
</tr>
<tr>
<td>TRUE</td>
<td>findByActiveTrue()</td>
<td>&hellip;where x.active=true</td>
</tr>
<tr>
<td>FALSE</td>
<td>findByActiveFalse()</td>
<td>&hellip;where x.active=false</td>
</tr>
<tr>
<td>IgnoreCase</td>
<td>findByFirstnameIgnoreCase</td>
<td>&hellip;where UPPER(x.firstname) = UPPER(?1)</td>
</tr>
</tbody>
</table>
<h2 id="五自定义query">五、自定义Query<a hidden class="anchor" aria-hidden="true" href="#五自定义query">#</a></h2>
<h3 id="使用原生的sql语句">使用原生的sql语句<a hidden class="anchor" aria-hidden="true" href="#使用原生的sql语句">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Query</span><span class="o">(</span><span class="n">nativeQuery</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
</span></span></code></pre></div><h3 id="1查询">1.查询<a hidden class="anchor" aria-hidden="true" href="#1查询">#</a></h3>
<h4 id="实例">实例<a hidden class="anchor" aria-hidden="true" href="#实例">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserRepository</span> <span class="kd">extends</span> <span class="n">Repository</span><span class="o">&lt;</span><span class="n">User</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 根据id查询用户信息
</span></span></span><span class="line"><span class="cl"><span class="cm">     * &lt;p&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm">     * User为ORM映射的类名，即为ORM映射的实体类名
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 根据参数的顺序，参数分别为?1，?2，?3......
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param id
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Query</span><span class="o">(</span><span class="s">&#34;select u from User u where u.id=?1&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">User</span> <span class="nf">findUser</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 根据id查询用户信息
</span></span></span><span class="line"><span class="cl"><span class="cm">     * &lt;p&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm">     * User为ORM映射的类名，即为ORM映射的实体类名
</span></span></span><span class="line"><span class="cl"><span class="cm">     * :id为传递的参数
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param id
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Query</span><span class="o">(</span><span class="s">&#34;select u from User u where u.id=:id&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">User</span> <span class="nf">findUserByParam</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span> <span class="n">Long</span> <span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 根据id和name查询用户信息
</span></span></span><span class="line"><span class="cl"><span class="cm">     * &lt;p&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm">     * User为ORM映射的类名，即为ORM映射的实体类名
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 根据参数的顺序，分别为?1，?2，?3......
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param id
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Query</span><span class="o">(</span><span class="s">&#34;select u from User u where u.id=?1 and u.name=?2&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">User</span> <span class="nf">findUserByIdAndName</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 查询所有用户信息
</span></span></span><span class="line"><span class="cl"><span class="cm">     * &lt;p&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm">     * User为ORM映射的类名，即为ORM映射的实体类名
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Query</span><span class="o">(</span><span class="s">&#34;select u from User u&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findUserList</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 根据name模糊查询
</span></span></span><span class="line"><span class="cl"><span class="cm">     * &lt;p&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm">     * User为ORM映射的类名，即为ORM映射的实体类名
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 根据参数的顺序，分别为?1，?2，?3......
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param name
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Query</span><span class="o">(</span><span class="s">&#34;select u from User u where name like %?1%&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findUserListByLikeName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 根据name模糊查询
</span></span></span><span class="line"><span class="cl"><span class="cm">     * &lt;p&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm">     * User为ORM映射的类名，即为ORM映射的实体类名
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 根据参数的顺序，分别为?1，?2，?3......
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param name
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Query</span><span class="o">(</span><span class="s">&#34;select u from User u where name like concat(&#39;%&#39;,?1,&#39;%&#39;) &#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findUserListByLikeConcatName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 根据id查询用户信息
</span></span></span><span class="line"><span class="cl"><span class="cm">     * &lt;p&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm">     * nativeQuery = true时，JPA能够识别真正的SQL语句
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param id
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Query</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;select * from user where id=?1&#34;</span><span class="o">,</span> <span class="n">nativeQuery</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">User</span> <span class="nf">findUserByNativeQuery</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 使用SpEL表达式
</span></span></span><span class="line"><span class="cl"><span class="cm">     * &lt;p&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 从Spring Data JPA 1.4版开始，我们支持在手动定义的查询中使用受限制的SpEL模板表达式@Query。
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 在执行查询时，将根据预定义的变量集评估这些表达式。Spring Data JPA支持一个名为的变量entityName。它的用法是select x from #{#entityName} x。
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 它插入entityName与给定存储库关联的域类型。该entityName解决如下：如果域类型已设置的name属性@Entity的注释，它被使用。否则，使用域类型的简单类名
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param name
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Query</span><span class="o">(</span><span class="s">&#34;select u from #{#entityName} u where u.name = ?1&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findBySpEL</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="2更新删除">2.更新/删除<a hidden class="anchor" aria-hidden="true" href="#2更新删除">#</a></h3>
<h4 id="示例">示例<a hidden class="anchor" aria-hidden="true" href="#示例">#</a></h4>
<p>​	UserRepository.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Transactional</span><span class="c1">//事务：原子性，回滚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Modifying</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Query</span><span class="o">(</span><span class="s">&#34;update User set gender=:gender where userName=:name &#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">updateUser</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">&#34;gender&#34;</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">gender</span> <span class="o">,</span><span class="nd">@Param</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">userName</span><span class="o">);</span>
</span></span></code></pre></div><h3 id="3多表联查">3.多表联查<a hidden class="anchor" aria-hidden="true" href="#3多表联查">#</a></h3>
<h4 id="示例-1">示例<a hidden class="anchor" aria-hidden="true" href="#示例-1">#</a></h4>
<p>​	UserDepartVo.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Data</span>
</span></span><span class="line"><span class="cl"><span class="nd">@AllArgsConstructor</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDepartVo</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">code</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">userName</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Integer</span> <span class="n">gender</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>​	UserRepository.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//查询所有用户的code，姓名，性别，部门名称
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Query</span><span class="o">(</span><span class="s">&#34;select new com.wzy.jxx.jpa.UserDepartVo(u.code,u.userName,u.gender,d.name) &#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;from User u,Department d where  u.departmentId=d.id&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">UserDepartVo</span><span class="o">&gt;</span> <span class="nf">getUserDeparment</span><span class="o">();</span>
</span></span></code></pre></div><h3 id="4分页查询">4.分页查询<a hidden class="anchor" aria-hidden="true" href="#4分页查询">#</a></h3>
<h4 id="示例1">示例1<a hidden class="anchor" aria-hidden="true" href="#示例1">#</a></h4>
<p>​	UserRepository.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Query</span><span class="o">(</span><span class="s">&#34;select u from User u where gender=?1 and age between ?2 and ?3 &#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">Page</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findPageByGender3</span><span class="o">(</span><span class="n">Integer</span> <span class="n">gender</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">minAge</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">maxAge</span><span class="o">,</span><span class="n">Pageable</span> <span class="n">pageable</span><span class="o">);</span>
</span></span></code></pre></div><p>​	UserController.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;/findPageByGender3&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">Page</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findPageByGender3</span><span class="o">(</span><span class="n">Integer</span> <span class="n">page</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">size</span><span class="o">,</span><span class="n">Integer</span> <span class="n">gender</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                    <span class="n">Integer</span> <span class="n">minAge</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">maxAge</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">    <span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="n">PageRequest</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">page</span><span class="o">,</span><span class="n">size</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findPageByGender3</span><span class="o">(</span><span class="n">gender</span><span class="o">,</span> <span class="n">minAge</span><span class="o">,</span> <span class="n">maxAge</span><span class="o">,</span> <span class="n">pageable</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h4 id="示例2">示例2<a hidden class="anchor" aria-hidden="true" href="#示例2">#</a></h4>
<p>​	UserRepository.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Query</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;select *  from User WHERE gender = ?1&#34;</span><span class="o">,</span><span class="n">nativeQuery</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Page</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findPageByGender</span><span class="o">(</span><span class="n">Integer</span> <span class="n">gender</span><span class="o">,</span> <span class="n">Pageable</span> <span class="n">page</span><span class="o">);</span>
</span></span></code></pre></div><p>​	UserController.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;findPageByGender&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">Page</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findPageByGender</span><span class="o">(</span><span class="n">Integer</span> <span class="n">gender</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">    <span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="n">PageRequest</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">20</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Page</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">userPage</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findPageByGender</span><span class="o">(</span><span class="n">gender</span><span class="o">,</span><span class="n">pageable</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">userPage</span><span class="o">.</span><span class="na">getContent</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">userPage</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="5排序查询">5.排序查询<a hidden class="anchor" aria-hidden="true" href="#5排序查询">#</a></h3>
<h4 id="示例-2">示例<a hidden class="anchor" aria-hidden="true" href="#示例-2">#</a></h4>
<p>​		UserRepository.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Query</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;select u  from User u  WHERE gender = ?1&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findByGenderSort</span><span class="o">(</span><span class="n">Integer</span> <span class="n">gender</span><span class="o">,</span> <span class="n">Sort</span> <span class="n">sort</span><span class="o">);</span>
</span></span></code></pre></div><p>​		UserController.java</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;findByGenderSort&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findByGenderSort</span><span class="o">(</span><span class="n">Integer</span> <span class="n">gender</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">    <span class="n">Sort</span> <span class="n">sort</span> <span class="o">=</span> <span class="n">Sort</span><span class="o">.</span><span class="na">by</span><span class="o">(</span><span class="n">Sort</span><span class="o">.</span><span class="na">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findByGenderSort</span><span class="o">(</span><span class="n">gender</span><span class="o">,</span><span class="n">sort</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">users</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://rex0520.github.io/tags/jdbc/">JDBC</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://rex0520.github.io/posts/front/vue/vue%E8%BF%9B%E9%98%B6/">
    <span class="title">« Prev Page</span>
    <br>
    <span>Vue进阶</span>
  </a>
  <a class="next" href="https://rex0520.github.io/posts/front/vue/vue%E5%8A%A8%E7%94%BB/">
    <span class="title">Next Page »</span>
    <br>
    <span>Vue动画</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share JPA学习 on twitter"
        href="https://twitter.com/intent/tweet/?text=JPA%e5%ad%a6%e4%b9%a0&amp;url=https%3a%2f%2frex0520.github.io%2fposts%2fback%2fjava%2fjdbctool%2fjpa%25D1%25A7%25CF%25B0%2f&amp;hashtags=JDBC">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share JPA学习 on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frex0520.github.io%2fposts%2fback%2fjava%2fjdbctool%2fjpa%25D1%25A7%25CF%25B0%2f&amp;title=JPA%e5%ad%a6%e4%b9%a0&amp;summary=JPA%e5%ad%a6%e4%b9%a0&amp;source=https%3a%2f%2frex0520.github.io%2fposts%2fback%2fjava%2fjdbctool%2fjpa%25D1%25A7%25CF%25B0%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share JPA学习 on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2frex0520.github.io%2fposts%2fback%2fjava%2fjdbctool%2fjpa%25D1%25A7%25CF%25B0%2f&title=JPA%e5%ad%a6%e4%b9%a0">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share JPA学习 on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frex0520.github.io%2fposts%2fback%2fjava%2fjdbctool%2fjpa%25D1%25A7%25CF%25B0%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share JPA学习 on whatsapp"
        href="https://api.whatsapp.com/send?text=JPA%e5%ad%a6%e4%b9%a0%20-%20https%3a%2f%2frex0520.github.io%2fposts%2fback%2fjava%2fjdbctool%2fjpa%25D1%25A7%25CF%25B0%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share JPA学习 on telegram"
        href="https://telegram.me/share/url?text=JPA%e5%ad%a6%e4%b9%a0&amp;url=https%3a%2f%2frex0520.github.io%2fposts%2fback%2fjava%2fjdbctool%2fjpa%25D1%25A7%25CF%25B0%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
<script src="https://utteranc.es/client.js" repo="Rex0520/blogcomment"
  issue-term="title" theme="github-light" crossorigin="anonymous"
  async>
  </script>

</article>
    </main>
    
<footer class="footer">
  <span>&copy; 2022 <a href="https://rex0520.github.io/">Rex中心站</a></span>
  <span>
    Powered by
    <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
    <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
  </span>
  <span><a href="https://beian.miit.gov.cn/">浙ICP备2021016765号-2</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
    <path d="M12 6H0l6-6z" />
  </svg>
</a>

<script>
  let menu = document.getElementById('menu')
  menu.scrollLeft = localStorage.getItem("menu-scroll-position");
  menu.onscroll = function () {
    localStorage.setItem("menu-scroll-position", menu.scrollLeft);
  }

  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener("click", function (e) {
      e.preventDefault();
      var id = this.getAttribute("href").substr(1);
      if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
          behavior: "smooth"
        });
      } else {
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
      }
      if (id === "top") {
        history.replaceState(null, null, " ");
      } else {
        history.pushState(null, null, `#${id}`);
      }
    });
  });

</script>
<script>
  var mybutton = document.getElementById("top-link");
  window.onscroll = function () {
    if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
      mybutton.style.visibility = "visible";
      mybutton.style.opacity = "1";
    } else {
      mybutton.style.visibility = "hidden";
      mybutton.style.opacity = "0";
    }
  };

</script>
<script>
  document.getElementById("theme-toggle").addEventListener("click", () => {
    if (document.body.className.includes("dark")) {
      document.body.classList.remove('dark');
      localStorage.setItem("pref-theme", 'light');
    } else {
      document.body.classList.add('dark');
      localStorage.setItem("pref-theme", 'dark');
    }
  })

</script>
<script>
  document.querySelectorAll('pre > code').forEach((codeblock) => {
    const container = codeblock.parentNode.parentNode;

    const copybutton = document.createElement('button');
    copybutton.classList.add('copy-code');
    copybutton.innerText = 'copy';

    function copyingDone() {
      copybutton.innerText = 'copied!';
      setTimeout(() => {
        copybutton.innerText = 'copy';
      }, 2000);
    }

    copybutton.addEventListener('click', (cb) => {
      if ('clipboard' in navigator) {
        navigator.clipboard.writeText(codeblock.textContent);
        copyingDone();
        return;
      }

      const range = document.createRange();
      range.selectNodeContents(codeblock);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand('copy');
        copyingDone();
      } catch (e) { };
      selection.removeRange(range);
    });

    if (container.classList.contains("highlight")) {
      container.appendChild(copybutton);
    } else if (container.parentNode.firstChild == container) {
      
    } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
      
      codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
    } else {
      
      codeblock.parentNode.appendChild(copybutton);
    }
  });
</script>

<script src="/assets/js/mermaid.min.js"></script>
<script>
  
  
  const mermaidKeywords = [
    "graph TD",
    "graph TB",
    "graph BT",
    "graph RL",
    "graph LR",
    "sequenceDiagram",
    "gantt",
    "classDiagram",
    "gitGraph",
    "erDiagram",
    "journey"
  ];
  var htmlCollection = document.getElementsByClassName('language-fallback')
  console.log(htmlCollection)
  Array.prototype.slice.call(htmlCollection)
  console.log(Array.prototype.slice.call(htmlCollection))
  Array.from(htmlCollection).forEach(ele => {
    var graphDefinition = ele.innerText;
    if (mermaidKeywords.some((keyword) => graphDefinition.startsWith(keyword))) {
      ele.parentElement.parentElement.outerHTML = `<div class="mermaid">${ele.innerText}</div>`
    }
  })
  Array.from(document.getElementsByClassName('language-mermaid')).forEach(ele => {
    ele.parentElement.outerHTML = `<div class="mermaid">${ele.innerText}</div>`
  })
</script>
<style>
   
  .mermaid svg {
    display: block;
    margin: auto;
  }
</style>
</body>

</html>
